(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();class $s extends Map{set(e,n){return super.set(e,n),n}}class Tn extends WeakMap{set(e,n){return super.set(e,n),n}}/*! (c) Andrea Giammarchi - ISC */const Cs=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,ks=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Ss=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,As=/[\x01\x02]/g,Es=(t,e,n)=>{let r=0;return t.join("").trim().replace(ks,(i,s,a,o)=>{let l=s+a.replace(Ss,"=$2$1").trimEnd();return o.length&&(l+=n||Cs.test(s)?" /":"></"+s),"<"+l+">"}).replace(As,i=>i===""?"<!--"+e+r+++"-->":e+r++)},Ns=1,Lr=111,Ps=({firstChild:t,lastChild:e})=>{const n=document.createRange();return n.setStartAfter(t),n.setEndAfter(e),n.deleteContents(),t},Os=(t,e)=>t.nodeType===Lr?1/e<0?e?Ps(t):t.lastChild:e?t.valueOf():t.firstChild:t,Ts=t=>{const{firstChild:e,lastChild:n}=t;if(e===n)return n||t;const{childNodes:r}=t,i=[...r];return{ELEMENT_NODE:Ns,nodeType:Lr,firstChild:e,lastChild:n,valueOf(){return r.length!==i.length&&t.append(...i),t}}},{isArray:Is}=Array,Ls=t=>e=>{for(const n in e){const r=n==="role"?n:`aria-${n}`,i=e[n];i==null?t.removeAttribute(r):t.setAttribute(r,i)}},In=t=>t==null?t:t.valueOf(),Ms=(t,e)=>{let n,r=!0;const i=document.createAttributeNS(null,e);return s=>{const a=In(s);n!==a&&((n=a)==null?r||(t.removeAttributeNode(i),r=!0):(i.value=a,r&&(t.setAttributeNodeNS(i),r=!1)))}},Rs=(t,e,n)=>r=>{const i=!!In(r);n!==i&&((n=i)?t.setAttribute(e,""):t.removeAttribute(e))},Ds=({dataset:t})=>e=>{for(const n in e){const r=e[n];r==null?delete t[n]:t[n]=r}},ir=(t,e)=>{let n,r,i=e.slice(2);return!(e in t)&&(r=e.toLowerCase())in t&&(i=r.slice(2)),s=>{const a=Is(s)?s:[s,!1];n!==a[0]&&(n&&t.removeEventListener(i,n,a[1]),(n=a[0])&&t.addEventListener(i,n,a[1]))}},js=t=>{let e;return n=>{e!==n&&(e=n,typeof n=="function"?n(t):n.current=t)}},Us=(t,e)=>e==="dataset"?Ds(t):n=>{t[e]=n},Bs=t=>{let e;return n=>{const r=In(n);e!=r&&(e=r,t.textContent=r??"")}},_s=(t,e,n,r,i)=>{const s=n.length;let a=e.length,o=s,l=0,c=0,u=null;for(;l<a||c<o;)if(a===l){const f=o<s?c?r(n[c-1],-0).nextSibling:r(n[o-c],0):i;for(;c<o;)t.insertBefore(r(n[c++],1),f)}else if(o===c)for(;l<a;)(!u||!u.has(e[l]))&&t.removeChild(r(e[l],-1)),l++;else if(e[l]===n[c])l++,c++;else if(e[a-1]===n[o-1])a--,o--;else if(e[l]===n[o-1]&&n[c]===e[a-1]){const f=r(e[--a],-1).nextSibling;t.insertBefore(r(n[c++],1),r(e[l++],-1).nextSibling),t.insertBefore(r(n[--o],1),f),e[a]=n[o]}else{if(!u){u=new Map;let f=c;for(;f<o;)u.set(n[f],f++)}if(u.has(e[l])){const f=u.get(e[l]);if(c<f&&f<o){let h=l,p=1;for(;++h<a&&h<o&&u.get(e[h])===f+p;)p++;if(p>f-c){const d=r(e[l],0);for(;c<f;)t.insertBefore(r(n[c++],1),d)}else t.replaceChild(r(n[c++],1),r(e[l++],-1))}else l++}else t.removeChild(r(e[l++],-1))}return n},{isArray:Mr,prototype:Fs}=Array,{indexOf:Ks}=Fs,{createDocumentFragment:qs,createElement:Hs,createElementNS:zs,createTextNode:Ws,createTreeWalker:Gs,importNode:Vs}=new Proxy(document,{get:(t,e)=>t[e].bind(t)}),Js=t=>{const e=Hs("template");return e.innerHTML=t,e.content};let dt;const Zs=t=>{dt||(dt=zs("http://www.w3.org/2000/svg","svg")),dt.innerHTML=t;const e=qs();return e.append(...dt.childNodes),e},Ys=(t,e)=>e?Zs(t):Js(t),Xs=({childNodes:t},e)=>t[e],Ge=(t,e,n)=>_s(t.parentNode,e,n,Os,t),Qs=t=>{let e,n,r=[];const i=s=>{switch(typeof s){case"string":case"number":case"boolean":e!==s&&(e=s,n||(n=Ws("")),n.data=s,r=Ge(t,r,[n]));break;case"object":case"undefined":if(s==null){e!=s&&(e=s,r=Ge(t,r,[]));break}if(Mr(s)){e=s,s.length===0?r=Ge(t,r,[]):typeof s[0]=="object"?r=Ge(t,r,s):i(String(s));break}if(e!==s)if("ELEMENT_NODE"in s)e=s,r=Ge(t,r,s.nodeType===11?[...s.childNodes]:[s]);else{const a=s.valueOf();a!==s&&i(a)}break;case"function":i(s(t));break}};return i},ea=(t,e)=>{switch(e[0]){case"?":return Rs(t,e.slice(1),!1);case".":return Us(t,e.slice(1));case"@":return ir(t,"on"+e.slice(1));case"o":if(e[1]==="n")return ir(t,e)}switch(e){case"ref":return js(t);case"aria":return Ls(t)}return Ms(t,e)};function ta(t){const{type:e,path:n}=t,r=n.reduceRight(Xs,this);return e==="node"?Qs(r):e==="attr"?ea(r,t.name):Bs(r)}const Zt=t=>{const e=[];let{parentNode:n}=t;for(;n;)e.push(Ks.call(n.childNodes,t)),t=n,{parentNode:n}=t;return e},Ve="is\xB5",sr=new Tn,na=/^(?:textarea|script|style|title|plaintext|xmp)$/,rt=()=>({stack:[],entry:null,wire:null}),ra=(t,e)=>{const{content:n,updates:r}=sa(t,e);return{type:t,template:e,content:n,updates:r,wire:null}},ia=(t,e)=>{const n=t==="svg",r=Es(e,Ve,n),i=Ys(r,n),s=Gs(i,129),a=[],o=e.length-1;let l=0,c=`${Ve}${l}`;for(;l<o;){const u=s.nextNode();if(!u)throw`bad template: ${r}`;if(u.nodeType===8)u.data===c&&(a.push({type:"node",path:Zt(u)}),c=`${Ve}${++l}`);else{for(;u.hasAttribute(c);)a.push({type:"attr",path:Zt(u),name:u.getAttribute(c)}),u.removeAttribute(c),c=`${Ve}${++l}`;na.test(u.localName)&&u.textContent.trim()===`<!--${c}-->`&&(u.textContent="",a.push({type:"text",path:Zt(u)}),c=`${Ve}${++l}`)}}return{content:i,nodes:a}},sa=(t,e)=>{const{content:n,nodes:r}=sr.get(e)||sr.set(e,ia(t,e)),i=Vs(n,!0),s=r.map(ta,i);return{content:i,updates:s}},kt=(t,{type:e,template:n,values:r})=>{const i=Rr(t,r);let{entry:s}=t;(!s||s.template!==n||s.type!==e)&&(t.entry=s=ra(e,n));const{content:a,updates:o,wire:l}=s;for(let c=0;c<i;c++)o[c](r[c]);return l||(s.wire=Ts(a))},Rr=({stack:t},e)=>{const{length:n}=e;for(let r=0;r<n;r++){const i=e[r];i instanceof St?e[r]=kt(t[r]||(t[r]=rt()),i):Mr(i)?Rr(t[r]||(t[r]=rt()),i):t[r]=null}return n<t.length&&t.splice(n),n};class St{constructor(e,n,r){this.type=e,this.template=n,this.values=r}}const Dr=t=>{const e=new Tn,n=r=>(i,...s)=>kt(r,{type:t,template:i,values:s});return Object.assign((r,...i)=>new St(t,r,i),{for(r,i){const s=e.get(r)||e.set(r,new $s);return s.get(i)||s.set(i,n(rt()))},node:(r,...i)=>kt(rt(),new St(t,r,i)).valueOf()})},ar=new Tn,Ee=(t,e)=>{const n=typeof e=="function"?e():e,r=ar.get(t)||ar.set(t,rt()),i=n instanceof St?kt(r,n):n;return i!==r.wire&&(r.wire=i,t.replaceChildren(i.valueOf())),t},g=Dr("html");Dr("svg");var He={},Ln={},it={document:{}},jr=Object.prototype.hasOwnProperty,Ur=function(t){return Mt(t)?t.toLowerCase():t},Qe=Array.isArray,aa=function(t){return Mt(t)?t.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)|32)}):t};"I".toLowerCase()!=="i"&&(Ur=aa);var oa,Mn=Object.prototype.toString,Br=Object.getPrototypeOf,Yt=Hr("ng");it.angular||(it.angular={});it.document.documentMode;function la(t){if(t==null||jn(t))return!1;if(Qe(t)||Mt(t)||oa)return!0;var e="length"in Object(t)&&t.length;return Dn(e)&&(e>=0&&(e-1 in t||t instanceof Array)||typeof t.item=="function")}function P(t,e,n){var r,i;if(t)if(Kr(t))for(r in t)r!=="prototype"&&r!=="length"&&r!=="name"&&t.hasOwnProperty(r)&&e.call(n,t[r],r,t);else if(Qe(t)||la(t)){var s=typeof t!="object";for(r=0,i=t.length;r<i;r++)(s||r in t)&&e.call(n,t[r],r,t)}else if(t.forEach&&t.forEach!==P)t.forEach(e,n,t);else if(Fr(t))for(r in t)e.call(n,t[r],r,t);else if(typeof t.hasOwnProperty=="function")for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t);else for(r in t)jr.call(t,r)&&e.call(n,t[r],r,t);return t}function ca(t,e){e?t.$$hashKey=e:delete t.$$hashKey}function Rn(){}Rn.$inject=[];function ua(t){return typeof t>"u"}function De(t){return typeof t<"u"}function _r(t){return t!==null&&typeof t=="object"}function Fr(t){return t!==null&&typeof t=="object"&&!Br(t)}function Mt(t){return typeof t=="string"}function Dn(t){return typeof t=="number"}function Kr(t){return typeof t=="function"}function jn(t){return t&&t.window===t}function qr(t){return t&&t.$evalAsync&&t.$watch}var fa=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array\]$/;function da(t){return t&&Dn(t.length)&&fa.test(Mn.call(t))}function ha(t){return Mn.call(t)==="[object ArrayBuffer]"}function pa(t,e){var n=[],r=[];if(e){if(da(e)||ha(e))throw Yt("cpta","Can't copy! TypedArray destination cannot be mutated.");if(t===e)throw Yt("cpi","Can't copy! Source and destination are identical.");return Qe(e)?e.length=0:P(e,function(o,l){l!=="$$hashKey"&&delete e[l]}),n.push(t),r.push(e),i(t,e)}return s(t);function i(o,l){var c=l.$$hashKey,u;if(Qe(o))for(var f=0,h=o.length;f<h;f++)l.push(s(o[f]));else if(Fr(o))for(u in o)l[u]=s(o[u]);else if(o&&typeof o.hasOwnProperty=="function")for(u in o)o.hasOwnProperty(u)&&(l[u]=s(o[u]));else for(u in o)jr.call(o,u)&&(l[u]=s(o[u]));return ca(l,c),l}function s(o){if(!_r(o))return o;var l=n.indexOf(o);if(l!==-1)return r[l];if(jn(o)||qr(o))throw Yt("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");var c=!1,u=a(o);return u===void 0&&(u=Qe(o)?[]:Object.create(Br(o)),c=!0),n.push(o),r.push(u),c?i(o,u):u}function a(o){switch(Mn.call(o)){case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return new o.constructor(s(o.buffer),o.byteOffset,o.length);case"[object ArrayBuffer]":if(!o.slice){var l=new ArrayBuffer(o.byteLength);return new Uint8Array(l).set(new Uint8Array(o)),l}return o.slice(0);case"[object Boolean]":case"[object Number]":case"[object String]":case"[object Date]":return new o.constructor(o.valueOf());case"[object RegExp]":var c=new RegExp(o.source,o.toString().match(/[^\/]*$/)[0]);return c.lastIndex=o.lastIndex,c;case"[object Blob]":return new o.constructor([o],{type:o.type})}if(Kr(o.cloneNode))return o.cloneNode(!0)}}function ga(t,e){var n=e;return typeof t=="string"&&t.charAt(0)==="$"&&t.charAt(1)==="$"?n=void 0:jn(e)?n="$WINDOW":e&&it.document===e?n="$DOCUMENT":qr(e)&&(n="$SCOPE"),n}function ma(t){if(!t.currentScript)return!0;var e=t.currentScript.getAttribute("src"),n=t.createElement("a");n.href=e;var r=n.protocol,i=t.location.protocol;return!((r==="resource:"||r==="chrome-extension:")&&i!==r)}ma(it.document);function va(){return Object.create(null)}function ya(t){var e=[];return JSON.stringify(t,function(n,r){if(r=ga(n,r),_r(r)){if(e.indexOf(r)>=0)return"...";e.push(r)}return r})}function or(t){return typeof t=="function"?t.toString().replace(/ \{[\s\S]*$/,""):ua(t)?"undefined":typeof t!="string"?ya(t):t}function Hr(t,e){return e=e||Error,function(){var n=2,r=arguments,i=r[0],s="["+(t?t+":":"")+i+"] ",a=r[1],o,l;for(s+=a.replace(/\{\d+\}/g,function(c){var u=+c.slice(1,-1),f=u+n;return f<r.length?or(r[f]):c}),s+=`
http://errors.angularjs.org/"NG_VERSION_FULL"/`+(t?t+"/":"")+i,l=n,o="?";l<r.length;l++,o="&")s+=o+"p"+(l-n)+"="+encodeURIComponent(or(r[l]));return new e(s)}}var je=Hr("$parse");({}).constructor.prototype.valueOf;function zr(t){return t+""}var yt=va();P("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(t){yt[t]=!0});var ba={n:`
`,f:"\f",r:"\r",t:"	",v:"\v","'":"'",'"':'"'},un=function(e){this.options=e};un.prototype={constructor:un,lex:function(t){for(this.text=t,this.index=0,this.tokens=[];this.index<this.text.length;){var e=this.text.charAt(this.index);if(e==='"'||e==="'")this.readString(e);else if(this.isNumber(e)||e==="."&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(e,"(){}[].,;:?"))this.tokens.push({index:this.index,text:e}),this.index++;else if(this.isWhitespace(e))this.index++;else{var n=e+this.peek(),r=n+this.peek(2),i=yt[e],s=yt[n],a=yt[r];if(i||s||a){var o=a?r:s?n:e;this.tokens.push({index:this.index,text:o,operator:!0}),this.index+=o.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(t,e){return e.indexOf(t)!==-1},peek:function(t){var e=t||1;return this.index+e<this.text.length?this.text.charAt(this.index+e):!1},isNumber:function(t){return"0"<=t&&t<="9"&&typeof t=="string"},isWhitespace:function(t){return t===" "||t==="\r"||t==="	"||t===`
`||t==="\v"||t==="\xA0"},isIdentifierStart:function(t){return this.options.isIdentifierStart?this.options.isIdentifierStart(t,this.codePointAt(t)):this.isValidIdentifierStart(t)},isValidIdentifierStart:function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"||t==="_"||t==="$"},isIdentifierContinue:function(t){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(t,this.codePointAt(t)):this.isValidIdentifierContinue(t)},isValidIdentifierContinue:function(t,e){return this.isValidIdentifierStart(t,e)||this.isNumber(t)},codePointAt:function(t){return t.length===1?t.charCodeAt(0):(t.charCodeAt(0)<<10)+t.charCodeAt(1)-56613888},peekMultichar:function(){var t=this.text.charAt(this.index),e=this.peek();if(!e)return t;var n=t.charCodeAt(0),r=e.charCodeAt(0);return n>=55296&&n<=56319&&r>=56320&&r<=57343?t+e:t},isExpOperator:function(t){return t==="-"||t==="+"||this.isNumber(t)},throwError:function(t,e,n){n=n||this.index;var r=De(e)?"s "+e+"-"+this.index+" ["+this.text.substring(e,n)+"]":" "+n;throw je("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",t,r,this.text)},readNumber:function(){for(var t="",e=this.index;this.index<this.text.length;){var n=Ur(this.text.charAt(this.index));if(n==="."||this.isNumber(n))t+=n;else{var r=this.peek();if(n==="e"&&this.isExpOperator(r))t+=n;else if(this.isExpOperator(n)&&r&&this.isNumber(r)&&t.charAt(t.length-1)==="e")t+=n;else if(this.isExpOperator(n)&&(!r||!this.isNumber(r))&&t.charAt(t.length-1)==="e")this.throwError("Invalid exponent");else break}this.index++}this.tokens.push({index:e,text:t,constant:!0,value:Number(t)})},readIdent:function(){var t=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var e=this.peekMultichar();if(!this.isIdentifierContinue(e))break;this.index+=e.length}this.tokens.push({index:t,text:this.text.slice(t,this.index),identifier:!0})},readString:function(t){var e=this.index;this.index++;for(var n="",r=t,i=!1;this.index<this.text.length;){var s=this.text.charAt(this.index);if(r+=s,i){if(s==="u"){var a=this.text.substring(this.index+1,this.index+5);a.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+a+"]"),this.index+=4,n+=String.fromCharCode(parseInt(a,16))}else{var o=ba[s];n=n+(o||s)}i=!1}else if(s==="\\")i=!0;else if(s===t){this.index++,this.tokens.push({index:e,text:r,constant:!0,value:n});return}else n+=s;this.index++}this.throwError("Unterminated quote",e)}};var v=function(e,n){this.lexer=e,this.options=n};v.Program="Program";v.ExpressionStatement="ExpressionStatement";v.AssignmentExpression="AssignmentExpression";v.ConditionalExpression="ConditionalExpression";v.LogicalExpression="LogicalExpression";v.BinaryExpression="BinaryExpression";v.UnaryExpression="UnaryExpression";v.CallExpression="CallExpression";v.MemberExpression="MemberExpression";v.Identifier="Identifier";v.Literal="Literal";v.ArrayExpression="ArrayExpression";v.Property="Property";v.ObjectExpression="ObjectExpression";v.ThisExpression="ThisExpression";v.LocalsExpression="LocalsExpression";v.NGValueParameter="NGValueParameter";v.prototype={ast:function(t){this.text=t,this.tokens=this.lexer.lex(t);var e=this.program();return this.tokens.length!==0&&this.throwError("is an unexpected token",this.tokens[0]),e},program:function(){for(var t=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&t.push(this.expressionStatement()),!this.expect(";"))return{type:v.Program,body:t}},expressionStatement:function(){return{type:v.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var t=this.expression();this.expect("|");)t=this.filter(t);return t},expression:function(){return this.assignment()},assignment:function(){var t=this.ternary();if(this.expect("=")){if(!Vr(t))throw je("lval","Trying to assign a value to a non l-value");t={type:v.AssignmentExpression,left:t,right:this.assignment(),operator:"="}}return t},ternary:function(){var t=this.logicalOR(),e,n;return this.expect("?")&&(e=this.expression(),this.consume(":"))?(n=this.expression(),{type:v.ConditionalExpression,test:t,alternate:e,consequent:n}):t},logicalOR:function(){for(var t=this.logicalAND();this.expect("||");)t={type:v.LogicalExpression,operator:"||",left:t,right:this.logicalAND()};return t},logicalAND:function(){for(var t=this.equality();this.expect("&&");)t={type:v.LogicalExpression,operator:"&&",left:t,right:this.equality()};return t},equality:function(){for(var t=this.relational(),e;e=this.expect("==","!=","===","!==");)t={type:v.BinaryExpression,operator:e.text,left:t,right:this.relational()};return t},relational:function(){for(var t=this.additive(),e;e=this.expect("<",">","<=",">=");)t={type:v.BinaryExpression,operator:e.text,left:t,right:this.additive()};return t},additive:function(){for(var t=this.multiplicative(),e;e=this.expect("+","-");)t={type:v.BinaryExpression,operator:e.text,left:t,right:this.multiplicative()};return t},multiplicative:function(){for(var t=this.unary(),e;e=this.expect("*","/","%");)t={type:v.BinaryExpression,operator:e.text,left:t,right:this.unary()};return t},unary:function(){var t;return(t=this.expect("+","-","!"))?{type:v.UnaryExpression,operator:t.text,prefix:!0,argument:this.unary()}:this.primary()},primary:function(){var t;this.expect("(")?(t=this.filterChain(),this.consume(")")):this.expect("[")?t=this.arrayDeclaration():this.expect("{")?t=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?t=pa(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?t={type:v.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?t=this.identifier():this.peek().constant?t=this.constant():this.throwError("not a primary expression",this.peek());for(var e;e=this.expect("(","[",".");)e.text==="("?(t={type:v.CallExpression,callee:t,arguments:this.parseArguments()},this.consume(")")):e.text==="["?(t={type:v.MemberExpression,object:t,property:this.expression(),computed:!0},this.consume("]")):e.text==="."?t={type:v.MemberExpression,object:t,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return t},filter:function(t){for(var e=[t],n={type:v.CallExpression,callee:this.identifier(),arguments:e,filter:!0};this.expect(":");)e.push(this.expression());return n},parseArguments:function(){var t=[];if(this.peekToken().text!==")")do t.push(this.filterChain());while(this.expect(","));return t},identifier:function(){var t=this.consume();return t.identifier||this.throwError("is not a valid identifier",t),{type:v.Identifier,name:t.text}},constant:function(){return{type:v.Literal,value:this.consume().value}},arrayDeclaration:function(){var t=[];if(this.peekToken().text!=="]")do{if(this.peek("]"))break;t.push(this.expression())}while(this.expect(","));return this.consume("]"),{type:v.ArrayExpression,elements:t}},object:function(){var t=[],e;if(this.peekToken().text!=="}")do{if(this.peek("}"))break;e={type:v.Property,kind:"init"},this.peek().constant?(e.key=this.constant(),e.computed=!1,this.consume(":"),e.value=this.expression()):this.peek().identifier?(e.key=this.identifier(),e.computed=!1,this.peek(":")?(this.consume(":"),e.value=this.expression()):e.value=e.key):this.peek("[")?(this.consume("["),e.key=this.expression(),this.consume("]"),e.computed=!0,this.consume(":"),e.value=this.expression()):this.throwError("invalid key",this.peek()),t.push(e)}while(this.expect(","));return this.consume("}"),{type:v.ObjectExpression,properties:t}},throwError:function(t,e){throw je("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",e.text,t,e.index+1,this.text,this.text.substring(e.index))},consume:function(t){if(this.tokens.length===0)throw je("ueoe","Unexpected end of expression: {0}",this.text);var e=this.expect(t);return e||this.throwError("is unexpected, expecting ["+t+"]",this.peek()),e},peekToken:function(){if(this.tokens.length===0)throw je("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(t,e,n,r){return this.peekAhead(0,t,e,n,r)},peekAhead:function(t,e,n,r,i){if(this.tokens.length>t){var s=this.tokens[t],a=s.text;if(a===e||a===n||a===r||a===i||!e&&!n&&!r&&!i)return s}return!1},expect:function(t,e,n,r){var i=this.peek(t,e,n,r);return i?(this.tokens.shift(),i):!1},selfReferential:{this:{type:v.ThisExpression},$locals:{type:v.LocalsExpression}}};function wa(t,e){return typeof t<"u"?t:e}function Wr(t,e){return typeof t>"u"?e:typeof e>"u"?t:t+e}function xa(t,e){var n=t(e);if(!n)throw new Error("Filter '"+e+"' is not defined");return!n.$stateful}function M(t,e){var n,r,i;switch(t.type){case v.Program:n=!0,P(t.body,function(s){M(s.expression,e),n=n&&s.expression.constant}),t.constant=n;break;case v.Literal:t.constant=!0,t.toWatch=[];break;case v.UnaryExpression:M(t.argument,e),t.constant=t.argument.constant,t.toWatch=t.argument.toWatch;break;case v.BinaryExpression:M(t.left,e),M(t.right,e),t.constant=t.left.constant&&t.right.constant,t.toWatch=t.left.toWatch.concat(t.right.toWatch);break;case v.LogicalExpression:M(t.left,e),M(t.right,e),t.constant=t.left.constant&&t.right.constant,t.toWatch=t.constant?[]:[t];break;case v.ConditionalExpression:M(t.test,e),M(t.alternate,e),M(t.consequent,e),t.constant=t.test.constant&&t.alternate.constant&&t.consequent.constant,t.toWatch=t.constant?[]:[t];break;case v.Identifier:t.constant=!1,t.toWatch=[t];break;case v.MemberExpression:M(t.object,e),t.computed&&M(t.property,e),t.constant=t.object.constant&&(!t.computed||t.property.constant),t.toWatch=[t];break;case v.CallExpression:i=t.filter?xa(e,t.callee.name):!1,n=i,r=[],P(t.arguments,function(s){M(s,e),n=n&&s.constant,s.constant||r.push.apply(r,s.toWatch)}),t.constant=n,t.toWatch=i?r:[t];break;case v.AssignmentExpression:M(t.left,e),M(t.right,e),t.constant=t.left.constant&&t.right.constant,t.toWatch=[t];break;case v.ArrayExpression:n=!0,r=[],P(t.elements,function(s){M(s,e),n=n&&s.constant,s.constant||r.push.apply(r,s.toWatch)}),t.constant=n,t.toWatch=r;break;case v.ObjectExpression:n=!0,r=[],P(t.properties,function(s){M(s.value,e),n=n&&s.value.constant&&!s.computed,s.value.constant||r.push.apply(r,s.value.toWatch)}),t.constant=n,t.toWatch=r;break;case v.ThisExpression:t.constant=!1,t.toWatch=[];break;case v.LocalsExpression:t.constant=!1,t.toWatch=[];break}}function Gr(t){if(t.length===1){var e=t[0].expression,n=e.toWatch;return n.length!==1||n[0]!==e?n:void 0}}function Vr(t){return t.type===v.Identifier||t.type===v.MemberExpression}function Jr(t){if(t.body.length===1&&Vr(t.body[0].expression))return{type:v.AssignmentExpression,left:t.body[0].expression,right:{type:v.NGValueParameter},operator:"="}}function Zr(t){return t.body.length===0||t.body.length===1&&(t.body[0].expression.type===v.Literal||t.body[0].expression.type===v.ArrayExpression||t.body[0].expression.type===v.ObjectExpression)}function Yr(t){return t.constant}function Xr(t,e){this.astBuilder=t,this.$filter=e}Xr.prototype={compile:function(t){var e=this,n=this.astBuilder.ast(t);this.state={nextId:0,filters:{},fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]},M(n,e.$filter);var r="",i;if(this.stage="assign",i=Jr(n)){this.state.computing="assign";var s=this.nextId();this.recurse(i,s),this.return_(s),r="fn.assign="+this.generateFunction("assign","s,v,l")}var a=Gr(n.body);e.stage="inputs",P(a,function(c,u){var f="fn"+u;e.state[f]={vars:[],body:[],own:{}},e.state.computing=f;var h=e.nextId();e.recurse(c,h),e.return_(h),e.state.inputs.push(f),c.watchId=u}),this.state.computing="fn",this.stage="main",this.recurse(n);var o='"'+this.USE+" "+this.STRICT+`";
`+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+r+this.watchFns()+"return fn;",l=new Function("$filter","getStringValue","ifDefined","plus",o)(this.$filter,zr,wa,Wr);return this.state=this.stage=void 0,l.ast=n,l.literal=Zr(n),l.constant=Yr(n),l},USE:"use",STRICT:"strict",watchFns:function(){var t=[],e=this.state.inputs,n=this;return P(e,function(r){t.push("var "+r+"="+n.generateFunction(r,"s"))}),e.length&&t.push("fn.inputs=["+e.join(",")+"];"),t.join("")},generateFunction:function(t,e){return"function("+e+"){"+this.varsPrefix(t)+this.body(t)+"};"},filterPrefix:function(){var t=[],e=this;return P(this.state.filters,function(n,r){t.push(n+"=$filter("+e.escape(r)+")")}),t.length?"var "+t.join(",")+";":""},varsPrefix:function(t){return this.state[t].vars.length?"var "+this.state[t].vars.join(",")+";":""},body:function(t){return this.state[t].body.join("")},recurse:function(t,e,n,r,i,s){var a,o,l=this,c,u,f;if(r=r||Rn,!s&&De(t.watchId)){e=e||this.nextId(),this.if_("i",this.lazyAssign(e,this.unsafeComputedMember("i",t.watchId)),this.lazyRecurse(t,e,n,r,i,!0));return}switch(t.type){case v.Program:P(t.body,function(p,d){l.recurse(p.expression,void 0,void 0,function(m){o=m}),d!==t.body.length-1?l.current().body.push(o,";"):l.return_(o)});break;case v.Literal:u=this.escape(t.value),this.assign(e,u),r(e||u);break;case v.UnaryExpression:this.recurse(t.argument,void 0,void 0,function(p){o=p}),u=t.operator+"("+this.ifDefined(o,0)+")",this.assign(e,u),r(u);break;case v.BinaryExpression:this.recurse(t.left,void 0,void 0,function(p){a=p}),this.recurse(t.right,void 0,void 0,function(p){o=p}),t.operator==="+"?u=this.plus(a,o):t.operator==="-"?u=this.ifDefined(a,0)+t.operator+this.ifDefined(o,0):u="("+a+")"+t.operator+"("+o+")",this.assign(e,u),r(u);break;case v.LogicalExpression:e=e||this.nextId(),l.recurse(t.left,e),l.if_(t.operator==="&&"?e:l.not(e),l.lazyRecurse(t.right,e)),r(e);break;case v.ConditionalExpression:e=e||this.nextId(),l.recurse(t.test,e),l.if_(e,l.lazyRecurse(t.alternate,e),l.lazyRecurse(t.consequent,e)),r(e);break;case v.Identifier:e=e||this.nextId();var h=l.current().inAssignment;n&&(h?n.context=this.assign(this.nextId(),"s"):n.context=l.stage==="inputs"?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",t.name)+"?l:s"),n.computed=!1,n.name=t.name),l.if_(l.stage==="inputs"||l.not(l.getHasOwnProperty("l",t.name)),function(){l.if_(l.stage==="inputs"||l.and_("s",l.or_(l.isNull(l.nonComputedMember("s",t.name)),l.hasOwnProperty_("s",t.name))),function(){i&&i!==1&&l.if_(l.isNull(l.nonComputedMember("s",t.name)),l.lazyAssign(l.nonComputedMember("s",t.name),"{}")),l.assign(e,l.nonComputedMember("s",t.name))})},e&&l.lazyAssign(e,l.nonComputedMember("l",t.name))),r(e);break;case v.MemberExpression:a=n&&(n.context=this.nextId())||this.nextId(),e=e||this.nextId(),l.recurse(t.object,a,void 0,function(){var p=null,d=l.current().inAssignment;t.computed?(o=l.nextId(),d||l.state.computing==="assign"?p=l.unsafeComputedMember(a,o):p=l.computedMember(a,o)):(d||l.state.computing==="assign"?p=l.unsafeNonComputedMember(a,t.property.name):p=l.nonComputedMember(a,t.property.name),o=t.property.name),t.computed&&t.property.type===v.Literal&&l.recurse(t.property,o),l.if_(l.and_(l.notNull(a),l.or_(l.isNull(p),l.hasOwnProperty_(a,o,t.computed))),function(){t.computed?(t.property.type!==v.Literal&&l.recurse(t.property,o),i&&i!==1&&l.if_(l.not(p),l.lazyAssign(p,"{}")),l.assign(e,p),n&&(n.computed=!0,n.name=o)):(i&&i!==1&&l.if_(l.isNull(p),l.lazyAssign(p,"{}")),l.assign(e,p),n&&(n.computed=!1,n.name=t.property.name))},function(){l.assign(e,"undefined")}),r(e)},!!i);break;case v.CallExpression:e=e||this.nextId(),t.filter?(o=l.filter(t.callee.name),c=[],P(t.arguments,function(p){var d=l.nextId();l.recurse(p,d),c.push(d)}),u=o+".call("+o+","+c.join(",")+")",l.assign(e,u),r(e)):(o=l.nextId(),a={},c=[],l.recurse(t.callee,o,a,function(){l.if_(l.notNull(o),function(){if(P(t.arguments,function(d){l.recurse(d,t.constant?void 0:l.nextId(),void 0,function(m){c.push(m)})}),a.name){var p=l.member(a.context,a.name,a.computed);u="("+p+" === null ? null : "+l.unsafeMember(a.context,a.name,a.computed)+".call("+[a.context].concat(c).join(",")+"))"}else u=o+"("+c.join(",")+")";l.assign(e,u)},function(){l.assign(e,"undefined")}),r(e)}));break;case v.AssignmentExpression:o=this.nextId(),a={},l.current().inAssignment=!0,this.recurse(t.left,void 0,a,function(){l.if_(l.and_(l.notNull(a.context),l.or_(l.hasOwnProperty_(a.context,a.name),l.isNull(l.member(a.context,a.name,a.computed)))),function(){l.recurse(t.right,o),u=l.member(a.context,a.name,a.computed)+t.operator+o,l.assign(e,u),r(e||u)}),l.current().inAssignment=!1,l.recurse(t.right,o),l.current().inAssignment=!0},1),l.current().inAssignment=!1;break;case v.ArrayExpression:c=[],P(t.elements,function(p){l.recurse(p,t.constant?void 0:l.nextId(),void 0,function(d){c.push(d)})}),u="["+c.join(",")+"]",this.assign(e,u),r(e||u);break;case v.ObjectExpression:c=[],f=!1,P(t.properties,function(p){p.computed&&(f=!0)}),f?(e=e||this.nextId(),this.assign(e,"{}"),P(t.properties,function(p){p.computed?(a=l.nextId(),l.recurse(p.key,a)):a=p.key.type===v.Identifier?p.key.name:""+p.key.value,o=l.nextId(),l.recurse(p.value,o),l.assign(l.unsafeMember(e,a,p.computed),o)})):(P(t.properties,function(p){l.recurse(p.value,t.constant?void 0:l.nextId(),void 0,function(d){c.push(l.escape(p.key.type===v.Identifier?p.key.name:""+p.key.value)+":"+d)})}),u="{"+c.join(",")+"}",this.assign(e,u)),r(e||u);break;case v.ThisExpression:this.assign(e,"s"),r(e||"s");break;case v.LocalsExpression:this.assign(e,"l"),r(e||"l");break;case v.NGValueParameter:this.assign(e,"v"),r(e||"v");break}},getHasOwnProperty:function(t,e){var n=t+"."+e,r=this.current().own;return r.hasOwnProperty(n)||(r[n]=this.nextId(!1,t+"&&("+this.escape(e)+" in "+t+")")),r[n]},assign:function(t,e){if(!!t)return this.current().body.push(t,"=",e,";"),t},filter:function(t){return this.state.filters.hasOwnProperty(t)||(this.state.filters[t]=this.nextId(!0)),this.state.filters[t]},ifDefined:function(t,e){return"ifDefined("+t+","+this.escape(e)+")"},plus:function(t,e){return"plus("+t+","+e+")"},return_:function(t){this.current().body.push("return ",t,";")},if_:function(t,e,n){if(t===!0)e();else{var r=this.current().body;r.push("if(",t,"){"),e(),r.push("}"),n&&(r.push("else{"),n(),r.push("}"))}},or_:function(t,e){return"("+t+") || ("+e+")"},hasOwnProperty_:function(t,e,n){return n?"(Object.prototype.hasOwnProperty.call("+t+","+e+"))":"(Object.prototype.hasOwnProperty.call("+t+",'"+e+"'))"},and_:function(t,e){return"("+t+") && ("+e+")"},not:function(t){return"!("+t+")"},isNull:function(t){return t+"==null"},notNull:function(t){return t+"!=null"},nonComputedMember:function(t,e){var n=/^[$_a-zA-Z][$_a-zA-Z0-9]*$/,r=/[^$_a-zA-Z0-9]/g,i="";return n.test(e)?i=t+"."+e:(e=e.replace(r,this.stringEscapeFn),i=t+'["'+e+'"]'),i},unsafeComputedMember:function(t,e){return t+"["+e+"]"},unsafeNonComputedMember:function(t,e){return this.nonComputedMember(t,e)},computedMember:function(t,e){return this.state.computing==="assign"?this.unsafeComputedMember(t,e):"("+t+".hasOwnProperty("+e+") ? "+t+"["+e+"] : null)"},unsafeMember:function(t,e,n){return n?this.unsafeComputedMember(t,e):this.unsafeNonComputedMember(t,e)},member:function(t,e,n){return n?this.computedMember(t,e):this.nonComputedMember(t,e)},getStringValue:function(t){this.assign(t,"getStringValue("+t+")")},lazyRecurse:function(t,e,n,r,i,s){var a=this;return function(){a.recurse(t,e,n,r,i,s)}},lazyAssign:function(t,e){var n=this;return function(){n.assign(t,e)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)},escape:function(t){if(Mt(t))return"'"+t.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(Dn(t))return t.toString();if(t===!0)return"true";if(t===!1)return"false";if(t===null)return"null";if(typeof t>"u")return"undefined";throw je("esc","IMPOSSIBLE")},nextId:function(t,e){var n="v"+this.state.nextId++;return t||this.current().vars.push(n+(e?"="+e:"")),n},current:function(){return this.state[this.state.computing]}};function Qr(t,e){this.astBuilder=t,this.$filter=e}Qr.prototype={compile:function(t){var e=this,n=this.astBuilder.ast(t);M(n,e.$filter);var r,i;(r=Jr(n))&&(i=this.recurse(r));var s=Gr(n.body),a;s&&(a=[],P(s,function(c,u){var f=e.recurse(c);c.input=f,a.push(f),c.watchId=u}));var o=[];P(n.body,function(c){o.push(e.recurse(c.expression))});var l=n.body.length===0?Rn:n.body.length===1?o[0]:function(c,u){var f;return P(o,function(h){f=h(c,u)}),f};return i&&(l.assign=function(c,u,f){return i(c,f,u)}),a&&(l.inputs=a),l.ast=n,l.literal=Zr(n),l.constant=Yr(n),l},recurse:function(t,e,n){var r,i,s=this,a;if(t.input)return this.inputs(t.input,t.watchId);switch(t.type){case v.Literal:return this.value(t.value,e);case v.UnaryExpression:return i=this.recurse(t.argument),this["unary"+t.operator](i,e);case v.BinaryExpression:return r=this.recurse(t.left),i=this.recurse(t.right),this["binary"+t.operator](r,i,e);case v.LogicalExpression:return r=this.recurse(t.left),i=this.recurse(t.right),this["binary"+t.operator](r,i,e);case v.ConditionalExpression:return this["ternary?:"](this.recurse(t.test),this.recurse(t.alternate),this.recurse(t.consequent),e);case v.Identifier:return s.identifier(t.name,e,n);case v.MemberExpression:return r=this.recurse(t.object,!1,!!n),t.computed||(i=t.property.name),t.computed&&(i=this.recurse(t.property)),t.computed?this.computedMember(r,i,e,n):this.nonComputedMember(r,i,e,n);case v.CallExpression:return a=[],P(t.arguments,function(o){a.push(s.recurse(o))}),t.filter&&(i=this.$filter(t.callee.name)),t.filter||(i=this.recurse(t.callee,!0)),t.filter?function(o,l,c,u){for(var f=[],h=0;h<a.length;++h)f.push(a[h](o,l,c,u));var p=i.apply(void 0,f,u);return e?{context:void 0,name:void 0,value:p}:p}:function(o,l,c,u){var f=i(o,l,c,u),h;if(f.value!=null){for(var p=[],d=0;d<a.length;++d)p.push(a[d](o,l,c,u));h=f.value.apply(f.context,p)}return e?{value:h}:h};case v.AssignmentExpression:return r=this.recurse(t.left,!0,1),i=this.recurse(t.right),function(o,l,c,u){var f=r(o,!1,c,u),h=i(o,l,c,u);return f.context[f.name]=h,e?{value:h}:h};case v.ArrayExpression:return a=[],P(t.elements,function(o){a.push(s.recurse(o))}),function(o,l,c,u){for(var f=[],h=0;h<a.length;++h)f.push(a[h](o,l,c,u));return e?{value:f}:f};case v.ObjectExpression:return a=[],P(t.properties,function(o){o.computed?a.push({key:s.recurse(o.key),computed:!0,value:s.recurse(o.value)}):a.push({key:o.key.type===v.Identifier?o.key.name:""+o.key.value,computed:!1,value:s.recurse(o.value)})}),function(o,l,c,u){for(var f={},h=0;h<a.length;++h)a[h].computed?f[a[h].key(o,l,c,u)]=a[h].value(o,l,c,u):f[a[h].key]=a[h].value(o,l,c,u);return e?{value:f}:f};case v.ThisExpression:return function(o){return e?{value:o}:o};case v.LocalsExpression:return function(o,l){return e?{value:l}:l};case v.NGValueParameter:return function(o,l,c){return e?{value:c}:c}}},"unary+":function(t,e){return function(n,r,i,s){var a=t(n,r,i,s);return De(a)?a=+a:a=0,e?{value:a}:a}},"unary-":function(t,e){return function(n,r,i,s){var a=t(n,r,i,s);return De(a)?a=-a:a=-0,e?{value:a}:a}},"unary!":function(t,e){return function(n,r,i,s){var a=!t(n,r,i,s);return e?{value:a}:a}},"binary+":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a),l=e(r,i,s,a),c=Wr(o,l);return n?{value:c}:c}},"binary-":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a),l=e(r,i,s,a),c=(De(o)?o:0)-(De(l)?l:0);return n?{value:c}:c}},"binary*":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)*e(r,i,s,a);return n?{value:o}:o}},"binary/":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)/e(r,i,s,a);return n?{value:o}:o}},"binary%":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)%e(r,i,s,a);return n?{value:o}:o}},"binary===":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)===e(r,i,s,a);return n?{value:o}:o}},"binary!==":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)!==e(r,i,s,a);return n?{value:o}:o}},"binary==":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)==e(r,i,s,a);return n?{value:o}:o}},"binary!=":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)!=e(r,i,s,a);return n?{value:o}:o}},"binary<":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)<e(r,i,s,a);return n?{value:o}:o}},"binary>":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)>e(r,i,s,a);return n?{value:o}:o}},"binary<=":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)<=e(r,i,s,a);return n?{value:o}:o}},"binary>=":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)>=e(r,i,s,a);return n?{value:o}:o}},"binary&&":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)&&e(r,i,s,a);return n?{value:o}:o}},"binary||":function(t,e,n){return function(r,i,s,a){var o=t(r,i,s,a)||e(r,i,s,a);return n?{value:o}:o}},"ternary?:":function(t,e,n,r){return function(i,s,a,o){var l=t(i,s,a,o)?e(i,s,a,o):n(i,s,a,o);return r?{value:l}:l}},value:function(t,e){return function(){return e?{context:void 0,name:void 0,value:t}:t}},identifier:function(t,e,n){return function(r,i,s,a){var o=i&&t in i?i:r;n&&n!==1&&o&&o[t]==null&&(o[t]={});var l=o?o[t]:void 0;return e?{context:o,name:t,value:l}:l}},computedMember:function(t,e,n,r){return function(i,s,a,o){var l=t(i,s,a,o),c,u;return l!=null&&(c=e(i,s,a,o),c=zr(c),r&&r!==1&&l&&!l[c]&&(l[c]={}),Object.prototype.hasOwnProperty.call(l,c)&&(u=l[c])),n?{context:l,name:c,value:u}:u}},nonComputedMember:function(t,e,n,r){return function(i,s,a,o){var l=t(i,s,a,o);r&&r!==1&&l&&l[e]==null&&(l[e]={});var c=void 0;return l!=null&&Object.prototype.hasOwnProperty.call(l,e)&&(c=l[e]),n?{context:l,name:e,value:c}:c}},inputs:function(t,e){return function(n,r,i,s){return s?s[e]:t(n,r,i)}}};var fn=function(e,n,r){this.lexer=e,this.$filter=n,this.options=r,this.ast=new v(e,r),this.astCompiler=r.csp?new Qr(this.ast,n):new Xr(this.ast,n)};fn.prototype={constructor:fn,parse:function(t){return this.astCompiler.compile(t)}};Ln.Lexer=un;Ln.Parser=fn;var ei=Ln,ti={},ni=ei.Lexer,ri=ei.Parser;function et(t,e){e=e||{};var n;if(typeof t!="string")throw new TypeError("src must be a string, instead saw '"+typeof t+"'");var r={csp:!1,expensiveChecks:!0,literals:{true:!0,false:!1,null:null,undefined:void 0}},i=new ni(e),s=new ri(i,function(o){return ti[o]},r);return et.cache?(n=et.cache[t],n||(n=et.cache[t]=s.parse(t)),n):s.parse(t)}et.cache=Object.create(null);He.Lexer=ni;He.Parser=ri;He.compile=et;He.filters=ti;const w={state:null,data:null,actions:null,tree:null,patterns:null,method:null,cues:null,monitor:null,toolbar:null,restart:null};function ht(t){return function(e){return function(n){return t(n||"",e)}}}function $a(t){return function(e){return function(n){return t(n||0,e)}}}const Un={increment:$a((t,e)=>t+e),add_word:ht((t,e)=>t+e+" "),add_letter:ht((t,e)=>t+e),replace_last:ht((t,e)=>t.replace(/\w+\s*$/,e)),replace_last_letter:ht((t,e)=>t.slice(0,-1)+e),random:t=>{let e=t.split(",");return e[Math.floor(Math.random()*e.length)]},log:(...t)=>t};function ii(t){let e=t.replaceAll(/(?<![=<>!])=/g,"==");return e=e.replaceAll(/[$#]\w+/g,"access('$&')"),e}function si(t,e){return function(n){if(!n)return"";if(t&&n.startsWith("$"))return t.get(n);if(e&&n.startsWith("#")){const r=e[n.slice(1)];return r??""}return""}}function lr(t){const e=ii(t),n=He.compile(e);return r=>n({...Un,access:si(w.state,r),...r})}function cr(t,e){const n=ii(t);return He.compile(n)({...e,access:si(e.state,e.data)})}const ai={equals:(t,e)=>t.localeCompare(e,void 0,{sensitivity:"base"})===0||t==="*"||e==="*","less than":(t,e)=>t.localeCompare(e,void 0,{numeric:!0})<0,"starts with":(t,e)=>t.toUpperCase().startsWith(e.toUpperCase())||t==="*"||e==="*",empty:t=>!t,"not empty":t=>!!t};function ur(t,e){const n=e[t.field.slice(1)]||"";let r=t.value||"";const i=ai[t.operator];return i(n.toString(),r.toString())}class bt{constructor(e){this.allrows=Array.isArray(e)&&e||[],this.allFields=e.reduce((n,r)=>Array.from(new Set([...n,...Object.keys(r).map(i=>"#"+i)])),[]),this.loadTime=new Date}getMatchingRows(e,n,r){const i=e.map(a=>Object.assign({},a,{value:cr(a.value,{state:n})}));if(r){const a=JSON.stringify(i);if(r.key==a&&r.loadTime==this.loadTime)return r.updated=!1,r.rows;r.key=a}const s=this.allrows.filter(a=>i.every(o=>ur(o,a)));return r&&(r.rows=s,r.updated=!0,r.loadTime=this.loadTime),s}hasMatchingRows(e,n,r){const i=e.map(a=>Object.assign({},a,{value:cr(a.value,{state:n})}));if(r){const a=JSON.stringify(i);if(r.key==a&&r.loadTime==this.loadTime)return r.updated=!1,r.result;r.key=a}const s=this.allrows.some(a=>i.every(o=>ur(o,a)));return r&&(r.result=s,r.updated=!0,r.loadTime=this.loadTime),s}}const Ca=Object.assign||((t,e)=>(e&&Object.keys(e).forEach(n=>t[n]=e[n]),t)),dn=(t,e,n)=>{const r=typeof n;if(n&&r==="object")if(Array.isArray(n))for(const i of n)e=dn(t,e,i);else for(const i of Object.keys(n)){const s=n[i];typeof s=="function"?e[i]=s(e[i],ke):s===void 0?t&&!isNaN(i)?e.splice(i,1):delete e[i]:s===null||typeof s!="object"||Array.isArray(s)?e[i]=s:typeof e[i]=="object"?e[i]=s===e[i]?s:ke(e[i],s):e[i]=dn(!1,{},s)}else r==="function"&&(e=n(e,ke));return e},ke=(t,...e)=>{const n=Array.isArray(t);return dn(n,n?t.slice():Ca({},t),e)};class Bn{constructor(e=""){if(this.persistKey=e,this.listeners=new Set,this.values={},this.updated=new Set,this.persistKey){const n=window.sessionStorage.getItem(this.persistKey);n&&(this.values=JSON.parse(n))}}get(e,n=""){if(e&&e.length)return e.split(".").reduce((r,i)=>r?r[i]:n,this.values)}update(e={}){for(const s in e)this.updated.add(s);const n=this.values;this.values=ke(n,e);const r=new Set([...Object.keys(n),...Object.keys(this.values)]),i=new Set([...r].filter(s=>n[s]!==this.values[s]));for(const s of this.listeners)s(i);if(this.persistKey){const s=JSON.stringify(this.values);window.sessionStorage.setItem(this.persistKey,s)}}clone(e={}){const n=new Bn;return n.values=ke(this.values,e),n}clear(){const e=Object.keys(this.values).filter(r=>r.startsWith("$")),n=Object.fromEntries(e.map(r=>[r,void 0]));this.update(n)}observe(e){this.listeners.add(e)}hasBeenUpdated(e){const n=this.updated.has(e);return n&&this.updated.delete(e),n}define(e,n){typeof this.values[e]>"u"&&(this.values[e]=n)}interpolate(e){let n=e.replace(/(\$[a-zA-Z0-9_.]+)/,(r,i)=>this.get(i));return n=n.replace(/\$\{([a-zA-Z0-9_.]+)}/,(r,i)=>this.get("$"+i)),n}}class re{label="";value;id="";container=null;initialize(e,n,r){this.id=`${r.id}-${e}`,this.container=r,n!=null&&this.set(n),this.label=this.label||e.replace(/(?!^)([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase())}get valueAsNumber(){return parseFloat(this.value)}options={};constructor(e={}){this.options=e,"label"in e&&(this.label=e.label)}eval(e={}){return this.value}input(){return g`<!--empty-->`}set(e){this.value=e}update(){this.container.update()}}function oi(t){return Array.isArray(t)?new Map(t.map(e=>[e,e])):t}class U extends re{constructor(e=[],n={}){super(n),this.choices=oi(e),this.value=""}input(e=null){return e||(e=this.choices),g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <select
        id=${this.id}
        required
        title=${this.options.title}
        onchange=${({target:n})=>{this.value=n.value,console.log("select",this,this.value,n.value),this.update()}}
      >
        <option value="" disabled ?selected=${!e.has(this.value)}>
          ${this.options.placeholder||"Choose one..."}
        </option>
        ${[...e.entries()].map(([n,r])=>g`<option value=${n} ?selected=${this.value==n}>
              ${r}
            </option>`)}
      </select></label
    >`}set(e){this.value=e}}class _n extends U{input(e=null){return e||(e=oi([...w.data.allFields,"#ComponentName"].sort())),super.input(e)}}class li extends U{container=null;update(){this.container.replace(this.value)}}class k extends re{value="";constructor(e="",n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <input
        type="text"
        .value=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.value,this.update()}}
        title=${this.options.title}
        placeholder=${this.options.placeholder}
      />
    </label>`}}class _e extends re{value=0;constructor(e=0,n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <input
        type="number"
        .value=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.value,this.update()}}
        title=${this.options.title}
        placeholder=${this.options.placeholder}
      />
    </label>`}}class R extends re{value=0;constructor(e=0,n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <input
        type="number"
        .value=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.value,this.update()}}
        title=${this.options.title}
        placeholder=${this.options.placeholder}
        step="any"
      />
    </label>`}}class Rt extends re{value=!1;constructor(e=!1,n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <input
        type="checkbox"
        ?checked=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.checked,this.update()}}
        title=${this.options.title}
      />
    </label>`}set(e){typeof e=="boolean"?this.value=e:typeof e=="string"&&(this.value=e==="true")}}class Dt extends re{constructor(){super({}),this.value="id"+Date.now().toString(36)+Math.random().toString(36).slice(2)}}class jt extends re{compiled=null;constructor(e="",n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <input
        type="text"
        .value=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.value,this.compiled=lr(this.value),console.log("compiled",this.compiled),this.update()}}
        title=${this.options.title}
        placeholder=${this.options.placeholder}
      />
    </label>`}set(e){this.value=e,this.compiled=lr(this.value)}eval(e){if(this.compiled)return this.compiled(e)}}class ka extends re{value="";constructor(e="",n={}){super(n),this.value=e}input(){return g`<label
      ?hiddenLabel=${this.options.hiddenLabel}
      style="width:100%"
    >
      <span>${this.label}</span>
      <textarea
        type="text"
        .value=${this.value}
        id=${this.id}
        onchange=${({target:e})=>{this.value=e.value,this.update()}}
        title=${this.options.title}
        placeholder=${this.options.placeholder}
      ></textarea>
    </label>`}}class he extends re{value="#ffffff";constructor(e="",n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <color-input
        .value=${this.value}
        id=${this.id}
        onchange=${e=>{this.value=e.target.value,this.update()}}
      />
    </label>`}}class Sa extends re{value="";constructor(e="",n={}){super(n),this.value=e}input(){return g`<label ?hiddenLabel=${this.options.hiddenLabel}>
      <span>${this.label}</span>
      <select
        is="select-voice"
        .value=${this.value}
        id=${this.id}
        onchange=${e=>{this.value=e.target.value,this.update()}}
      >
        <option value="">Default</option>
      </select></label
    >`}}function Aa(t,e=[]){let n=0;return t=t||"",t.split(/(\$\$.*?\$\$)/).map(r=>{const i=r.match(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/);return i?g`<b>${e[n++]||i.groups?.value||""}</b>`:g`${r}`})}function ci(t,e){return t.replaceAll(/{{\s*(\w+)\s*}}/g,(n,r)=>e[r]?.toString()||"")}function Ea(t){return t.replace(/(?!^)([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}/*! (c) Andrea Giammarchi */const{iterator:Je}=Symbol,Na=()=>{};class Pa extends Map{#t=(e,n)=>{super.delete(e),this.#e.unregister(n)};#n=(e,[n,r])=>{const i=n.deref();return i||(this.#t(e,n),r(e,this)),i};#e=new FinalizationRegistry(e=>{const n=super.get(e);n&&(super.delete(e),n[1](e,this))});constructor(e){if(super(),e)for(const[n,r]of e)this.set(n,r)}clear(){for(const[e,[n]]of super[Je]())this.#e.unregister(n);super.clear()}delete(e){const n=super.get(e);return!!n&&!this.#t(e,n[0])}forEach(e,n){for(const[r,i]of this)e.call(n,i,r,this)}get(e){const n=super.get(e);return n&&this.#n(e,n)}has(e){return!!this.get(e)}set(e,n,r=Na){super.delete(e);const i=new WeakRef(n);return this.#e.register(n,e,i),super.set(e,[i,r])}*[Je](){for(const[e,n]of super[Je]()){const r=this.#n(e,n);r&&(yield[e,r])}}*entries(){yield*this[Je]()}*values(){for(const[e,n]of this[Je]())yield n}}class b{children=[];parent=null;allowedChildren=[];allowDelete=!0;static treeBaseCounter=0;id=`TreeBase-${b.treeBaseCounter++}`;static idMap=new Pa;static componentFromId(e){const n=e.match(/TreeBase-\d+/);return n?this.idMap.get(n[0]):null}designer={};static nameToClass=new Map;static classToName=new Map;static register(e,n){this.nameToClass.set(n,e),this.classToName.set(e,n)}get className(){return b.classToName.get(this.constructor)}get props(){return Object.fromEntries(Object.entries(this).filter(([e,n])=>n instanceof re).map(([e,n])=>[e,n.value]))}get propsAsProps(){return Object.fromEntries(Object.entries(this).filter(([e,n])=>n instanceof re))}toObject(){const e=this.props,n=this.children.map(r=>r.toObject());return{className:this.className,props:e,children:n}}init(){}static create(e,n=null,r={}){const i=typeof e=="string"?b.nameToClass.get(e):e,s=new i;for(const[a,o]of Object.entries(s.propsAsProps))o.initialize(a,r[a],s);return n&&(s.parent=n,n.children.push(s)),s.init(),b.idMap.set(s.id,s),s}static fromObject(e,n=null){const r={audio:"Audio",stack:"Stack",page:"Page",grid:"Grid",speech:"Speech",button:"Button",logger:"Logger",gap:"Gap",option:"Option",radio:"Radio",vsd:"VSD","modal dialog":"ModalDialog","tab control":"TabControl","tab panel":"TabPanel",display:"Display"};if(e||console.trace("fromObject",e),"type"in e){const o={children:[...e.children]};e.type==="grid"&&"filters"in e.props&&(o.children=e.props.filters.map(u=>({className:"GridFilter",props:{...u},children:[]}))),o.className=r[e.type];const{filters:l,...c}=e.props;o.props=c,e=o}const i=e.className,s=this.nameToClass.get(i);if(!s)throw console.trace("className not found",i,e),new Error("className not found");const a=this.create(s,n,e.props);for(const o of e.children)o instanceof b?(o.parent=a,a.children.push(o)):b.fromObject(o,a);if(a instanceof this)return a;throw console.error("expected",this),console.error("got",a),new Error("fromObject failed")}update(){let e=this,n=e;for(;n;)n.onUpdate(e),n=n.parent}onUpdate(e){}settings(){return g`<details class=${this.className}>
        <summary id=${this.id+"-settings"}>${this.settingsSummary()}</summary>
        ${this.settingsDetails()}
      </details>
      ${this.orderedChildren()}`}settingsSummary(){const e=this.hasOwnProperty("name")?this.name.value:"";return g`${Ea(this.className)} ${e}`}settingsDetails(){const e=this.propsAsProps,n=Object.values(e).map(r=>r.input());return g`${n}`}template(){return g`<!--empty-->`}swap(e,n){const r=this.children;[r[e],r[n]]=[r[n],r[e]]}remove(){const e=this.parent.children,n=e.indexOf(this),r=this.parent;return this.parent=null,e.splice(n,1),e.length>n?e[n].id:e.length>0?e[e.length-1].id:r.id}listChildren(e=this.children){return e.map(n=>g.for(n)`<li>${n.settings()}</li>`)}orderedChildren(e=this.children){return g`<ol>
      ${this.listChildren(e)}
    </ol>`}unorderedChildren(e=this.children){return g`<ul>
      ${this.listChildren(e)}
    </ul>`}nearestParent(e){let n=this.parent;for(;n;){if(n instanceof e)return n;n=n.parent}return null}filterChildren(e){const n=[];for(const r of this.children)r instanceof e&&n.push(r);return n}all(e,n){const r=new Set;for(const[i,s]of Object.entries(this.props))if((!n||n.indexOf(i)>=0)&&s instanceof k)for(const[a]of s.value.matchAll(e))r.add(a);for(const i of this.children)for(const s of i.all(e,n))r.add(s);return r}allStates(){return this.all(/\$\w+/g)}getMenuActions(){const e=[];for(const n of this.allowedChildren)e.push(new ui(this,n));if(this.allowDelete&&e.push(new fi(this,this.className)),this.parent){const n=this.parent.children.indexOf(this);n>0&&e.push(new hn(this,this.className,n,-1)),n<this.parent.children.length-1&&e.push(new hn(this,this.className,n,1))}return e}}class Fn{component=null;className="";apply(){return""}}class ui extends Fn{constructor(e,n){super(),this.component=e,this.className=n}apply(){return b.create(this.className,this.component).id}}class fi extends Fn{constructor(e,n){super(),this.component=e,this.className=n}apply(){const e=this.component.remove();return console.log({nextId:e}),e}}class hn extends Fn{constructor(e,n,r,i){super(),this.component=e,this.className=n,this.index=r,this.step=i}apply(){return this.component.parent.swap(this.index,this.index+this.step),this.component.id}}class di extends b{replace(e){if(console.log("replacing",this.className,e),this.className==e)return;const n=this.props,r=b.create(e,null,n),i=this.parent.children.indexOf(this);this.parent.children[i]=r,r.parent=this.parent,this.update()}}function st(...t){performance.now()}const Kn={"pinkish white":"#fff6f6","very pale pink":"#ffe2e2","pale pink":"#ffc2c2","light pink":"#ff9e9e","light brilliant red":"#ff6565","luminous vivid red":"#ff0000","pinkish gray":"#e7dada","pale grayish pink":"#e7b8b8",pink:"#e78b8b","brilliant red":"#e75151","vivid red":"#e70000","reddish gray":"#a89c9c","grayish red":"#a87d7d","moderate red":"#a84a4a","strong red":"#a80000","reddish brownish gray":"#595353","dark grayish reddish brown":"#594242","reddish brown":"#592727","deep reddish brown":"#590000","reddish brownish black":"#1d1a1a","very reddish brown":"#1d1111","very deep reddish brown":"#1d0000","pale scarlet":"#ffc9c2","very light scarlet":"#ffaa9e","light brilliant scarlet":"#ff7865","luminous vivid scarlet":"#ff2000","light scarlet":"#e7968b","brilliant scarlet":"#e76451","vivid scarlet":"#e71d00","moderate scarlet":"#a8554a","strong scarlet":"#a81500","dark scarlet":"#592d27","deep scarlet":"#590b00","very pale vermilion":"#ffe9e2","pale vermilion":"#ffd1c2","very light vermilion":"#ffb69e","light brilliant vermilion":"#ff8b65","luminous vivid vermilion":"#ff4000","pale, light grayish vermilion":"#e7c4b8","light vermilion":"#e7a28b","brilliant vermilion":"#e77751","vivid vermilion":"#e73a00","grayish vermilion":"#a8887d","moderate vermilion":"#a8614a","strong vermilion":"#a82a00","dark grayish vermilion":"#594842","dark vermilion":"#593427","deep vermilion":"#591600","pale tangelo":"#ffd9c2","very light tangelo":"#ffc29e","light brilliant tangelo":"#ff9f65","luminous vivid tangelo":"#ff6000","light tangelo":"#e7ae8b","brilliant tangelo":"#e78951","vivid tangelo":"#e75700","moderate tangelo":"#a86d4a","strong tangelo":"#a83f00","dark tangelo":"#593a27","deep tangelo":"#592100","very pale orange":"#fff0e2","pale orange":"#ffe0c2","very light orange":"#ffcf9e","light brilliant orange":"#ffb265","luminous vivid orange":"#ff8000","pale, light grayish brown":"#e7d0b8","light orange":"#e7b98b","brilliant orange":"#e79c51","vivid orange":"#e77400","grayish brown":"#a8937d","moderate orange":"#a8794a","strong orange":"#a85400","dark grayish brown":"#594e42",brown:"#594027","deep brown":"#592d00","very brown":"#1d1711","very deep brown":"#1d0e00","pale gamboge":"#ffe8c2","very light gamboge":"#ffdb9e","light brilliant gamboge":"#ffc565","luminous vivid gamboge":"#ff9f00","light gamboge":"#e7c58b","brilliant gamboge":"#e7af51","vivid gamboge":"#e79100","moderate gamboge":"#a8854a","strong gamboge":"#a86900","dark gamboge":"#594627","deep gamboge":"#593800","very pale amber":"#fff8e2","pale amber":"#fff0c2","very light amber":"#ffe79e","light brilliant amber":"#ffd865","luminous vivid amber":"#ffbf00","pale, light grayish amber":"#e7dcb8","light amber":"#e7d08b","brilliant amber":"#e7c251","vivid amber":"#e7ae00","grayish amber":"#a89e7d","moderate amber":"#a8914a","strong amber":"#a87e00","dark grayish amber":"#595442","dark amber":"#594d27","deep amber":"#594300","pale gold":"#fff7c2","very light gold":"#fff39e","light brilliant gold":"#ffec65","luminous vivid gold":"#ffdf00","light gold":"#e7dc8b","brilliant gold":"#e7d551","vivid gold":"#e7ca00","moderate gold":"#a89c4a","strong gold":"#a89300","dark gold":"#595327","deep gold":"#594e00","yellowish white":"#fffff6","very pale yellow":"#ffffe2","pale yellow":"#ffffc2","very light yellow":"#ffff9e","light brilliant yellow":"#ffff65","luminous vivid yellow":"#ffff00","light yellowish gray":"#e7e7da","pale, light grayish olive":"#e7e7b8","light yellow":"#e7e78b","brilliant yellow":"#e7e751","vivid yellow":"#e7e700","yellowish gray":"#a8a89c","grayish olive":"#a8a87d","moderate olive":"#a8a84a","strong olive":"#a8a800","dark olivish gray":"#595953","dark grayish olive":"#595942","dark olive":"#595927","deep olive":"#595900","yellowish black":"#1d1d1a","very dark olive":"#1d1d11","very deep olive":"#1d1d00","pale apple green":"#f7ffc2","very light apple green":"#f3ff9e","light brilliant apple green":"#ecff65","luminous vivid apple green":"#dfff00","light apple green":"#dce78b","brilliant apple green":"#d5e751","vivid apple green":"#cae700","moderate apple green":"#9ca84a","strong apple green":"#93a800","dark apple green":"#535927","deep apple green":"#4e5900","very pale lime green":"#f8ffe2","pale lime green":"#f0ffc2","very light lime green":"#e7ff9e","light brilliant lime green":"#d8ff65","luminous vivid lime green":"#bfff00","pale, light grayish lime green":"#dce7b8","light lime green":"#d0e78b","brilliant lime green":"#c2e751","vivid lime green":"#aee700","grayish lime green":"#9ea87d","moderate lime green":"#91a84a","strong lime green":"#7ea800","dark grayish lime green":"#545942","dark lime green":"#4d5927","deep lime green":"#435900","pale spring bud":"#e8ffc2","very light spring bud":"#dbff9e","light brilliant spring bud":"#c5ff65","luminous vivid spring bud":"#9fff00","light spring bud":"#c5e78b","brilliant spring bud":"#afe751","vivid spring bud":"#91e700","moderate spring bud":"#85a84a","strong spring bud":"#69a800","dark spring bud":"#465927","deep spring bud":"#385900","very pale chartreuse green":"#f0ffe2","pale chartreuse green":"#e0ffc2","very light chartreuse green":"#cfff9e","light brilliant chartreuse green":"#b2ff65","luminous vivid chartreuse green":"#80ff00","pale, light grayish chartreuse green":"#d0e7b8","light chartreuse green":"#b9e78b","brilliant chartreuse green":"#9ce751","vivid chartreuse green":"#74e700","grayish chartreuse green":"#93a87d","moderate chartreuse green":"#79a84a","strong chartreuse green":"#54a800","dark grayish chartreuse green":"#4e5942","dark chartreuse green":"#405927","deep chartreuse green":"#2d5900","very dark chartreuse green":"#171d11","very deep chartreuse green":"#0e1d00","pale pistachio":"#d9ffc2","very light pistachio":"#c2ff9e","light brilliant pistachio":"#9fff65","luminous vivid pistachio":"#60ff00","light pistachio":"#aee78b","brilliant pistachio":"#89e751","vivid pistachio":"#57e700","moderate pistachio":"#6da84a","strong pistachio":"#3fa800","dark pistachio":"#3a5927","deep pistachio":"#215900","very pale harlequin":"#e9ffe2","pale harlequin":"#d1ffc2","very light harlequin":"#b6ff9e","light brilliant harlequin":"#8bff65","luminous vivid harlequin":"#40ff00","pale, light grayish harlequin":"#c4e7b8","light harlequin":"#a2e78b","brilliant harlequin":"#77e751","vivid harlequin":"#3ae700","grayish harlequin":"#88a87d","moderate harlequin":"#61a84a","strong harlequin":"#2aa800","dark grayish harlequin":"#485942","dark harlequin":"#345927","deep harlequin":"#165900","pale sap green":"#c9ffc2","very light sap green":"#aaff9e","light brilliant sap green":"#78ff65","luminous vivid sap green":"#20ff00","light sap green":"#96e78b","brilliant sap green":"#64e751","vivid sap green":"#1de700","moderate sap green":"#55a84a","strong sap green":"#15a800","dark sap green":"#2d5927","deep sap green":"#0b5900","greenish white":"#f6fff6","very pale green":"#e2ffe2","pale green":"#c2ffc2","very light green":"#9eff9e","light brilliant green":"#65ff65","luminous vivid green":"#00ff00","light greenish gray":"#dae7da","pale, light grayish green":"#b8e7b8","light green":"#8be78b","brilliant green":"#51e751","vivid green":"#00e700","greenish gray":"#9ca89c","grayish green":"#7da87d","moderate green":"#4aa84a","strong green":"#00a800","dark greenish gray":"#535953","dark grayish green":"#425942","dark green":"#275927","deep green":"#005900","greenish black":"#1a1d1a","very dark green":"#111d11","very deep green":"#001d00","pale emerald green":"#c2ffc9","very light emerald green":"#9effaa","light brilliant emerald green":"#65ff78","luminous vivid emerald green":"#00ff20","light emerald green":"#8be796","brilliant emerald green":"#51e764","vivid emerald green":"#00e71d","moderate emerald green":"#4aa855","strong emerald green":"#00a815","dark emerald green":"#27592d","deep emerald green":"#00590b","very pale malachite green":"#e2ffe9","pale malachite green":"#c2ffd1","very light malachite green":"#9effb6","light brilliant malachite green":"#65ff8b","luminous vivid malachite green":"#00ff40","pale, light grayish malachite green":"#b8e7c4","light malachite green":"#8be7a2","brilliant malachite green":"#51e777","vivid malachite green":"#00e73a","grayish malachite green":"#7da888","moderate malachite green":"#4aa861","strong malachite green":"#00a82a","dark grayish malachite green":"#425948","dark malachite green":"#275934","deep malachite green":"#005916","pale sea green":"#c2ffd9","very light sea green":"#9effc2","light brilliant sea green":"#65ff9f","luminous vivid sea green":"#00ff60","light sea green":"#8be7ae","brilliant sea green":"#51e789","vivid sea green":"#00e757","moderate sea green":"#4aa86d","strong sea green":"#00a83f","dark sea green":"#27593a","deep sea green":"#005921","very pale spring green":"#e2fff0","pale spring green":"#c2ffe0","very light spring green":"#9effcf","light brilliant spring green":"#65ffb2","luminous vivid spring green":"#00ff80","pale, light grayish spring green":"#b8e7d0","light spring green":"#8be7b9","brilliant spring green":"#51e79c","vivid spring green":"#00e774","grayish spring green":"#7da893","moderate spring green":"#4aa879","strong spring green":"#00a854","dark grayish spring green":"#42594e","dark spring green":"#275940","deep spring green":"#00592d","very dark spring green":"#111d17","very deep spring green":"#001d0e","pale aquamarine":"#c2ffe8","very light aquamarine":"#9effdb","light brilliant aquamarine":"#65ffc5","luminous vivid aquamarine":"#00ff9f","light aquamarine":"#8be7c5","brilliant aquamarine":"#51e7af","vivid aquamarine":"#00e791","moderate aquamarine":"#4aa885","strong aquamarine":"#00a869","dark aquamarine":"#275946","deep aquamarine":"#005938","very pale turquoise":"#e2fff8","pale turquoise":"#c2fff0","very light turquoise":"#9effe7","light brilliant turquoise":"#65ffd8","luminous vivid turquoise":"#00ffbf","pale, light grayish turquoise":"#b8e7dc","light turquoise":"#8be7d0","brilliant turquoise":"#51e7c2","vivid turquoise":"#00e7ae","grayish turquoise":"#7da89e","moderate turquoise":"#4aa891","strong turquoise":"#00a87e","dark grayish turquoise":"#425954","dark turquoise":"#27594d","deep turquoise":"#005943","pale opal":"#c2fff7","very light opal":"#9efff3","light brilliant opal":"#65ffec","luminous vivid opal":"#00ffdf","light opal":"#8be7dc","brilliant opal":"#51e7d5","vivid opal":"#00e7ca","moderate opal":"#4aa89c","strong opal":"#00a893","dark opal":"#275953","deep opal":"#00594e","cyanish white":"#f6ffff","very pale cyan":"#e2ffff","pale cyan":"#c2ffff","very light cyan":"#9effff","light brilliant cyan":"#65ffff","luminous vivid cyan":"#00ffff","light cyanish gray":"#dae7e7","pale, light grayish cyan":"#b8e7e7","light cyan":"#8be7e7","brilliant cyan":"#51e7e7","vivid cyan":"#00e7e7","cyanish gray":"#9ca8a8","grayish cyan":"#7da8a8","moderate cyan":"#4aa8a8","strong cyan":"#00a8a8","dark cyanish gray":"#535959","dark grayish cyan":"#425959","dark cyan":"#275959","deep cyan":"#005959","cyanish black":"#1a1d1d","very dark cyan":"#111d1d","very deep cyan":"#001d1d","pale arctic blue":"#c2f7ff","very light arctic blue":"#9ef3ff","light brilliant arctic blue":"#65ecff","luminous vivid arctic blue":"#00dfff","light arctic blue":"#8bdce7","brilliant arctic blue":"#51d5e7","vivid arctic blue":"#00cae7","moderate arctic blue":"#4a9ca8","strong arctic blue":"#0093a8","dark arctic blue":"#275359","deep arctic blue":"#004e59","very pale cerulean":"#e2f8ff","pale cerulean":"#c2f0ff","very light cerulean":"#9ee7ff","light brilliant cerulean":"#65d8ff","luminous vivid cerulean":"#00bfff","pale, light grayish cerulean":"#b8dce7","light cerulean":"#8bd0e7","brilliant cerulean":"#51c2e7","vivid cerulean":"#00aee7","grayish cerulean":"#7d9ea8","moderate cerulean":"#4a91a8","strong cerulean":"#007ea8","dark grayish cerulean":"#425459","dark cerulean":"#274d59","deep cerulean":"#004359","pale cornflower blue":"#c2e8ff","very light cornflower blue":"#9edbff","light brilliant cornflower blue":"#65c5ff","luminous vivid cornflower blue":"#009fff","light cornflower blue":"#8bc5e7","brilliant cornflower blue":"#51afe7","vivid cornflower blue":"#0091e7","moderate cornflower blue":"#4a85a8","strong cornflower blue":"#0069a8","dark cornflower blue":"#274659","deep cornflower blue":"#003859","very pale azure":"#e2f0ff","pale azure":"#c2e0ff","very light azure":"#9ecfff","light brilliant azure":"#65b2ff","luminous vivid azure":"#0080ff","pale, light grayish azure":"#b8d0e7","light azure":"#8bb9e7","brilliant azure":"#519ce7","vivid azure":"#0074e7","grayish azure":"#7d93a8","moderate azure":"#4a79a8","strong azure":"#0054a8","dark grayish azure":"#424e59","dark azure":"#274059","deep azure":"#002d59","very dark azure":"#11171d","very deep azure":"#000e1d","pale cobalt blue":"#c2d9ff","very light cobalt blue":"#9ec2ff","light brilliant cobalt blue":"#659fff","luminous vivid cobalt blue":"#0060ff","light cobalt blue":"#8baee7","brilliant cobalt blue":"#5189e7","vivid cobalt blue":"#0057e7","moderate cobalt blue":"#4a6da8","strong cobalt blue":"#003fa8","dark cobalt blue":"#273a59","deep cobalt blue":"#002159","very pale sapphire blue":"#e2e9ff","pale sapphire blue":"#c2d1ff","very light sapphire blue":"#9eb6ff","light brilliant sapphire blue":"#658bff","luminous vivid sapphire blue":"#0040ff","pale, light grayish sapphire blue":"#b8c4e7","light sapphire blue":"#8ba2e7","brilliant sapphire blue":"#5177e7","vivid sapphire blue":"#003ae7","grayish sapphire blue":"#7d88a8","moderate sapphire blue":"#4a61a8","strong sapphire blue":"#002aa8","dark grayish sapphire blue":"#424859","dark sapphire blue":"#273459","deep sapphire blue":"#001659","pale phthalo blue":"#c2c9ff","very light phthalo blue":"#9eaaff","light brilliant phthalo blue":"#6578ff","luminous vivid phthalo blue":"#0020ff","light phthalo blue":"#8b96e7","brilliant phthalo blue":"#5164e7","vivid phthalo blue":"#001de7","moderate phthalo blue":"#4a55a8","strong phthalo blue":"#0015a8","dark phthalo blue":"#272d59","deep phthalo blue":"#000b59","bluish white":"#f6f6ff","very pale blue":"#e2e2ff","pale blue":"#c2c2ff","very light blue":"#9e9eff","light brilliant blue":"#6565ff","luminous vivid blue":"#0000ff","light bluish gray":"#dadae7","pale, light grayish blue":"#b8b8e7","light blue":"#8b8be7","brilliant blue":"#5151e7","vivid blue":"#0000e7","bluish gray":"#9c9ca8","grayish blue":"#7d7da8","moderate blue":"#4a4aa8","strong blue":"#0000a8","dark bluish gray":"#535359","dark grayish blue":"#424259","dark blue":"#272759","deep blue":"#000059","bluish black":"#1a1a1d","very dark blue":"#11111d","very deep blue":"#00001d","pale persian blue":"#c9c2ff","very light persian blue":"#aa9eff","light brilliant persian blue":"#7865ff","luminous vivid persian blue":"#2000ff","light persian blue":"#968be7","brilliant persian blue":"#6451e7","vivid persian blue":"#1d00e7","moderate persian blue":"#554aa8","strong persian blue":"#1500a8","dark persian blue":"#2d2759","deep persian blue":"#0b0059","very pale indigo":"#e9e2ff","pale indigo":"#d1c2ff","very light indigo":"#b69eff","light brilliant indigo":"#8b65ff","luminous vivid indigo":"#4000ff","pale, light grayish indigo":"#c4b8e7","light indigo":"#a28be7","brilliant indigo":"#7751e7","vivid indigo":"#3a00e7","grayish indigo":"#887da8","moderate indigo":"#614aa8","strong indigo":"#2a00a8","dark grayish indigo":"#484259","dark indigo":"#342759","deep indigo":"#160059","pale blue violet":"#d9c2ff","very light blue violet":"#c29eff","light brilliant blue violet":"#9f65ff","luminous vivid blue violet":"#6000ff","light blue violet":"#ae8be7","brilliant blue violet":"#8951e7","vivid blue violet":"#5700e7","moderate blue violet":"#6d4aa8","strong blue violet":"#3f00a8","dark blue violet":"#3a2759","deep blue violet":"#210059","very pale violet":"#f0e2ff","pale violet":"#e0c2ff","very light violet":"#cf9eff","light brilliant violet":"#b265ff","luminous vivid violet":"#8000ff","pale, light grayish violet":"#d0b8e7","light violet":"#b98be7","brilliant violet":"#9c51e7","vivid violet":"#7400e7","grayish violet":"#937da8","moderate violet":"#794aa8","strong violet":"#5400a8","dark grayish violet":"#4e4259","dark violet":"#402759","deep violet":"#2d0059","very dark violet":"#17111d","very deep violet":"#0e001d","pale purple":"#e8c2ff","very light purple":"#db9eff","light brilliant purple":"#c565ff","luminous vivid purple":"#9f00ff","light purple":"#c58be7","brilliant purple":"#af51e7","vivid purple":"#9100e7","moderate purple":"#854aa8","strong purple":"#6900a8","dark purple":"#462759","deep purple":"#380059","very pale mulberry":"#f8e2ff","pale mulberry":"#f0c2ff","very light mulberry":"#e79eff","light brilliant mulberry":"#d865ff","luminous vivid mulberry":"#bf00ff","pale, light grayish mulberry":"#dcb8e7","light mulberry":"#d08be7","brilliant mulberry":"#c251e7","vivid mulberry":"#ae00e7","grayish mulberry":"#9e7da8","moderate mulberry":"#914aa8","strong mulberry":"#7e00a8","dark grayish mulberry":"#544259","dark mulberry":"#4d2759","deep mulberry":"#430059","pale heliotrope":"#f7c2ff","very light heliotrope":"#f39eff","light brilliant heliotrope":"#ec65ff","luminous vivid heliotrope":"#df00ff","light heliotrope":"#dc8be7","brilliant heliotrope":"#d551e7","vivid heliotrope":"#ca00e7","moderate heliotrope":"#9c4aa8","strong heliotrope":"#9300a8","dark heliotrope":"#532759","deep heliotrope":"#4e0059","magentaish white":"#fff6ff","very pale magenta":"#ffe2ff","pale magenta":"#ffc2ff","very light magenta":"#ff9eff","light brilliant magenta":"#ff65ff","luminous vivid magenta":"#ff00ff","light magentaish gray":"#e7dae7","pale, light grayish magenta":"#e7b8e7","light magenta":"#e78be7","brilliant magenta":"#e751e7","vivid magenta":"#e700e7","magentaish gray":"#a89ca8","grayish magenta":"#a87da8","moderate magenta":"#a84aa8","strong magenta":"#a800a8","dark magentaish gray":"#595359","dark grayish magenta":"#594259","dark magenta":"#592759","deep magenta":"#590059","magentaish black":"#1d1a1d","very dark magenta":"#1d111d","very deep magenta":"#1d001d","pale orchid":"#ffc2f7","very light orchid":"#ff9ef3","light brilliant orchid":"#ff65ec","luminous vivid orchid":"#ff00df","light orchid":"#e78bdc","brilliant orchid":"#e751d5","vivid orchid":"#e700ca","moderate orchid":"#a84a9c","strong orchid":"#a80093","dark orchid":"#592753","deep orchid":"#59004e","very pale fuchsia":"#ffe2f8","pale fuchsia":"#ffc2f0","very light fuchsia":"#ff9ee7","light brilliant fuchsia":"#ff65d8","luminous vivid fuchsia":"#ff00bf","pale, light grayish fuchsia":"#e7b8dc","light fuchsia":"#e78bd0","brilliant fuchsia":"#e751c2","vivid fuchsia":"#e700ae","grayish fuchsia":"#a87d9e","moderate fuchsia":"#a84a91","strong fuchsia":"#a8007e","dark grayish fuchsia":"#594254","dark fuchsia":"#59274d","deep fuchsia":"#590043","pale cerise":"#ffc2e8","very light cerise":"#ff9edb","light brilliant cerise":"#ff65c5","luminous vivid cerise":"#ff009f","light cerise":"#e78bc5","brilliant cerise":"#e751af","vivid cerise":"#e70091","moderate cerise":"#a84a85","strong cerise":"#a80069","dark cerise":"#592746","deep cerise":"#590038","very pale rose":"#ffe2f0","pale rose":"#ffc2e0","very light rose":"#ff9ecf","light brilliant rose":"#ff65b2","luminous vivid rose":"#ff0080","pale, light grayish rose":"#e7b8d0","light rose":"#e78bb9","brilliant rose":"#e7519c","vivid rose":"#e70074","grayish rose":"#a87d93","moderate rose":"#a84a79","strong rose":"#a80054","dark grayish rose":"#59424e","dark rose":"#592740","deep rose":"#59002d","very dark rose":"#1d1117","very deep rose":"#1d000e","pale raspberry":"#ffc2d9","very light raspberry":"#ff9ec2","light brilliant raspberry":"#ff659f","luminous vivid raspberry":"#ff0060","light raspberry":"#e78bae","brilliant raspberry":"#e75189","vivid raspberry":"#e70057","moderate raspberry":"#a84a6d","strong raspberry":"#a8003f","dark raspberry":"#59273a","deep raspberry":"#590021","very pale crimson":"#ffe2e9","pale crimson":"#ffc2d1","very light crimson":"#ff9eb6","light brilliant crimson":"#ff658b","luminous vivid crimson":"#ff0040","pale, light grayish crimson":"#e7b8c4","light crimson":"#e78ba2","brilliant crimson":"#e75177","vivid crimson":"#e7003a","grayish crimson":"#a87d88","moderate crimson":"#a84a61","strong crimson":"#a8002a","dark grayish crimson":"#594248","dark crimson":"#592734","deep crimson":"#590016","pale amaranth":"#ffc2c9","very light amaranth":"#ff9eaa","light brilliant amaranth":"#ff6578","luminous vivid amaranth":"#ff0020","light amaranth":"#e78b96","brilliant amaranth":"#e75164","vivid amaranth":"#e7001d","moderate amaranth":"#a84a55","strong amaranth":"#a80015","dark amaranth":"#59272d","deep amaranth":"#59000b"};function Oa(t){if(t.length==0||t in Kn)return!0;var e=new Option().style;return e.color=t,e.color!==""}function At(t){return Kn[t]||t}function Ta(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n&&n.toString().length).map(([e,n])=>e.toLowerCase().indexOf("color")>=0?[e,At(n)]:[e,n&&n.toString()]))}function pe(t){return Object.entries(Ta(t)).reduce((e,[n,r])=>e+n.split(/(?=[A-Z])/).join("-").toLowerCase()+":"+r+";","")}class Ia extends HTMLElement{value="";name="";tabindex="0";connectedCallback(){this.hasOwnProperty("initialized")||(this.initialized=!0,this.init()),this.render()}static get observedAttributes(){return["name","value","tabindex"]}attributeChangedCallback(e,n,r){st("acc",e,r),this[e]=r,this.render()}init(){if(!document.querySelector("datalist#ColorNames")){const e=g.node`<datalist id="ColorNames">
      ${Object.keys(Kn).map(n=>g`<option value="${n}" />`)}
      </datalist>`;document.body.appendChild(e)}}validate(){const e=this.querySelector("input");if(!e)return"not found";if(!Oa(e.value))e.setCustomValidity("invalid color"),e.reportValidity();else{e.setCustomValidity("");const n=this.querySelector("div");n&&(n.style.background=At(e.value))}}render(){Ee(this,g`<input
          type="text"
          name=${this.name}
          .value=${this.value}
          list="ColorNames"
          onchange=${()=>this.validate()}
          tabindex=${this.tabindex}
        />
        <div
          class="swatch"
          style=${`background-color: ${At(this.value)}`}
        ></div>`)}}customElements.define("color-input",Ia);class Ut extends b{direction=new U(["row","column"]);background=new he("");scale=new R(1);allowedChildren=["Stack","Gap","Grid","Display","Radio","TabControl","Vsd","Button"];template(){const e=pe({backgroundColor:this.props.background});function n(a){let l=+a.props.scale;return(!l||l<.1)&&(l=.1),l}const r=this.children.length?"":"empty",i=this.children.reduce((a,o)=>a+n(o),0),s=this.props.direction=="row"?"width":"height";return g`<div
      id=${this.id}
      class=${`stack flex ${this.props.direction} ${r}`}
      style=${e}
    >
      ${this.children.map(a=>g`<div
            style=${pe({[s]:`${100*n(a)/i}%`})}
          >
            ${a.template()}
          </div>`)}
    </div>`}}b.register(Ut,"Stack");const pn=(t,e)=>e.some(n=>t instanceof n);let fr,dr;function La(){return fr||(fr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ma(){return dr||(dr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const hi=new WeakMap,gn=new WeakMap,pi=new WeakMap,Xt=new WeakMap,Bt=new WeakMap;function Ra(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{n(Se(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&hi.set(n,t)}).catch(()=>{}),Bt.set(e,t),e}function Da(t){if(gn.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});gn.set(t,e)}let mn={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return gn.get(t);if(e==="objectStoreNames")return t.objectStoreNames||pi.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Se(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function gi(t){mn=t(mn)}function ja(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(wt(this),e,...n);return pi.set(r,e.sort?e.sort():[e]),Se(r)}:Ma().includes(t)?function(...e){return t.apply(wt(this),e),Se(hi.get(this))}:function(...e){return Se(t.apply(wt(this),e))}}function Ua(t){return typeof t=="function"?ja(t):(t instanceof IDBTransaction&&Da(t),pn(t,La())?new Proxy(t,mn):t)}function Se(t){if(t instanceof IDBRequest)return Ra(t);if(Xt.has(t))return Xt.get(t);const e=Ua(t);return e!==t&&(Xt.set(t,e),Bt.set(e,t)),e}const wt=t=>Bt.get(t);function Ba(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(t,e),o=Se(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Se(a.result),l.oldVersion,l.newVersion,Se(a.transaction),l)}),n&&a.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const _a=["get","getKey","getAll","getAllKeys","count"],Fa=["put","add","delete","clear"],Qt=new Map;function hr(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Qt.get(e))return Qt.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Fa.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||_a.includes(n)))return;const s=async function(a,...o){const l=this.transaction(a,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(o.shift())),(await Promise.all([c[n](...o),i&&l.done]))[0]};return Qt.set(e,s),s}gi(t=>({...t,get:(e,n,r)=>hr(e,n)||t.get(e,n,r),has:(e,n)=>!!hr(e,n)||t.has(e,n)}));const Ka=["continue","continuePrimaryKey","advance"],pr={},vn=new WeakMap,mi=new WeakMap,qa={get(t,e){if(!Ka.includes(e))return t[e];let n=pr[e];return n||(n=pr[e]=function(...r){vn.set(this,mi.get(this)[e](...r))}),n}};async function*Ha(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,qa);for(mi.set(n,e),Bt.set(n,wt(e));e;)yield n,e=await(vn.get(n)||e.continue()),vn.delete(n)}function gr(t,e){return e===Symbol.asyncIterator&&pn(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&pn(t,[IDBIndex,IDBObjectStore])}gi(t=>({...t,get(e,n,r){return gr(e,n)?Ha:t.get(e,n,r)},has(e,n){return gr(e,n)||t.has(e,n)}}));var O=Uint8Array,X=Uint16Array,_t=Uint32Array,Ft=new O([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Kt=new O([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yn=new O([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vi=function(t,e){for(var n=new X(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new _t(n[30]),r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},yi=vi(Ft,2),bi=yi[0],bn=yi[1];bi[28]=258,bn[258]=28;var wi=vi(Kt,0),za=wi[0],mr=wi[1],wn=new X(32768);for(var E=0;E<32768;++E){var $e=(E&43690)>>>1|(E&21845)<<1;$e=($e&52428)>>>2|($e&13107)<<2,$e=($e&61680)>>>4|($e&3855)<<4,wn[E]=(($e&65280)>>>8|($e&255)<<8)>>>1}var de=function(t,e,n){for(var r=t.length,i=0,s=new X(e);i<r;++i)t[i]&&++s[t[i]-1];var a=new X(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(n){o=new X(1<<e);var l=15-e;for(i=0;i<r;++i)if(t[i])for(var c=i<<4|t[i],u=e-t[i],f=a[t[i]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)o[wn[f]>>>l]=c}else for(o=new X(r),i=0;i<r;++i)t[i]&&(o[i]=wn[a[t[i]-1]++]>>>15-t[i]);return o},Ne=new O(288);for(var E=0;E<144;++E)Ne[E]=8;for(var E=144;E<256;++E)Ne[E]=9;for(var E=256;E<280;++E)Ne[E]=7;for(var E=280;E<288;++E)Ne[E]=8;var at=new O(32);for(var E=0;E<32;++E)at[E]=5;var Wa=de(Ne,9,0),Ga=de(Ne,9,1),Va=de(at,5,0),Ja=de(at,5,1),en=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ae=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},tn=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},qn=function(t){return(t+7)/8|0},lt=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t.BYTES_PER_ELEMENT==2?X:t.BYTES_PER_ELEMENT==4?_t:O)(n-e);return r.set(t.subarray(e,n)),r},Za=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Y=function(t,e,n){var r=new Error(e||Za[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,Y),!n)throw r;return r},Ya=function(t,e,n){var r=t.length;if(!r||n&&n.f&&!n.l)return e||new O(0);var i=!e||n,s=!n||n.i;n||(n={}),e||(e=new O(r*3));var a=function(ft){var We=e.length;if(ft>We){var Re=new O(Math.max(We*2,ft));Re.set(e),e=Re}},o=n.f||0,l=n.p||0,c=n.b||0,u=n.l,f=n.d,h=n.m,p=n.n,d=r*8;do{if(!u){o=ae(t,l,1);var m=ae(t,l+1,3);if(l+=3,m)if(m==1)u=Ga,f=Ja,h=9,p=5;else if(m==2){var q=ae(t,l,31)+257,D=ae(t,l+10,15)+4,H=q+ae(t,l+5,31)+1;l+=14;for(var T=new O(H),N=new O(19),$=0;$<D;++$)N[yn[$]]=ae(t,l+$*3,7);l+=D*3;for(var le=en(N),V=(1<<le)-1,Me=de(N,le,1),$=0;$<H;){var B=Me[ae(t,l,V)];l+=B&15;var y=B>>>4;if(y<16)T[$++]=y;else{var Q=0,_=0;for(y==16?(_=3+ae(t,l,3),l+=2,Q=T[$-1]):y==17?(_=3+ae(t,l,7),l+=3):y==18&&(_=11+ae(t,l,127),l+=7);_--;)T[$++]=Q}}var J=T.subarray(0,q),I=T.subarray(q);h=en(J),p=en(I),u=de(J,h,1),f=de(I,p,1)}else Y(1);else{var y=qn(l)+4,x=t[y-4]|t[y-3]<<8,S=y+x;if(S>r){s&&Y(0);break}i&&a(c+x),e.set(t.subarray(y,S),c),n.b=c+=x,n.p=l=S*8,n.f=o;continue}if(l>d){s&&Y(0);break}}i&&a(c+131072);for(var L=(1<<h)-1,ee=(1<<p)-1,ne=l;;ne=l){var Q=u[tn(t,l)&L],ce=Q>>>4;if(l+=Q&15,l>d){s&&Y(0);break}if(Q||Y(2),ce<256)e[c++]=ce;else if(ce==256){ne=l,u=null;break}else{var te=ce-254;if(ce>264){var $=ce-257,se=Ft[$];te=ae(t,l,(1<<se)-1)+bi[$],l+=se}var ue=f[tn(t,l)&ee],Z=ue>>>4;ue||Y(3),l+=ue&15;var I=za[Z];if(Z>3){var se=Kt[Z];I+=tn(t,l)&(1<<se)-1,l+=se}if(l>d){s&&Y(0);break}i&&a(c+131072);for(var F=c+te;c<F;c+=4)e[c]=e[c-I],e[c+1]=e[c+1-I],e[c+2]=e[c+2-I],e[c+3]=e[c+3-I];c=F}}n.l=u,n.p=ne,n.b=c,n.f=o,u&&(o=1,n.m=h,n.d=f,n.n=p)}while(!o);return c==e.length?e:lt(e,0,c)},ve=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8},Ze=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},nn=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,s=n.slice();if(!i)return[Hn,0];if(i==1){var a=new O(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort(function(H,T){return H.f-T.f}),n.push({s:-1,f:25001});var o=n[0],l=n[1],c=0,u=1,f=2;for(n[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=i-1;)o=n[n[c].f<n[f].f?c++:f++],l=n[c!=u&&n[c].f<n[f].f?c++:f++],n[u++]={s:-1,f:o.f+l.f,l:o,r:l};for(var h=s[0].s,r=1;r<i;++r)s[r].s>h&&(h=s[r].s);var p=new X(h+1),d=xn(n[u-1],p,0);if(d>e){var r=0,m=0,y=d-e,x=1<<y;for(s.sort(function(T,N){return p[N.s]-p[T.s]||T.f-N.f});r<i;++r){var S=s[r].s;if(p[S]>e)m+=x-(1<<d-p[S]),p[S]=e;else break}for(m>>>=y;m>0;){var q=s[r].s;p[q]<e?m-=1<<e-p[q]++-1:++r}for(;r>=0&&m;--r){var D=s[r].s;p[D]==e&&(--p[D],++m)}d=e}return[new O(p),d]},xn=function(t,e,n){return t.s==-1?Math.max(xn(t.l,e,n+1),xn(t.r,e,n+1)):e[t.s]=n},vr=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new X(++e),r=0,i=t[0],s=1,a=function(l){n[r++]=l},o=1;o<=e;++o)if(t[o]==i&&o!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=t[o]}return[n.subarray(0,r),e]},Ye=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},$n=function(t,e,n){var r=n.length,i=qn(e+2);t[i]=r&255,t[i+1]=r>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var s=0;s<r;++s)t[i+s+4]=n[s];return(i+4+r)*8},yr=function(t,e,n,r,i,s,a,o,l,c,u){ve(e,u++,n),++i[256];for(var f=nn(i,15),h=f[0],p=f[1],d=nn(s,15),m=d[0],y=d[1],x=vr(h),S=x[0],q=x[1],D=vr(m),H=D[0],T=D[1],N=new X(19),$=0;$<S.length;++$)N[S[$]&31]++;for(var $=0;$<H.length;++$)N[H[$]&31]++;for(var le=nn(N,7),V=le[0],Me=le[1],B=19;B>4&&!V[yn[B-1]];--B);var Q=c+5<<3,_=Ye(i,Ne)+Ye(s,at)+a,J=Ye(i,h)+Ye(s,m)+a+14+3*B+Ye(N,V)+(2*N[16]+3*N[17]+7*N[18]);if(Q<=_&&Q<=J)return $n(e,u,t.subarray(l,l+c));var I,L,ee,ne;if(ve(e,u,1+(J<_)),u+=2,J<_){I=de(h,p,0),L=h,ee=de(m,y,0),ne=m;var ce=de(V,Me,0);ve(e,u,q-257),ve(e,u+5,T-1),ve(e,u+10,B-4),u+=14;for(var $=0;$<B;++$)ve(e,u+3*$,V[yn[$]]);u+=3*B;for(var te=[S,H],se=0;se<2;++se)for(var ue=te[se],$=0;$<ue.length;++$){var Z=ue[$]&31;ve(e,u,ce[Z]),u+=V[Z],Z>15&&(ve(e,u,ue[$]>>>5&127),u+=ue[$]>>>12)}}else I=Wa,L=Ne,ee=Va,ne=at;for(var $=0;$<o;++$)if(r[$]>255){var Z=r[$]>>>18&31;Ze(e,u,I[Z+257]),u+=L[Z+257],Z>7&&(ve(e,u,r[$]>>>23&31),u+=Ft[Z]);var F=r[$]&31;Ze(e,u,ee[F]),u+=ne[F],F>3&&(Ze(e,u,r[$]>>>5&8191),u+=Kt[F])}else Ze(e,u,I[r[$]]),u+=L[r[$]];return Ze(e,u,I[256]),u+L[256]},Xa=new _t([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Hn=new O(0),Qa=function(t,e,n,r,i,s){var a=t.length,o=new O(r+a+5*(1+Math.ceil(a/7e3))+i),l=o.subarray(r,o.length-i),c=0;if(!e||a<8)for(var u=0;u<=a;u+=65535){var f=u+65535;f>=a&&(l[c>>3]=s),c=$n(l,c+1,t.subarray(u,f))}else{for(var h=Xa[e-1],p=h>>>13,d=h&8191,m=(1<<n)-1,y=new X(32768),x=new X(m+1),S=Math.ceil(n/3),q=2*S,D=function(Jt){return(t[Jt]^t[Jt+1]<<S^t[Jt+2]<<q)&m},H=new _t(25e3),T=new X(288),N=new X(32),$=0,le=0,u=0,V=0,Me=0,B=0;u<a;++u){var Q=D(u),_=u&32767,J=x[Q];if(y[_]=J,x[Q]=_,Me<=u){var I=a-u;if(($>7e3||V>24576)&&I>423){c=yr(t,l,0,H,T,N,le,V,B,u-B,c),V=$=le=0,B=u;for(var L=0;L<286;++L)T[L]=0;for(var L=0;L<30;++L)N[L]=0}var ee=2,ne=0,ce=d,te=_-J&32767;if(I>2&&Q==D(u-te))for(var se=Math.min(p,I)-1,ue=Math.min(32767,u),Z=Math.min(258,I);te<=ue&&--ce&&_!=J;){if(t[u+ee]==t[u+ee-te]){for(var F=0;F<Z&&t[u+F]==t[u+F-te];++F);if(F>ee){if(ee=F,ne=te,F>se)break;for(var ft=Math.min(te,F-2),We=0,L=0;L<ft;++L){var Re=u-te+L+32768&32767,xs=y[Re],tr=Re-xs+32768&32767;tr>We&&(We=tr,J=Re)}}}_=J,J=y[_],te+=_-J+32768&32767}if(ne){H[V++]=268435456|bn[ee]<<18|mr[ne];var nr=bn[ee]&31,rr=mr[ne]&31;le+=Ft[nr]+Kt[rr],++T[257+nr],++N[rr],Me=u+ee,++$}else H[V++]=t[u],++T[t[u]]}}c=yr(t,l,s,H,T,N,le,V,B,u-B,c),!s&&c&7&&(c=$n(l,c+1,Hn))}return lt(o,0,r+qn(c)+i)},eo=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t}(),to=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=eo[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}},no=function(t,e,n,r,i){return Qa(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,n,r,!i)},xi=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},fe=function(t,e){return t[e]|t[e+1]<<8},oe=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},rn=function(t,e){return oe(t,e)+oe(t,e+4)*4294967296},j=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function ro(t,e){return no(t,e||{},0,0)}function io(t,e){return Ya(t,e)}var $i=function(t,e,n,r){for(var i in t){var s=t[i],a=e+i,o=r;Array.isArray(s)&&(o=xi(r,s[1]),s=s[0]),s instanceof O?n[a]=[s,o]:(n[a+="/"]=[new O(0),o],$i(s,a,n,r))}},br=typeof TextEncoder<"u"&&new TextEncoder,Cn=typeof TextDecoder<"u"&&new TextDecoder,so=0;try{Cn.decode(Hn,{stream:!0}),so=1}catch{}var ao=function(t){for(var e="",n=0;;){var r=t[n++],i=(r>127)+(r>223)+(r>239);if(n+i>t.length)return[e,lt(t,n-1)];i?i==3?(r=((r&15)<<18|(t[n++]&63)<<12|(t[n++]&63)<<6|t[n++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|t[n++]&63):e+=String.fromCharCode((r&15)<<12|(t[n++]&63)<<6|t[n++]&63):e+=String.fromCharCode(r)}};function Ce(t,e){if(e){for(var n=new O(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(br)return br.encode(t);for(var i=t.length,s=new O(t.length+(t.length>>1)),a=0,o=function(u){s[a++]=u},r=0;r<i;++r){if(a+5>s.length){var l=new O(a+8+(i-r<<1));l.set(s),s=l}var c=t.charCodeAt(r);c<128||e?o(c):c<2048?(o(192|c>>6),o(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|t.charCodeAt(++r)&1023,o(240|c>>18),o(128|c>>12&63),o(128|c>>6&63),o(128|c&63)):(o(224|c>>12),o(128|c>>6&63),o(128|c&63))}return lt(s,0,a)}function Ci(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}else{if(Cn)return Cn.decode(t);var i=ao(t),s=i[0],a=i[1];return a.length&&Y(8),s}}var oo=function(t,e){return e+30+fe(t,e+26)+fe(t,e+28)},lo=function(t,e,n){var r=fe(t,e+28),i=Ci(t.subarray(e+46,e+46+r),!(fe(t,e+8)&2048)),s=e+46+r,a=oe(t,e+20),o=n&&a==4294967295?co(t,s):[a,oe(t,e+24),oe(t,e+42)],l=o[0],c=o[1],u=o[2];return[fe(t,e+10),l,c,i,s+fe(t,e+30)+fe(t,e+32),u]},co=function(t,e){for(;fe(t,e)!=1;e+=4+fe(t,e+2));return[rn(t,e+12),rn(t,e+4),rn(t,e+20)]},kn=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&Y(9),e+=r+4}return e},wr=function(t,e,n,r,i,s,a,o){var l=r.length,c=n.extra,u=o&&o.length,f=kn(c);j(t,e,a!=null?33639248:67324752),e+=4,a!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(s<0&&8),t[e++]=i&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var h=new Date(n.mtime==null?Date.now():n.mtime),p=h.getFullYear()-1980;if((p<0||p>119)&&Y(10),j(t,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,s!=-1&&(j(t,e,n.crc),j(t,e+4,s<0?-s-2:s),j(t,e+8,n.size)),j(t,e+12,l),j(t,e+14,f),e+=16,a!=null&&(j(t,e,u),j(t,e+6,n.attrs),j(t,e+10,a),e+=14),t.set(r,e),e+=l,f)for(var d in c){var m=c[d],y=m.length;j(t,e,+d),j(t,e+2,y),t.set(m,e+4),e+=4+y}return u&&(t.set(o,e),e+=u),e},uo=function(t,e,n,r,i){j(t,e,101010256),j(t,e+8,n),j(t,e+10,n),j(t,e+12,r),j(t,e+16,i)};function fo(t,e){e||(e={});var n={},r=[];$i(t,"",n,e);var i=0,s=0;for(var a in n){var o=n[a],l=o[0],c=o[1],u=c.level==0?0:8,f=Ce(a),h=f.length,p=c.comment,d=p&&Ce(p),m=d&&d.length,y=kn(c.extra);h>65535&&Y(11);var x=u?ro(l,c):l,S=x.length,q=to();q.p(l),r.push(xi(c,{size:l.length,crc:q.d(),c:x,f,m:d,u:h!=a.length||d&&p.length!=m,o:i,compression:u})),i+=30+h+y+S,s+=76+2*(h+y)+(m||0)+S}for(var D=new O(s+22),H=i,T=s-i,N=0;N<r.length;++N){var f=r[N];wr(D,f.o,f,f.f,f.u,f.c.length);var $=30+f.f.length+kn(f.extra);D.set(f.c,f.o+$),wr(D,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+$+(f.m?f.m.length:0)}return uo(D,i,r.length,T,H),D}function ho(t,e){for(var n={},r=t.length-22;oe(t,r)!=101010256;--r)(!r||t.length-r>65558)&&Y(13);var i=fe(t,r+8);if(!i)return{};var s=oe(t,r+16),a=s==4294967295||i==65535;if(a){var o=oe(t,r-12);a=oe(t,o)==101075792,a&&(i=oe(t,o+32),s=oe(t,o+48))}for(var l=e&&e.filter,c=0;c<i;++c){var u=lo(t,s,a),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4],y=u[5],x=oo(t,y);s=m,(!l||l({name:d,size:h,originalSize:p,compression:f}))&&(f?f==8?n[d]=io(t.subarray(x,x+h),new O(p)):Y(14,"unknown compression type "+f):n[d]=lt(t,x,x+h))}return n}const zn=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{}catch{return!1}else if("showOpenFilePicker"in self)return"showOpenFilePicker";return!1})(),po=zn?Promise.resolve().then(function(){return bo}):Promise.resolve().then(function(){return So});async function ki(...t){return(await po).default(...t)}zn?Promise.resolve().then(function(){return xo}):Promise.resolve().then(function(){return Eo});const go=zn?Promise.resolve().then(function(){return Co}):Promise.resolve().then(function(){return Po});async function mo(...t){return(await go).default(...t)}const vo=async t=>{const e=await t.getFile();return e.handle=t,e};var yo=async(t=[{}])=>{Array.isArray(t)||(t=[t]);const e=[];t.forEach((i,s)=>{e[s]={description:i.description||"",accept:{}},i.mimeTypes?i.mimeTypes.map(a=>{e[s].accept[a]=i.extensions||[]}):e[s].accept["*/*"]=i.extensions||[]});const n=await window.showOpenFilePicker({id:t[0].id,startIn:t[0].startIn,types:e,multiple:t[0].multiple||!1,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1}),r=await Promise.all(n.map(vo));return t[0].multiple?r:r[0]},bo={__proto__:null,default:yo};function xt(t){function e(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return xt=function(n){this.s=n,this.n=n.next},xt.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Promise.resolve({value:n,done:!0}):e(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Promise.reject(n):e(r.apply(this.s,arguments))}},new xt(t)}const Si=async(t,e,n=t.name,r)=>{const i=[],s=[];var a,o=!1,l=!1;try{for(var c,u=function(f){var h,p,d,m=2;for(typeof Symbol<"u"&&(p=Symbol.asyncIterator,d=Symbol.iterator);m--;){if(p&&(h=f[p])!=null)return h.call(f);if(d&&(h=f[d])!=null)return new xt(h.call(f));p="@@asyncIterator",d="@@iterator"}throw new TypeError("Object is not async iterable")}(t.values());o=!(c=await u.next()).done;o=!1){const f=c.value,h=`${n}/${f.name}`;f.kind==="file"?s.push(f.getFile().then(p=>(p.directoryHandle=t,p.handle=f,Object.defineProperty(p,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>h})))):f.kind!=="directory"||!e||r&&r(f)||i.push(Si(f,e,h,r))}}catch(f){l=!0,a=f}finally{try{o&&u.return!=null&&await u.return()}finally{if(l)throw a}}return[...(await Promise.all(i)).flat(),...await Promise.all(s)]};var wo=async(t={})=>{t.recursive=t.recursive||!1;const e=await window.showDirectoryPicker({id:t.id,startIn:t.startIn});return Si(e,t.recursive,void 0,t.skipDirectory)},xo={__proto__:null,default:wo},$o=async(t,e=[{}],n=null,r=!1,i=null)=>{Array.isArray(e)||(e=[e]),e[0].fileName=e[0].fileName||"Untitled";const s=[];let a=null;if(t instanceof Blob&&t.type?a=t.type:t.headers&&t.headers.get("content-type")&&(a=t.headers.get("content-type")),e.forEach((c,u)=>{s[u]={description:c.description||"",accept:{}},c.mimeTypes?(u===0&&a&&c.mimeTypes.push(a),c.mimeTypes.map(f=>{s[u].accept[f]=c.extensions||[]})):a?s[u].accept[a]=c.extensions||[]:s[u].accept["*/*"]=c.extensions||[]}),n)try{await n.getFile()}catch(c){if(n=null,r)throw c}const o=n||await window.showSaveFilePicker({suggestedName:e[0].fileName,id:e[0].id,startIn:e[0].startIn,types:s,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1});!n&&i&&i();const l=await o.createWritable();return"stream"in t?(await t.stream().pipeTo(l),o):"body"in t?(await t.body.pipeTo(l),o):(await l.write(await t),await l.close(),o)},Co={__proto__:null,default:$o},ko=async(t=[{}])=>(Array.isArray(t)||(t=[t]),new Promise((e,n)=>{const r=document.createElement("input");r.type="file";const i=[...t.map(o=>o.mimeTypes||[]),...t.map(o=>o.extensions||[])].join();r.multiple=t[0].multiple||!1,r.accept=i||"";const s=o=>{typeof a=="function"&&a(),e(o)},a=t[0].legacySetup&&t[0].legacySetup(s,()=>a(n),r);r.addEventListener("change",()=>{s(r.multiple?Array.from(r.files):r.files[0])}),r.click()})),So={__proto__:null,default:ko},Ao=async(t=[{}])=>(Array.isArray(t)||(t=[t]),t[0].recursive=t[0].recursive||!1,new Promise((e,n)=>{const r=document.createElement("input");r.type="file",r.webkitdirectory=!0;const i=a=>{typeof s=="function"&&s(),e(a)},s=t[0].legacySetup&&t[0].legacySetup(i,()=>s(n),r);r.addEventListener("change",()=>{let a=Array.from(r.files);t[0].recursive?t[0].recursive&&t[0].skipDirectory&&(a=a.filter(o=>o.webkitRelativePath.split("/").every(l=>!t[0].skipDirectory({name:l,kind:"directory"})))):a=a.filter(o=>o.webkitRelativePath.split("/").length===2),i(a)}),r.click()})),Eo={__proto__:null,default:Ao},No=async(t,e={})=>{Array.isArray(e)&&(e=e[0]);const n=document.createElement("a");let r=t;"body"in t&&(r=await async function(a,o){const l=a.getReader(),c=new ReadableStream({start:h=>async function p(){return l.read().then(({done:d,value:m})=>{if(!d)return h.enqueue(m),p();h.close()})}()}),u=new Response(c),f=await u.blob();return l.releaseLock(),new Blob([f],{type:o})}(t.body,t.headers.get("content-type"))),n.download=e.fileName||"Untitled",n.href=URL.createObjectURL(await r);const i=()=>{typeof s=="function"&&s()},s=e.legacySetup&&e.legacySetup(i,()=>s(),n);return n.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),i()}),n.click(),null},Po={__proto__:null,default:No};class Oo{constructor(){this.dbPromise=Ba("os-dpi",4,{upgrade(e,n,r){if(n<3)for(const i of["store","media","saved","url"])try{e.deleteObjectStore(i)}catch{}else n==3&&e.deleteObjectStore("images");if(n<3){let i=e.createObjectStore("store",{keyPath:"id",autoIncrement:!0});i.createIndex("by-name","name"),i.createIndex("by-name-type",["name","type"])}r>=4&&e.createObjectStore("media"),n<3&&(e.createObjectStore("saved",{keyPath:"name"}).createIndex("by-etag","etag"),e.createObjectStore("url",{keyPath:"url"}))}}),this.updateListeners=[],this.designName="",this.fileName="",this.fileHandle=null,this.fileVersion=0,this.fileUid=""}setDesignName(e){this.designName=e}async renameDesign(e){const n=await this.dbPromise;e=await this.uniqueName(e);const r=n.transaction(["store","media","saved"],"readwrite"),i=r.objectStore("store").index("by-name");for await(const o of i.iterate(this.designName)){const l={...o.value};l.name=e,o.update(l)}const s=r.objectStore("media");for await(const o of s.iterate())if(o&&o.key[0]==this.designName){const l={...o.value},c=o.key;o.delete(),c[0]=e,s.put(l,c)}const a=await r.objectStore("saved").openCursor(this.designName);a&&a.delete(),await r.done,this.fileHandle=null,this.fileName="",this.notify({action:"rename",name:this.designName,newName:e}),this.designName=e}async names(){const n=(await this.dbPromise).transaction("store","readonly").store.index("by-name"),r=[];for await(const i of n.iterate(null,"nextunique"))r.push(i.key);return r}async saved(){const e=await this.dbPromise,n=[];for(const r of await e.getAllKeys("saved"))n.push(r.toString());return n}async uniqueName(e="new"){e=e.replace(/\.osdpi$|\.zip$/,""),e=e.replace(/-\d+$/,"")||e,e=e.replaceAll(/[^a-zA-Z0-9]/g,"_"),e=e.replaceAll(/_+/g,"_"),e=e.replace(/_+$/,""),e=e.replace(/^_+/,""),e=e||"noname";const n=await this.names();if(n.indexOf(e)<0)return e;const r=e;for(let i=1;;i++){const s=`${r}-${i}`;if(n.indexOf(s)<0)return s}}async read(e,n){return(await(await this.dbPromise).transaction("store","readonly").store.index("by-name-type").openCursor([this.designName,e],"prev"))?.value.data||n}async write(e,n){console.trace("db write",e);const r=await this.dbPromise;await r.put("store",{name:this.designName,type:e,data:n}),await r.delete("saved",this.designName),this.notify({action:"update",name:this.designName})}async undo(e){const n=await this.dbPromise,i=await n.transaction("store","readwrite").store.index("by-name-type").openCursor([this.designName,e],"prev");i&&await i.delete(),await n.delete("saved",this.designName),this.notify({action:"update",name:this.designName})}async readDesignFromFile(e){return this.fileHandle=e.handle,this.readDesignFromBlob(e,e.name)}async readDesignFromURL(e){const n=await this.dbPromise,r=await n.get("url",e),i={};let s="";if(r){const f=r.etag,h=await n.getKeyFromIndex("saved","by-etag",f);h&&(i["If-None-Match"]=f,s=h.toString())}const a=await fetch(e,{headers:i});if(a.status==304){console.log("no need to fetch, we have it",s),this.designName=s;return}if(!a.ok)throw new Error(`Fetching the URL (${e}) failed: ${a.status}`);const o=a.headers.get("ETag");await n.put("url",{url:e,etag:o});const c=new URL(e,window.location.origin).pathname.split("/");if(c.length>0&&c[c.length-1].endsWith(".osdpi"))s=c[c.length-1];else throw new Error("Design files should have .osdpi suffix");const u=await a.blob();return this.readDesignFromBlob(u,s,o)}async readDesignFromBlob(e,n,r="none"){const i=await this.dbPromise;this.fileName=n;const s=await To(e),a=new Uint8Array(s),o=ho(a);let l=this.fileName;l=await this.uniqueName(l),this.designName=l;for(const c in o){const u=Lo(c)||"application/octet-stream";if(u=="application/json"){const f=Ci(o[c]),h=JSON.parse(f),p=c.split(".")[0];await this.write(p,h)}else if(u.startsWith("image")||u.startsWith("audio")){const f=new Blob([o[c]],{type:u});await i.put("media",{name:c,content:f},[l,c])}}await i.put("saved",{name:this.designName,etag:r}),this.notify({action:"update",name:this.designName})}async saveDesign(){const e=await this.dbPromise,n=w.tree.toObject(),r=w.actions.toObject(),i=await this.read("content"),s=w.method.toObject(),a=w.patterns.toObject(),o=w.cues.toObject(),l={"layout.json":Ce(JSON.stringify(n)),"actions.json":Ce(JSON.stringify(r)),"content.json":Ce(JSON.stringify(i)),"method.json":Ce(JSON.stringify(s)),"pattern.json":Ce(JSON.stringify(a)),"cues.json":Ce(JSON.stringify(o))},c=(await e.getAllKeys("media")).filter(p=>Object.values(p).includes(this.designName));for(const p of c){const d=await e.get("media",p);if(d){const m=await d.content.arrayBuffer(),y=new Uint8Array(m);l[p[1]]=y}}const u=fo(l),f=new Blob([u],{type:"application/octet-stream"}),h={fileName:this.fileName||this.designName+".osdpi",extensions:[".osdpi",".zip"],id:"osdpi"};await mo(f,h,this.fileHandle),await e.put("saved",{name:this.designName})}async unload(e){const n=await this.dbPromise,r=n.transaction("store","readwrite"),i=r.store.index("by-name");for await(const s of i.iterate(e))s.delete();await r.done,await n.delete("saved",e)}async getImage(e){const r=await(await this.dbPromise).get("media",[this.designName,e]),i=new Image;return r&&(i.src=URL.createObjectURL(r.content)),i.title=r.name,i}async getAudio(e){const r=await(await this.dbPromise).get("media",[this.designName,e]),i=new Audio;return r&&(i.src=URL.createObjectURL(r.content)),i}async getMediaURL(e){const r=await(await this.dbPromise).get("media",[this.designName,e]);return r?URL.createObjectURL(r.content):""}async addMedia(e,n){return await(await this.dbPromise).put("media",{name:n,content:e},[this.designName,n])}async listMedia(){const n=(await(await this.dbPromise).getAllKeys("media")).filter(i=>i[0]==this.designName),r=[];for(const i of n)r.push(i[1].toString());return r}addUpdateListener(e){this.updateListeners.push(e)}notify(e){for(const n of this.updateListeners)n(e)}}const C=new Oo;function To(t){return new Promise(e=>{const n=new FileReader;n.onloadend=()=>n.result instanceof ArrayBuffer&&e(n.result),n.readAsArrayBuffer(t)})}const Io={".json":"application/json",".aac":"audio/aac",".mp3":"audio/mpeg",".mp4":"audio/mp4",".oga":"audio/ogg",".wav":"audio/wav",".weba":"audio/webm",".avif":"image/avif",".bmp":"image/bmp",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".png":"image/png",".svg":"image/svg+xml",".tif":"image/tiff",".tiff":"image/tiff",".webp":"image/webp"};function Lo(t){const e=/\.[-a-zA-Z0-9]+$/.exec(t);return e&&Io[e]||!1}const Mo={className:"Page",props:{},children:[{className:"Speech",props:{},children:[]}]};class Ai extends Ut{allowDelete=!1;constructor(){super(),this.allowedChildren=this.allowedChildren.concat("Speech","Audio","Logger")}template(){return g`${this.children.map(e=>e.template())}`}static async load(){const e=await C.read("layout",Mo);return this.fromObject(e)}onUpdate(){C.write("layout",this.toObject()),w.state.update()}}Ut.register(Ai,"Page");const qt=Proxy,{apply:Ro,bind:Do,call:ot}=Function;ot.bind(Ro);const Wn=ot.bind(Do),sn=ot.bind(ot),jo={get(t,e){return Wn(ot,t[e])}},Ei=t=>new qt(t,jo),Uo={get(t,e){return Wn(t[e],t)}},Ni=t=>new qt(t,Uo),{assign:nu,defineProperties:xr,freeze:$r,getOwnPropertyDescriptor:Bo,getOwnPropertyDescriptors:Cr,getPrototypeOf:ru}=Ni(Object),{hasOwnProperty:_o}=Ei({});Ei([]);const{species:Fo}=Symbol,Ko={get(t,e){const n=t[e];class r extends n{}const i=Cr(n.prototype);delete i.constructor,$r(xr(r.prototype,i));const s=Cr(n);return delete s.length,delete s.prototype,s[Fo]={value:r},$r(xr(r,s))}},qo=t=>new qt(t,Ko),Ho=qo(globalThis),{Map:Pi,WeakMap:kr}=Ho;new Pi;const{ownKeys:zo}=Ni(Reflect),Sr=Symbol("extender"),Oi=t=>{const e=zo(t),n=new Pi,{init:r}=t;for(let a=0;a<e.length;a++){const o=e[a];if(o==="init")continue;const l=new kr,c=Bo(t,o);if(_o(c,"value")){const{value:u}=c;n.set(o,typeof u=="function"?f=>{let h=l.get(f);if(!h){const p=Wn(u,f);l.set(f,h={get:()=>p})}return h}:f=>{let h=l.get(f);if(!h){let p=u;l.set(f,h={get:()=>p,set:d=>{p=d}})}return h})}else{const{get:u,set:f}=c;n.set(o,h=>{let p=l.get(h);return p||l.set(h,p={get:()=>sn(u,h),set:d=>{sn(f,h,d)}}),p})}}const i={get:(a,o)=>{if(o===Sr)return a;let l=n.get(o);return l?l(a).get():a[o]},set:(a,o,l)=>{let c=n.get(o);return c?c(a).set(l):a[o]=l,!0}},s=new kr;return function(a){const o=a[Sr]||a;let l=s.get(o);return l||(s.set(o,l=new qt(o,i)),r&&sn(r,o)),l}};var Wo=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;i--!==0;){var a=s[i];if(!t(e[a],n[a]))return!1}return!0}return e!==e&&n!==n};const Go={access:{},node:null,cue(t){this.setAttribute("cue",t)},groups:[]},Ie=Oi(Go),Vo={access:{}},Et=Oi(Vo);function Ue(t){return e=>{const n=e instanceof HTMLElement&&e.closest("div#UI")!==null,r=Ie(e);n&&(!r.access||Wo(t,r.access)),r.access=t,r.node=e}}class Jo extends HTMLImageElement{static get observedAttributes(){return["dbsrc","refresh"]}async attributeChangedCallback(e,n,r){e==="dbsrc"&&this.updateSrcFromDb(r)}async refresh(){const e=this.getAttribute("dbsrc");return this.updateSrcFromDb(e)}async updateSrcFromDb(e){e.indexOf("/")<0&&(e=await C.getMediaURL(e)),e&&(this.src=e)}}customElements.define("img-db",Jo,{extends:"img"});class Zo extends b{fillItems=new Rt(!1);rows=new _e(3);columns=new _e(3);name=new k("grid");background=new he("white");scale=new R(1);allowedChildren=["GridFilter"];children=[];get filters(){return this.children.map(e=>({field:e.field.value,operator:e.operator.value,value:e.value.value}))}page=1;pageBoundaries={0:0};cache={};gridCell(e){const{name:n}=this.props;let r,i=Aa(e.label||"");return e.symbol?r=g`<div>
        <figure>
          <img is="img-db" dbsrc=${e.symbol} title=${e.label||""} />
          <figcaption>${i}</figcaption>
        </figure>
      </div>`:r=i,g`<button
      tabindex="-1"
      ref=${Ue({...e,ComponentName:n,ComponentType:this.constructor.name})}
      ?disabled=${!e.label&&!e.symbol}
    >
      ${r}
    </button>`}emptyCell(){return g`<button tabindex="-1" disabled></button>`}pageSelector(e,n){const{state:r}=w,{background:i,name:s}=this.props;return g`<div class="page-control">
      <div class="text">Page ${this.page} of ${e}</div>
      <div class="back-next">
        <button
          style=${pe({backgroundColor:i})}
          .disabled=${this.page==1}
          ref=${Ue({...n,name:s,onClick:()=>{this.page=((this.page-2)%e+e)%e+1,r.update()}})}
          tabindex="-1"
        >
          &#9754;</button
        ><button
          .disabled=${this.page==e}
          ref=${Ue({...n,name:s,onClick:()=>{this.page=this.page%e+1,r.update()}})}
          tabindex="-1"
        >
          &#9755;
        </button>
      </div>
    </div>`}template(){const e={backgroundColor:this.props.background},{data:n,state:r}=w;let{rows:i,columns:s,fillItems:a}=this.props,o=n.getMatchingRows(this.filters,r,this.cache);this.cache.updated&&(this.page=1);let l=1;const c=[];if(a){let u=i*s;o.length>u&&(u=u-1),l=Math.ceil(o.length/u),o=o.slice((this.page-1)*u,this.page*u);for(let f=0;f<o.length;f++){const h=Math.floor(f/s)+1,p=f%s+1,d={...o[f],row:h,column:p};c.push(this.gridCell(d))}for(let f=o.length;f<u;f++)c.push(this.emptyCell());l>1&&c.push(this.pageSelector(l,{row:i,column:s}))}else{let u=0,f=0;const h=new Map,p=(d,m)=>d*1e3+m;for(const d of o)if(!(!d.row||!d.column)&&(l=Math.max(l,d.page||1),this.page==(d.page||1))){u=Math.max(u,d.row),f=Math.max(f,d.column);const m=p(d.row,d.column);h.has(m)||h.set(m,d)}i=u,s=f;for(let d=1;d<=i;d++)for(let m=1;m<=s;m++)if(l>1&&d==i&&m==s)c.push(this.pageSelector(l,{row:d,column:m}));else{const y=p(d,m);h.has(y)?c.push(this.gridCell(h.get(y))):c.push(this.emptyCell())}}return e.gridTemplate=`repeat(${i}, calc(100% / ${i})) / repeat(${s}, 1fr)`,g`<div class="grid" id=${this.id} style=${pe(e)}>
      ${c}
    </div>`}}b.register(Zo,"Grid");class Ti extends b{field=new _n;operator=new U(Object.keys(ai));value=new k("")}b.register(Ti,"GridFilter");class Nt extends b{stateName=new k("$Display");background=new he("white");fontSize=new R(2);scale=new R(1);static functionsInitialized=!1;template(){const e=pe({backgroundColor:this.props.background,fontSize:this.props.fontSize+"rem"}),{state:n}=w;let r=[],i=n.get(this.props.stateName)||"";if(typeof i=="string"||i instanceof String)i=i.replaceAll(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/g,"$2"),r=[g`${i}`];else{let s=i,a=0;r=s.message.split(/(\$\$.*?\$\$)/).map(o=>o.match(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/)?a===s.slotIndex?g`<b>${s.slots[a++].value}</b>`:g`${s.slots[a++].value.replace(/^\*/,"")}`:g`${o}`)}return g`<div
      class="display flex"
      ref=${this}
      style=${e}
      id=${this.id}
    >
      ${r}
    </div>`}init(){if(!Nt.functionsInitialized){let l=function(d){return d instanceof Object?d.slots.length>0:d.indexOf("$$")>=0},c=function(d){const m=Array.from(d.matchAll(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/g)).map(y=>y.groups);return{message:d,slots:m,slotIndex:0,slotName:m[0]&&m[0].name||""}},u=function(){return{message:"",slots:[],slotIndex:0,slotName:""}},f=function(d){return m=>{if(!m||!m.slots)return"";const y=[...m.slots];let x=m.slotIndex;return d.startsWith("*")?y[x].value=d:(y[x].value.startsWith("*")?y[x].value=`${y[x].value} ${d}`:y[x].value=d,x++,x>=y.length&&o.queueEvent("okSlot","press")),ke(m,{slots:y,slotIndex:x,slotName:y[x]?.name})}},h=function(){return d=>{if(!d)return;const m=d.slotIndex+1;return m>=d.slots.length&&o.queueEvent("okSlot","press"),ke(d,{slotIndex:m})}},p=function(){return d=>{const y=Array.from(d.message.matchAll(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/g))[d.slotIndex];if(y!==void 0&&y.index!==void 0){const x=d.message.slice(0,y.index)+y[0]+" and "+y[0]+d.message.slice(y.index+y[0].length),S=[...d.slots.slice(0,d.slotIndex+1),{...d.slots[d.slotIndex]},...d.slots.slice(d.slotIndex+1)];return ke(d,{message:x,slots:S})}else return d}};var e=l,n=c,r=u,i=f,s=h,a=p;Nt.functionsInitialized=!0;let{actions:o}=w;Un.slots={init:c,cancel:u,update:f,hasSlots:l,duplicate:p,nextSlot:h,strip:Gn}}}}function Gn(t){if(!t)return"";if(typeof t=="string"||t instanceof String)return t=t.replaceAll(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/g,"$2"),t;let e=t,n=0;return e.message.split(/(\$\$.*?\$\$)/).map(i=>i.match(/\$\$(?<name>.*?)=(?<value>.*?)\$\$/)?e.slots[n++].value.replace(/^\*/,""):i).join("")}b.register(Nt,"Display");class Ii extends b{name=new k("");value=new k("");cache={}}b.register(Ii,"Option");class Yo extends b{scale=new R(1);label=new k("");stateName=new k("$radio");unselected=new he("lightgray");selected=new he("pink");allowedChildren=["Option"];children=[];get filters(){return this.filterChildren(Ti).map(e=>({field:e.field.value,operator:e.operator.value,value:e.value.value}))}get options(){return this.filterChildren(Ii)}valid(e){const{data:n,state:r}=w,i=this.filters;return!i.length||n.hasMatchingRows(i,r.clone({[this.props.stateName]:e.props.value}),e.cache)}handleClick({target:e}){if(e instanceof HTMLButtonElement){const n=e.value,r=this.props.stateName;w.state.update({[r]:n})}}template(){const{state:e}=w,n=this.props.stateName;let r=e.get(n);const i=this.options.map((s,a)=>{const o=!this.valid(s);n&&!r&&!o&&s.props.value&&(r=s.props.value,e.update({[n]:r}));const l=s.props.value==r||!r&&a==0?this.props.selected:this.props.unselected;return g`<button
        style=${pe({backgroundColor:l})}
        value=${s.props.value}
        ?disabled=${o}
        ref=${Ue({ComponentType:this.constructor.name,name:this.name,label:s.props.name,onClick:()=>e.update({[n]:s.props.value})})}
      >
        ${s.props.name}
      </button>`});return g`<div class="radio flex" id=${this.id}>
      <fieldset class="flex">
        ${this.props.label&&g`<legend>${this.props.label}</legend>`||g`<!--empty-->`}
        ${i}
      </fieldset>
    </div>`}get name(){return this.props.name||this.props.label||this.props.stateName}}b.register(Yo,"Radio");class Xo extends b{scale=new R(1);background=new he("");uiTemplate(){const e=pe({backgroundColor:this.props.background});return g`<div class="gap flex" style=${e} id=${this.id}></div>`}}b.register(Xo,"Gap");const Sn=[];function Pt(t){Sn.push(t)}function Qo(t,e){let n;for(n=Ee(t,e);Sn.length>0;)Sn.pop()();return n}let Oe="idle";function el(t){const e=document.getElementById("HotKeyHints");!e||(e.innerHTML=t.map(n=>`<span><b>${n[0]}</b>${n.slice(1)}</span>`).join(),e.classList.add("show"))}function an(){const t=document.getElementById("HotKeyHints");t&&t.classList.remove("show")}function tl(){const t=document.querySelector(".designing .tabcontrol .buttons button[active]");if(t){console.log("focus",t),t.focus();return}const e=[...document.querySelectorAll(".designing .tabcontrol .buttons button")];console.log({tabs:e}),e.length&&(console.log("focus",e[0]),e[0].focus())}function nl(t){console.log(t);const e=w.state.get("editing");if(t.key=="Alt")Oe="Alt",el(["Tabs"]),t.preventDefault();else if(t.key=="d"&&Oe=="Alt")Oe="idle",an(),e?(document.body.classList.remove("designing"),t.preventDefault(),w.state.update({editing:!1})):(document.body.classList.add("designing"),t.preventDefault(),w.state.update({editing:!0}));else if(e)t.key=="t"&&Oe=="Alt"?(Oe="idle",an(),tl(),t.preventDefault()):(Oe="idle",an());else{Oe="idle";return}console.log("active element",document.activeElement)}document.addEventListener("keydown",nl,{capture:!0});function rl(t){if(console.log({panel:t}),!t.lastFocused){console.log("no lastFocused");return}const e=b.componentFromId(t.lastFocused);if(!e){console.log("no component");return}const n=e.getMenuActions(),r=document.getElementById("HotKeyHints"),i=n.map(s=>{let a="";return s instanceof ui?a=`+${s.className}`:s instanceof fi?a=`-${s.className}`:s instanceof hn&&(s.step<0?a="Up":a="Down"),g`<button
      onclick=${()=>{Ee(r,g`<!--empty-->`);const o=s.apply();console.log({nextId:o,panel:t}),t.lastFocused=o+"-settings",Pt(()=>t.parent.restoreFocus()),t.update()}}
    >
      ${a}
    </button>`});Ee(r,g`${i}`)}class Li extends b{stateName=new k("$tabControl");background=new k("");scale=new R(6);tabEdge=new U(["bottom","top","left","right","none"]);name=new k("tabs");allowedChildren=["TabPanel"];children=[];currentPanel=null;template(){const{state:e}=w,n=this.children;let r=e.get(this.props.stateName);n.forEach((a,o)=>{a.tabName=e.interpolate(a.props.name),a.tabLabel=e.interpolate(a.props.label||a.props.name),o==0&&!r&&(r=a.tabName,e.define(this.props.stateName,a.tabName)),a.active=r==a.tabName||n.length===1});let i=[g`<!--empty-->`];this.props.tabEdge!="none"&&(i=n.filter(a=>a.props.label!="UNLABELED").map((a,o)=>{const c={backgroundColor:a.props.background};return g`<button
            ?active=${a.active}
            style=${pe(c)}
            ref=${Ue({name:this.name,label:a.tabLabel,component:this.constructor.name,onClick:()=>{this instanceof Mi&&Pt(()=>this.restoreFocus()),e.update({[this.props.stateName]:a.tabName})}})}
            .dataset=${{id:a.id}}
          >
            ${a.tabLabel}
          </button>`})),this.currentPanel=n.find(a=>a.active);const s=this.currentPanel?.template()||g`<!--empty-->`;return g`<div
      class=${["tabcontrol","flex",this.props.tabEdge].join(" ")}
      id=${this.id}
    >
      <div class="buttons">${i}</div>
      <div
        class="panels flex"
        onfocusin=${({target:a})=>{this.currentPanel&&(this.currentPanel.lastFocused=a.id),rl(this.currentPanel)}}
      >
        ${s}
      </div>
    </div>`}restoreFocus(){}}b.register(Li,"TabControl");class Mi extends Li{settings(){return super.template()}restoreFocus(){if(this.currentPanel)if(this.currentPanel.lastFocused){const e=document.getElementById(this.currentPanel.lastFocused);console.log("restore focus",e,this.currentPanel.lastFocused,this.currentPanel),e&&e.focus()}else{console.log("restoreFocus else path");const e=document.getElementById(this.currentPanel.id);if(e){const n=e.querySelector('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled]), summary:not(:disabled)');n&&n.focus()}}}}b.register(Mi,"DesignerTabControl");class we extends Ut{name=new k("");label=new k("");parent=null;active=!1;tabName="";tabLabel="";lastFocused=""}b.register(we,"TabPanel");class il extends b{stateName=new k("$modalOpen");allowedChildren=["Stack"];template(){const e=w.state,{stateName:n}=this.props;return e.get(n)?g`<div
        class="modal"
        id=${this.id}
        ?open=${!!e.get(n)}
      >
        <div>${this.children.map(i=>i.template())}</div>
      </div>`:g`<!--empty-->`}}b.register(il,"ModalDialog");const sl=t=>new Promise(e=>setTimeout(e,t));async function al(t,e=1){for(;!t();)await sl(e)}async function ol(t){let e=0,n=0,r=1,i=1;if(t){await al(()=>t.complete&&t.naturalWidth!=0);const s=t.width,a=t.height,o=t.naturalWidth,l=t.naturalHeight,c=o/l,u=s/a;c>u?(r=s,i=s/c):(r=a*c,i=a),e=(s-r)/2,n=(a-i)/2}return{left:e,top:n,width:r,height:i}}function pt(t){return`${t}px`}function gt(t){return`${t}%`}class ll extends b{name=new k("vsd");scale=new R(1);children=[];get filters(){return this.children.map(e=>({field:e.field.value,operator:e.operator.value,value:e.value.value}))}uiTemplate(){const{data:e,state:n,rules:r}=w,i=e.getMatchingRows(this.filters,n),s=i.find(a=>a.image)?.image;return g`<div class="vsd flex show" id=${this.id}>
      <img is="img-db" dbsrc=${s} />
      <div
        class="markers"
        ref=${a=>{const o=a.previousElementSibling;a.observer||(a.observer=new ResizeObserver(async()=>{const l=await ol(o);a.style.position="absolute",a.style.left=pt(l.left),a.style.top=pt(l.top),a.style.width=pt(l.width),a.style.height=pt(l.height)}),a.observer.observe(o))}}
      >
        ${i.filter(a=>a.w).map(a=>g`<button
              style=${pe({left:gt(a.x),top:gt(a.y),width:gt(a.w),height:gt(a.h),position:"absolute"})}
              ?invisible=${a.invisible}
              onClick=${r.handler(this.name,a,"press")}
            >
              <span>${a.label||""}</span>
            </button>`)}
      </div>
    </div>`}}b.register(ll,"VSD");class cl extends b{label=new k("click me");name=new k("button");background=new he("");scale=new R(1);template(){const e=pe({backgroundColor:this.props.background}),{name:n,label:r}=this.props;return g`<button
      class="button"
      name=${n}
      style=${e}
      id=${this.id}
      ref=${Ue({name:n,label:r,ComponentName:this.props.name,ComponentType:this.constructor.name})}
    >
      ${r}
    </button>`}getChildren(){return[]}}b.register(cl,"Button");class ul extends b{uiTemplate(){const{state:e,actions:n}=w,r=g`<table class="state">
      <thead>
        <tr>
          <th>State</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        ${Object.keys(e.values).filter(a=>a.startsWith("$")).map(a=>{const o=e.get(a);return g`<tr>
              <td>${a}</td>
              <td>${o}</td>
            </tr>`})}
      </tbody>
    </table>`,i=n.last.data,s=g`<table class="fields">
      <thead>
        <tr>
          <th>Field</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        ${Object.keys(i).map(a=>{const o=i[a];return g`<tr>
            <td>#${a}</td>
            <td>${o}</td>
          </tr>`})}
      </tbody>
    </table>`;return g`<button
        onclick=${()=>{e.clear(),n.init()}}
      >
        Clear state
      </button>
      <div>${r}${s}</div>`}}class fl extends b{stateName=new k("$Speak");voiceURI=new Sa("",{label:"Voice"});pitch=new R(1);rate=new R(1);volume=new R(1);async speak(){const{state:e}=w,{stateName:n,voiceURI:r,pitch:i,rate:s,volume:a}=this.props,o=Gn(e.get(n)),l=await Ri(),c=r&&l.find(f=>f.voiceURI==r),u=new SpeechSynthesisUtterance(o);c&&(u.voice=c,u.lang=c.lang),u.pitch=i,u.rate=s,u.volume=a,speechSynthesis.cancel(),speechSynthesis.speak(u)}template(){const{stateName:e}=this.props,{state:n}=w;return n.hasBeenUpdated(e)&&this.speak(),g`<!--empty-->`}}b.register(fl,"Speech");let Xe=[];function Ri(){return new Promise(function(t){function e(){Xe=Xe.length&&Xe||speechSynthesis.getVoices(),Xe.length?t(Xe):setTimeout(e,100)}e()})}class dl extends HTMLSelectElement{constructor(){super()}connectedCallback(){this.addVoices()}async addVoices(){const e=await Ri(),n=this.getAttribute("value");for(const r of e){const i=g.node`<option value=${r.voiceURI} ?selected=${r.voiceURI==n}>${r.name}</option>`;this.add(i)}}}customElements.define("select-voice",dl,{extends:"select"});class hl extends b{stateName=new k("$Audio");async playAudio(){const{state:e}=w,{stateName:n}=this.props,r=Gn(e.get(n)||"");st("play audio"),(await C.getAudio(r)).play()}uiTemplate(){const{stateName:e}=this.props,{state:n}=w;return n.hasBeenUpdated(e)&&this.playAudio(),g`<!--empty-->`}}b.register(hl,"Audio");const pl="https://github.com/UNC-Project-Open-AAC/OS-DPI/wiki/";document.addEventListener("keydown",t=>{if((t.key==="?"||t.key==="/")&&(t.ctrlKey||t.metaKey)){t.preventDefault(),console.log("help",t);const e=t.target;let n=e.getAttribute("help");if(!n){const r=e.closest("[help]");r?n=r.getAttribute("help"):n=""}window.open(pl+n,"help")}});const gl="modulepreload",ml=function(t){return"/"+t},Ar={},Di=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=ml(s),s in Ar)return;Ar[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.href===s&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":gl,a||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),a)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};async function tt(t,e="Please wait"){const n=document.createElement("div");n.id="PleaseWait",document.body.appendChild(n);const r=window.setTimeout(()=>{Ee(n,g`<div><p class="message">${e}</p></div>`)},500);try{const i=await t;return clearTimeout(r),n.remove(),i}catch(i){return console.trace("wait error"),clearTimeout(r),new Promise(s=>{Ee(n,g`<div>
          <p class="error">${i.message}</p>
          <button
            onclick=${()=>{n.remove(),s(i.message)}}
          >
            OK
          </button>
        </div>`)})}}async function on(t){const e=await Di(()=>import("./xlsx.0.5.0.js"),[]),n=await t.arrayBuffer(),r=e.read(n,{codepage:65001}),i=[];for(const s of r.SheetNames){const a=r.Sheets[s],o=e.utils.decode_range(a["!ref"]),l=[],c=[],u=[];for(let f=o.s.c;f<=o.e.c;f++){let h=a[e.utils.encode_cell({r:0,c:f})]?.v;if(!(typeof h!="string"||!h))switch(h=h.toLowerCase(),l.push(h.trim(" ")),u.push(f),h){case"row":case"column":case"page":c.push("number");break;default:c.push("string");break}}for(let f=o.s.r+1;f<=o.e.r;f++){const h={sheetName:s};for(let p=0;p<u.length;p++){const d=l[p],m=u[p];let y=a[e.utils.encode_cell({r:f,c:m})]?.v;switch(c[p]){case"string":typeof y>"u"&&(y=""),typeof y!="string"&&(y=y.toString(10)),y&&typeof y=="string"&&(h[d]=y);break;case"number":typeof y=="number"?h[d]=Math.floor(y):y&&typeof y=="string"&&(y=parseInt(y,10),isNaN(y)&&(y=0),h[d]=y);break}}Object.keys(h).length>1&&i.push(h)}}return i}async function ji(t,e,n){if(!n)return;const r=await Di(()=>import("./xlsx.0.5.0.js"),[]),i=new Set(e.map(a=>a.sheetName||"sheet1")),s=r.utils.book_new();for(const a of i){let o=e.filter(c=>a==(c.sheetName||"sheet1"));n!="csv"&&(o=o.map(c=>{const{sheetName:u,...f}=c;return f}));const l=r.utils.json_to_sheet(o);r.utils.book_append_sheet(s,l,a)}r.writeFileXLSX(s,`${t}.${n}`)}class vl extends we{name=new k("Content");init(){this.sheetHandle=null,this.sheetMessage=""}template(){const e=w.data;return g`<div class="content" id=${this.id}>
      <h1>Content</h1>
      <p>
        ${e.allrows.length} rows with these fields:
        ${String(e.allFields).replaceAll(",",", ")}
      </p>
      <h2>Load content from spreadsheets</h2>
      <form
        onsubmit=${n=>{n.preventDefault();let i=n.target[0].value;i.length!==0&&(sessionStorage.setItem("remoteSheetUrl",i),i.match(/https:\/\/docs.google.com\/spreadsheets\/.*\/edit.*/)&&(i=i.replace(/\/edit.*$/,"/gviz/tq?tqx=out:csv&tq=SELECT *")),tt((async()=>{const s=await fetch(i);if(!s.ok)throw new Error(`Fetching the URL failed: ${s.status}`);const a=await s.blob();var o=await on(a);await C.write("content",o),w.data=new bt(o),w.state.update()})()))}}
      >
        <label for="remoteFileInput">URL: </label>
        <input
          id="remoteFileInput"
          name="url"
          type="url"
          value=${sessionStorage.getItem("remoteSheetUrl")}
          placeholder="Enter a URL"
        />
        <input type="submit" value="Load remote sheet" />
      </form>
      <br />
      <button
        onclick=${async()=>{this.sheetMessage="";try{const n=await ki({extensions:[".csv",".tsv",".ods",".xls",".xlsx"],description:"Spreadsheets",id:"os-dpi"});if(n){this.sheetHandle=n.handle;const r=await tt(on(n));await C.write("content",r),this.sheetMessage=`Loaded ${n.name}`,w.data=new bt(r),w.state.update()}}catch{this.sheetHandle=null}}}
      >
        Load local sheet
      </button>
      <button
        ?disabled=${!this.sheetHandle}
        onclick=${async()=>{const n=await this.sheetHandle.getFile(),r=await tt(on(n));await C.write("content",r),this.sheetMessage=`Reloaded ${n.name}`,w.data=new bt(r),w.state.update()}}
      >
        Reload local sheet
      </button>
      <span>${this.sheetMessage}</span>
      <h2>Save content as a spreadsheet</h2>
      <label for="sheetType">Spreadsheet type</label>
      <select
        id="sheetType"
        onchange=${n=>{ji(C.designName,e.allrows,n.target.value)}}
      >
        <option selected value="">Choose your format</option>
        <option value="xlsx">Excel .xlsx</option>
        <option value="xls">Excel .xls</option>
        <option value="ods">ODF Spreadsheet .ods</option>
        <option value="csv">Comma Separated Values .csv</option>
      </select>

      <h2>Load audio clips</h2>
      <label for="audio">Upload audio clips: </label>
      <input
        id="audio"
        type="file"
        multiple
        accept="audio/*"
        onchange=${async n=>{const r=n.currentTarget;if(!(!r||!r.files||!r.files.length)){for(const i of r.files)i&&i.type.startsWith("audio/")&&await C.addMedia(i,i.name);w.state.update()}}}
      />

      <h2>Load images</h2>
      <label for="images">Upload images: </label>
      <input
        id="images"
        type="file"
        multiple
        accept="image/*"
        onchange=${async n=>{const r=n.currentTarget;if(!(!r||!r.files||!r.files.length)){for(const i of r.files)if(i&&i.type.startsWith("image/")){await C.addMedia(i,i.name);for(const s of document.querySelectorAll(`img[dbsrc="${i.name}"]`))s.refresh()}w.state.update()}}}
      />
      <h2>Currently loaded media files</h2>
      <ol style="column-count: 3">
        ${n=>{C.listMedia().then(r=>{const i=r.map(s=>g`<li>${s}</li>`);Ee(n.parentNode,g`${n}${i}`)})}}
      </ol>
    </div>`}}b.register(vl,"Content");class Te extends we{name=new k("Logger");stateName=new k("$Log");dbName=new k("Log");static instances=[];init(){Te.instances.push(this)}template(){const{state:e}=w,{stateName:n,name:r}=this.props;return e.hasBeenUpdated(n)&&C.read(this.name.value,[]).then(i=>{i.push({timestamp:Date.now(),...this.stringifyInput(e.get(n))}),C.write(this.name.value,i)}),g`<!--empty-->`}stringifyInput(e){let n={};for(let r=0;r<e.length;r+=2)n[e[r]]=w.state.interpolate(r+1<e.length?e[r+1]:"");return n}}we.register(Te,"Logger");class yl extends b{name=new k("Logging");template(){return this.selected=this.selected||Te.instances?.[0],g`
      <div id="logging-panel">
        <h2>Select Logger</h2>
        <label
          >Logger
          <select
            onchange=${({target:e})=>{this.selected=Te.instances?.[e.value||0]}}
          >
            <option value="" invalid>Choose one...</option>
            ${Te.instances.map(e=>g`<option
                  value="${Te.instances.indexOf(e)}"
                  ?selected=${e.name.value===this.selected?.name.value}
                >
                  ${e.name.value}
                </option>`)}
          </select></label
        >

        <h2>Save content as a spreadsheet</h2>
        <label for="sheetType">Spreadsheet type</label>
        <select
          id="sheetType"
          onchange=${({target:e})=>{this.selected&&e.value!==""&&C.read(this.selected.dbName.value,[{}]).then(n=>{ji(this.selected.dbName.value,n,e.value)})}}
        >
          <option selected value="">Choose your format</option>
          <option value="xlsx">Excel .xlsx</option>
          <option value="xls">Excel .xls</option>
          <option value="ods">ODF Spreadsheet .ods</option>
          <option value="csv">Comma Separated Values .csv</option>
        </select>

        <h2>Clear log</h2>
        <button
          onclick=${()=>{this.selected&&C.write(this.selected.dbName.value,[{}])}}
        >
          Clear
        </button>
      </div>
    `}}b.register(yl,"Logging");class bl extends we{template(){return g`<div class="treebase layout" help="Layout tab" id=${this.id}>
      ${this.children[0].settings()}
    </div>`}onUpdate(){C.write("layout",this.children[0].toObject()),w.state.update()}}b.register(bl,"Layout");var An=function(t,e){return An=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},An(t,e)};function Pe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");An(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function wl(t,e,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(f){a(f)}}function l(u){try{c(r.throw(u))}catch(f){a(f)}}function c(u){u.done?s(u.value):i(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})}function Ui(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Fe(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ge(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s}function be(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Be(t){return this instanceof Be?(this.v=t,this):new Be(t)}function xl(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(h){r[h]&&(i[h]=function(p){return new Promise(function(d,m){s.push([h,p,d,m])>1||o(h,p)})})}function o(h,p){try{l(r[h](p))}catch(d){f(s[0][3],d)}}function l(h){h.value instanceof Be?Promise.resolve(h.value.v).then(c,u):f(s[0][2],h)}function c(h){o("next",h)}function u(h){o("throw",h)}function f(h,p){h(p),s.shift(),s.length&&o(s[0][0],s[0][1])}}function $l(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Fe=="function"?Fe(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(a){return new Promise(function(o,l){a=t[s](a),i(o,l,a.done,a.value)})}}function i(s,a,o,l){Promise.resolve(l).then(function(c){s({value:c,done:o})},a)}}function A(t){return typeof t=="function"}function Bi(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var ln=Bi(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Ot(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ct=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Fe(a),l=o.next();!l.done;l=o.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(A(u))try{u()}catch(m){s=m instanceof ln?m.errors:[m]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var h=Fe(f),p=h.next();!p.done;p=h.next()){var d=p.value;try{Er(d)}catch(m){s=s??[],m instanceof ln?s=be(be([],ge(s)),ge(m.errors)):s.push(m)}}}catch(m){r={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}if(s)throw new ln(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Er(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Ot(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Ot(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),_i=ct.EMPTY;function Fi(t){return t instanceof ct||t&&"closed"in t&&A(t.remove)&&A(t.add)&&A(t.unsubscribe)}function Er(t){A(t)?t():t.unsubscribe()}var Vn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},En={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=En.delegate;return i?.setTimeout?i.setTimeout.apply(i,be([t,e],ge(n))):setTimeout.apply(void 0,be([t,e],ge(n)))},clearTimeout:function(t){var e=En.delegate;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Ki(t){En.setTimeout(function(){throw t})}function Tt(){}var mt=null;function $t(t){if(Vn.useDeprecatedSynchronousErrorHandling){var e=!mt;if(e&&(mt={errorThrown:!1,error:null}),t(),e){var n=mt,r=n.errorThrown,i=n.error;if(mt=null,r)throw i}}else t()}var Jn=function(t){Pe(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Fi(n)&&n.add(r)):r.destination=Al,r}return e.create=function(n,r,i){return new Nn(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ct),Cl=Function.prototype.bind;function cn(t,e){return Cl.call(t,e)}var kl=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){vt(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){vt(r)}else vt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){vt(n)}},t}(),Nn=function(t){Pe(e,t);function e(n,r,i){var s=t.call(this)||this,a;if(A(n)||!n)a={next:n??void 0,error:r??void 0,complete:i??void 0};else{var o;s&&Vn.useDeprecatedNextContext?(o=Object.create(n),o.unsubscribe=function(){return s.unsubscribe()},a={next:n.next&&cn(n.next,o),error:n.error&&cn(n.error,o),complete:n.complete&&cn(n.complete,o)}):a=n}return s.destination=new kl(a),s}return e}(Jn);function vt(t){Ki(t)}function Sl(t){throw t}var Al={closed:!0,next:Tt,error:Sl,complete:Tt},Zn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Yn(t){return t}function El(t){return t.length===0?Yn:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var W=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=Pl(e)?e:new Nn(e,n,r);return $t(function(){var a=i,o=a.operator,l=a.source;s.add(o?o.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Nr(n),new n(function(i,s){var a=new Nn({next:function(o){try{e(o)}catch(l){s(l),a.unsubscribe()}},error:s,complete:i});r.subscribe(a)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Zn]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return El(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Nr(e),new e(function(r,i){var s;n.subscribe(function(a){return s=a},function(a){return i(a)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function Nr(t){var e;return(e=t??Vn.Promise)!==null&&e!==void 0?e:Promise}function Nl(t){return t&&A(t.next)&&A(t.error)&&A(t.complete)}function Pl(t){return t&&t instanceof Jn||Nl(t)&&Fi(t)}function Ol(t){return A(t?.lift)}function K(t){return function(e){if(Ol(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function G(t,e,n,r,i){return new qi(t,e,n,r,i)}var qi=function(t){Pe(e,t);function e(n,r,i,s,a,o){var l=t.call(this,n)||this;return l.onFinalize=a,l.shouldUnsubscribe=o,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Jn),Tl=Bi(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ht=function(t){Pe(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Pr(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Tl},e.prototype.next=function(n){var r=this;$t(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=Fe(r.currentObservers),o=a.next();!o.done;o=a.next()){var l=o.value;l.next(n)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;$t(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;$t(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,a=i.isStopped,o=i.observers;return s||a?_i:(this.currentObservers=null,o.push(n),new ct(function(){r.currentObservers=null,Ot(o,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,a=r.isStopped;i?n.error(s):a&&n.complete()},e.prototype.asObservable=function(){var n=new W;return n.source=this,n},e.create=function(n,r){return new Pr(n,r)},e}(W),Pr=function(t){Pe(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:_i},e}(Ht),Hi={now:function(){return(Hi.delegate||Date).now()},delegate:void 0},Il=function(t){Pe(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(ct),It={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=It.delegate;return i?.setInterval?i.setInterval.apply(i,be([t,e],ge(n))):setInterval.apply(void 0,be([t,e],ge(n)))},clearInterval:function(t){var e=It.delegate;return(e?.clearInterval||clearInterval)(t)},delegate:void 0},Ll=function(t){Pe(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,a=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(a,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(a,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),It.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&It.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(a){i=!0,s=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ot(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Il),Or=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Hi.now,t}(),Ml=function(t){Pe(e,t);function e(n,r){r===void 0&&(r=Or.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(Or),Xn=new Ml(Ll),Rl=Xn,zi=new W(function(t){return t.complete()});function Wi(t){return t&&A(t.schedule)}function Gi(t){return t[t.length-1]}function zt(t){return Wi(Gi(t))?t.pop():void 0}function Dl(t,e){return typeof Gi(t)=="number"?t.pop():e}var Qn=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Vi(t){return A(t?.then)}function Ji(t){return A(t[Zn])}function Zi(t){return Symbol.asyncIterator&&A(t?.[Symbol.asyncIterator])}function Yi(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function jl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Xi=jl();function Qi(t){return A(t?.[Xi])}function es(t){return xl(this,arguments,function(){var n,r,i,s;return Ui(this,function(a){switch(a.label){case 0:n=t.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Be(n.read())];case 3:return r=a.sent(),i=r.value,s=r.done,s?[4,Be(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Be(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function ts(t){return A(t?.getReader)}function xe(t){if(t instanceof W)return t;if(t!=null){if(Ji(t))return Ul(t);if(Qn(t))return Bl(t);if(Vi(t))return _l(t);if(Zi(t))return ns(t);if(Qi(t))return Fl(t);if(ts(t))return Kl(t)}throw Yi(t)}function Ul(t){return new W(function(e){var n=t[Zn]();if(A(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Bl(t){return new W(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function _l(t){return new W(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Ki)})}function Fl(t){return new W(function(e){var n,r;try{for(var i=Fe(t),s=i.next();!s.done;s=i.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(o){n={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function ns(t){return new W(function(e){ql(t,e).catch(function(n){return e.error(n)})})}function Kl(t){return ns(es(t))}function ql(t,e){var n,r,i,s;return wl(this,void 0,void 0,function(){var a,o;return Ui(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=$l(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(a=r.value,e.next(a),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ae(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function rs(t,e){return e===void 0&&(e=0),K(function(n,r){n.subscribe(G(r,function(i){return Ae(r,t,function(){return r.next(i)},e)},function(){return Ae(r,t,function(){return r.complete()},e)},function(i){return Ae(r,t,function(){return r.error(i)},e)}))})}function is(t,e){return e===void 0&&(e=0),K(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Hl(t,e){return xe(t).pipe(is(e),rs(e))}function zl(t,e){return xe(t).pipe(is(e),rs(e))}function Wl(t,e){return new W(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Gl(t,e){return new W(function(n){var r;return Ae(n,e,function(){r=t[Xi](),Ae(n,e,function(){var i,s,a;try{i=r.next(),s=i.value,a=i.done}catch(o){n.error(o);return}a?n.complete():n.next(s)},0,!0)}),function(){return A(r?.return)&&r.return()}})}function ss(t,e){if(!t)throw new Error("Iterable cannot be null");return new W(function(n){Ae(n,e,function(){var r=t[Symbol.asyncIterator]();Ae(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Vl(t,e){return ss(es(t),e)}function Jl(t,e){if(t!=null){if(Ji(t))return Hl(t,e);if(Qn(t))return Wl(t,e);if(Vi(t))return zl(t,e);if(Zi(t))return ss(t,e);if(Qi(t))return Gl(t,e);if(ts(t))return Vl(t,e)}throw Yi(t)}function er(t,e){return e?Jl(t,e):xe(t)}function Zl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=zt(t);return er(t,n)}function Yl(t){return t instanceof Date&&!isNaN(t)}function Ke(t,e){return K(function(n,r){var i=0;n.subscribe(G(r,function(s){r.next(t.call(e,s,i++))}))})}var Xl=Array.isArray;function Ql(t,e){return Xl(e)?t.apply(void 0,be([],ge(e))):t(e)}function ec(t){return Ke(function(e){return Ql(t,e)})}function tc(t,e,n,r,i,s,a,o){var l=[],c=0,u=0,f=!1,h=function(){f&&!l.length&&!c&&e.complete()},p=function(m){return c<r?d(m):l.push(m)},d=function(m){s&&e.next(m),c++;var y=!1;xe(n(m,u++)).subscribe(G(e,function(x){i?.(x),s?p(x):e.next(x)},function(){y=!0},void 0,function(){if(y)try{c--;for(var x=function(){var S=l.shift();a?Ae(e,a,function(){return d(S)}):d(S)};l.length&&c<r;)x();h()}catch(S){e.error(S)}}))};return t.subscribe(G(e,p,function(){f=!0,h()})),function(){o?.()}}function ze(t,e,n){return n===void 0&&(n=1/0),A(e)?ze(function(r,i){return Ke(function(s,a){return e(r,s,i,a)})(xe(t(r,i)))},n):(typeof e=="number"&&(n=e),K(function(r,i){return tc(r,i,t,n)}))}function as(t){return t===void 0&&(t=1/0),ze(Yn,t)}function nc(){return as(1)}function Pn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return nc()(er(t,zt(t)))}var rc=["addListener","removeListener"],ic=["addEventListener","removeEventListener"],sc=["on","off"];function qe(t,e,n,r){if(A(n)&&(r=n,n=void 0),r)return qe(t,e,n).pipe(ec(r));var i=ge(lc(t)?ic.map(function(o){return function(l){return t[o](e,l,n)}}):ac(t)?rc.map(Tr(t,e)):oc(t)?sc.map(Tr(t,e)):[],2),s=i[0],a=i[1];if(!s&&Qn(t))return ze(function(o){return qe(o,e,n)})(xe(t));if(!s)throw new TypeError("Invalid event target");return new W(function(o){var l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return o.next(1<c.length?c:c[0])};return s(l),function(){return a(l)}})}function Tr(t,e){return function(n){return function(r){return t[n](e,r)}}}function ac(t){return A(t.addListener)&&A(t.removeListener)}function oc(t){return A(t.on)&&A(t.off)}function lc(t){return A(t.addEventListener)&&A(t.removeEventListener)}function cc(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Rl);var r=-1;return e!=null&&(Wi(e)?n=e:r=e),new W(function(i){var s=Yl(t)?+t-n.now():t;s<0&&(s=0);var a=0;return n.schedule(function(){i.closed||(i.next(a++),0<=r?this.schedule(void 0,r):i.complete())},s)})}var uc=Array.isArray;function fc(t){return t.length===1&&uc(t[0])?t[0]:t}function ye(t,e){return K(function(n,r){var i=0;n.subscribe(G(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function os(t,e){return e===void 0&&(e=Xn),K(function(n,r){var i=null,s=null,a=null,o=function(){if(i){i.unsubscribe(),i=null;var c=s;s=null,r.next(c)}};function l(){var c=a+t,u=e.now();if(u<c){i=this.schedule(void 0,c-u),r.add(i);return}o()}n.subscribe(G(r,function(c){s=c,a=e.now(),i||(i=e.schedule(l,t),r.add(i))},function(){o(),r.complete()},void 0,function(){s=i=null}))})}function Ir(t){return t<=0?function(){return zi}:K(function(e,n){var r=0;e.subscribe(G(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function dc(){return K(function(t,e){t.subscribe(G(e,Tt))})}function hc(t){return Ke(function(){return t})}function ls(t,e){return e?function(n){return Pn(e.pipe(Ir(1),dc()),n.pipe(ls(t)))}:ze(function(n,r){return t(n,r).pipe(Ir(1),hc(n))})}function pc(t,e){e===void 0&&(e=Xn);var n=cc(t,e);return ls(function(){return n})}function gc(t,e){return e===void 0&&(e=Yn),t=t??mc,K(function(n,r){var i,s=!0;n.subscribe(G(r,function(a){var o=e(a);(s||!t(i,o))&&(s=!1,i=o,r.next(a))}))})}function mc(t,e){return t===e}function cs(t,e){return gc(function(n,r){return e?e(n[t],r[t]):n[t]===r[t]})}function us(t,e,n,r){return K(function(i,s){var a;!e||typeof e=="function"?a=e:(n=e.duration,a=e.element,r=e.connector);var o=new Map,l=function(d){o.forEach(d),d(s)},c=function(d){return l(function(m){return m.error(d)})},u=0,f=!1,h=new qi(s,function(d){try{var m=t(d),y=o.get(m);if(!y){o.set(m,y=r?r():new Ht);var x=p(m,y);if(s.next(x),n){var S=G(y,function(){y.complete(),S?.unsubscribe()},void 0,void 0,function(){return o.delete(m)});h.add(xe(n(x)).subscribe(S))}}y.next(a?a(d):d)}catch(q){c(q)}},function(){return l(function(d){return d.complete()})},c,function(){return o.clear()},function(){return f=!0,u===0});i.subscribe(h);function p(d,m){var y=new W(function(x){u++;var S=m.subscribe(x);return function(){S.unsubscribe(),--u===0&&f&&h.unsubscribe()}});return y.key=d,y}})}function vc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=zt(t),r=Dl(t,1/0);return t=fc(t),K(function(i,s){as(r)(er(be([i],ge(t)),n)).subscribe(s)})}function On(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vc.apply(void 0,be([],ge(t)))}function yc(){return K(function(t,e){var n,r=!1;t.subscribe(G(e,function(i){var s=n;n=i,r&&e.next([s,i]),r=!0}))})}function bc(t){return K(function(e,n){var r=!1,i=0;e.subscribe(G(n,function(s){return(r||(r=!t(s,i++)))&&n.next(s)}))})}function wc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=zt(t);return K(function(r,i){(n?Pn(t,r,n):Pn(t,r)).subscribe(i)})}function xc(t,e){return K(function(n,r){var i=null,s=0,a=!1,o=function(){return a&&!i&&r.complete()};n.subscribe(G(r,function(l){i?.unsubscribe();var c=0,u=s++;xe(t(l,u)).subscribe(i=G(r,function(f){return r.next(e?e(l,f,u,c++):f)},function(){i=null,o()}))},function(){a=!0,o()}))})}function nt(t){return K(function(e,n){xe(t).subscribe(G(n,function(){return n.complete()},Tt)),!n.closed&&e.subscribe(n)})}const $c={className:"MethodChooser",props:{},children:[{className:"Method",props:{Name:"2 switch",Key:"idl6e14meiwzjdcquhgk9",Active:"false",Pattern:"idl83jjo4z0ibii6748fx"},children:[{className:"KeyHandler",props:{Signal:"keyup",Debounce:"0.1"},children:[{className:"HandlerKeyCondition",props:{Key:" "},children:[]},{className:"HandlerKeyCondition",props:{Key:"ArrowRight"},children:[]},{className:"ResponderPatternNext",props:{Response:"ResponderPatternNext"},children:[]}]},{className:"KeyHandler",props:{Signal:"keyup",Debounce:"0.1"},children:[{className:"HandlerKeyCondition",props:{Key:"Enter"},children:[]},{className:"HandlerKeyCondition",props:{Key:"ArrowLeft"},children:[]},{className:"ResponderPatternActivate",props:{Response:"ResponderPatternActivate"},children:[]}]}]},{className:"Method",props:{Name:"Pointer dwell",Key:"idl6wcdmjjkb48xmbxscn",Active:"false",Pattern:"idl84lw7z6km7dgni3tn"},children:[{className:"PointerHandler",props:{Signal:"pointerover",Debounce:"0.1"},children:[{className:"ResponderCue",props:{Response:"ResponderCue",Cue:"idl7qm4cs28fh2ogf4ni"},children:[]},{className:"ResponderStartTimer",props:{Response:"ResponderStartTimer",TimerName:"idl7yrtido633vxa1bb1v"},children:[]}]},{className:"PointerHandler",props:{Signal:"pointerout",Debounce:"0.1"},children:[{className:"ResponderClearCue",props:{Response:"ResponderClearCue"},children:[]}]},{className:"PointerHandler",props:{Signal:"pointerdown",Debounce:"0.1"},children:[{className:"ResponderActivate",props:{Response:"ResponderActivate"},children:[]}]},{className:"Timer",props:{Interval:"1.5",Name:"dwell",Key:"idl7yrtido633vxa1bb1v"},children:[]},{className:"TimerHandler",props:{Signal:"timer",TimerName:"idl7yrtido633vxa1bb1v"},children:[{className:"ResponderActivate",props:{Response:"ResponderActivate"},children:[]}]}]},{className:"Method",props:{Name:"Mouse",Key:"idl84ljjeoebyl94sow87",Active:"true",Pattern:"idl83jg7qtj9wmyggtxf"},children:[{className:"PointerHandler",props:{Signal:"pointerdown",Debounce:"0.01"},children:[{className:"ResponderActivate",props:{Response:"ResponderActivate"},children:[]}]},{className:"PointerHandler",props:{Signal:"pointerover",Debounce:"0.1"},children:[{className:"ResponderCue",props:{Response:"ResponderCue",Cue:"idl7qm4cs28fh2ogf4ni"},children:[]}]},{className:"PointerHandler",props:{Signal:"pointerout",Debounce:"0.1"},children:[{className:"ResponderClearCue",props:{Response:"ResponderClearCue"},children:[]}]}]}]};class fs extends we{name=new k("Methods");children=[];stop$=new Ht;onUpdate(){console.log("update method",this),C.write("method",this.toObject()),this.configure(),w.state.update()}configure(){this.stop$.next();for(const e of this.children)e.configure(this.stop$)}static async load(){const e=await C.read("method",$c),n=this.fromObject(e);return n.configure(),n}template(){return g`<div class="MethodChooser" id=${this.id}>
      ${this.children.map(e=>e.settings())}
    </div> `}refresh(){this.children.filter(e=>e.Active.value).forEach(e=>e.refresh())}}b.register(fs,"MethodChooser");class Le extends b{Name=new k("New method");Key=new Dt;Active=new Rt(!1);Pattern=new U;open=!1;children=[];get pattern(){return w.patterns.byKey(this.Pattern.value)}get timers(){return new Map(this.filterChildren(Ct).map(e=>[e.Key.value,e]))}get timerNames(){return new Map(this.filterChildren(Ct).map(e=>[e.Key.value,e.Name.value]))}timer(e){return this.filterChildren(Ct).find(n=>n.Key.value==e)}cancelTimers(){for(const e of this.timers.values())e.cancel()}get handlers(){return this.filterChildren(Wt)}settings(){const{Name:e,Active:n,Pattern:r}=this,i=[...this.timers.values()];return g`<fieldset class="Method" id=${this.id}>
      ${e.input()} ${n.input()}
      ${r.input(w.patterns.patternMap)}
      <details open>
        <summary>Details</summary>
        ${i.length>0?g`<fieldset>
              <legend>Timers</legend>
              ${this.unorderedChildren(i)}
            </fieldset>`:g`Timers`}
        <fieldset>
          <legend>Handlers</legend>
          ${this.orderedChildren(this.handlers)}
        </fieldset>
      </details>
    </fieldset> `}configure(e){if(this.Active.value)for(const n of this.handlers)n.configure(e)}refresh(){this.pattern.refresh()}}b.register(Le,"Method");class Ct extends b{Interval=new R(.5,{hiddenLabel:!0});Name=new k("timer",{hiddenLabel:!0});Key=new Dt;subject$=new Ht;settings(){return g`${this.Name.input()} ${this.Interval.input()}
      <style>
        ${`:root { --${this.Key.value}: ${this.Interval.value}s}`}
      </style> `}start(e){st("start timer");const n={type:"timer",target:e.target},r=Et(n);r.access=e.access,this.subject$.next(r)}cancel(){st("cancel timer");const e=Et(new Event("cancel"));this.subject$.next(e)}}b.register(Ct,"Timer");class Wt extends b{children=[];get conditions(){return this.filterChildren(ds)}get keys(){return this.filterChildren(hs)}get responses(){return this.filterChildren(me)}configure(e){throw new TypeError("Must override configure")}respond(e){this.nearestParent(Le).cancelTimers();for(const r of this.responses)r.respond(e)}}class ds extends b{Condition=new jt("",{hiddenLabel:!0});settings(){const{Condition:e}=this;return g` <div class="Condition">${e.input()}</div> `}eval(e){return this.Condition.eval(e)}}b.register(ds,"HandlerCondition");const Cc=new Map([[" ","Space"],["Enter","Enter"],["ArrowLeft","Left Arrow"],["ArrowRight","Right Arrow"],["ArrowUp","Up Arrow"],["ArrowDown","Down Arrow"]]);class hs extends b{Key=new U(Cc,{hiddenLabel:!0});settings(){const{Key:e}=this;return g` <div class="Key">${e.input()}</div> `}}b.register(hs,"HandlerKeyCondition");const kc=new Map([["HandlerResponse","none"],["ResponderPatternNext","pattern next"],["ResponderPatternActivate","pattern activate"],["ResponderPatternCue","pattern cue"],["ResponderCue","cue"],["ResponderActivate","activate"],["ResponderClearCue","clear cue"],["ResponderEmit","emit"],["ResponderStartTimer","start timer"]]);class me extends di{Response=new li(kc,{hiddenLabel:!0});respond(e){console.log("no response for",e)}settings(){return g`
      <div class="Response">${this.Response.input()} ${this.subTemplate()}</div>
    `}get pattern(){return this.nearestParent(Le).pattern}subTemplate(){return g`<!--empty-->`}}b.register(me,"HandlerResponse");class Sc extends me{respond(){this.pattern.next()}}b.register(Sc,"ResponderPatternNext");class Ac extends me{respond(){console.log("responder activate"),this.pattern.activate()}}b.register(Ac,"ResponderPatternActivate");class Ec extends me{respond(){this.pattern.cue()}}b.register(Ec,"ResponderPatternCue");class Nc extends me{Cue=new U;subTemplate(){return this.Cue.input(w.cues.cueMap)}respond(e){if(e.target instanceof HTMLButtonElement){for(const r of document.querySelectorAll("[cue]"))r.removeAttribute("cue");Ie(e.target).cue(this.Cue.value)}}}b.register(Nc,"ResponderCue");class Pc extends me{respond(e){if(e.target instanceof HTMLButtonElement){const n=Ie(e.target),r=n.access.ComponentName;"onClick"in n.access?n.access.onClick():w.actions.applyRules(r,"press",n.access)}}}b.register(Pc,"ResponderActivate");class Oc extends me{respond(){for(const e of document.querySelectorAll("[cue]"))e.removeAttribute("cue")}}b.register(Oc,"ResponderClearCue");class Tc extends me{respond(e){w.actions.applyRules(e.access.type,"press",e.access)}}b.register(Tc,"ResponderEmit");class Ic extends me{TimerName=new U([],{placeholder:"Choose a timer",hiddenLabel:!0});subTemplate(){const e=this.nearestParent(Le).timerNames;return g`${this.TimerName.input(e)}`}respond(e){const n=this.nearestParent(Le).timer(this.TimerName.value);!n||(document.documentElement.style.setProperty("--timerInterval",`${n.Interval.value}s`),n.start(e))}}b.register(Ic,"ResponderStartTimer");const Lc=new Map([["keyup","Key up"],["keydown","Key down"]]);class Mc extends Wt{Signal=new U(Lc);Debounce=new R(.1);settings(){const{conditions:e,responses:n,keys:r}=this,{Signal:i,Debounce:s}=this;return g`
      <fieldset class="Handler">
        <legend>Key Handler</legend>
        ${i.input()} ${s.input()}
        <fieldset class="Keys">
          <legend>Keys</legend>
          ${this.unorderedChildren(r)}
        </fieldset>
        <fieldset class="Conditions">
          <legend>Conditions</legend>
          ${this.unorderedChildren(e)}
        </fieldset>
        <fieldset class="Responses">
          <legend>Responses</legend>
          ${this.unorderedChildren(n)}
        </fieldset>
      </fieldset>
    `}configure(e){const n=this.Debounce.valueAsNumber*1e3,r=qe(document,"keydown"),i=qe(document,"keyup");function s({target:c}){const u=document.getElementById("designer");return!u||!u.contains(c)}const a=r.pipe(On(i),ye(c=>!c.repeat&&s(c)),us(c=>c.key),ze(c=>c.pipe(os(n),bc(u=>u.type!="keydown"),cs("type"))));let o;const l=this.keys.map(c=>c.Key.value);o=a.pipe(ye(c=>c.type==this.Signal.value&&(l.length==0||l.indexOf(c.key)>=0)),Ke(c=>{const u=Et(c);return u.access={key:c.key,altKey:c.altKey,ctrlKey:c.ctrlKey,metaKey:c.metaKey,shiftKey:c.shiftKey,eventType:c.type},u}));for(const c of this.conditions)o=o.pipe(ye(u=>c.Condition.eval(u.access)));o.pipe(nt(e)).subscribe(c=>this.respond(c))}}b.register(Mc,"KeyHandler");const Rc=new Map([["pointerdown","Pointer down"],["pointerup","Pointer up"],["pointerover","Pointer enter"],["pointerout","Pointer leave"]]);class Dc extends Wt{Signal=new U(Rc);Debounce=new R(.1);SkipOnRedraw=new Rt(!1);settings(){const{conditions:e,responses:n,Signal:r,Debounce:i}=this,s=this.Signal.value=="pointerover"?this.SkipOnRedraw.input():g``;return g`
      <fieldset class="Handler">
        <legend>Pointer Handler</legend>
        ${r.input()} ${i.input()} ${s}
        <fieldset class="Conditions">
          <legend>Conditions</legend>
          ${this.unorderedChildren(e)}
        </fieldset>
        <fieldset class="Responses">
          <legend>Responses</legend>
          ${this.unorderedChildren(n)}
        </fieldset>
      </fieldset>
    `}configure(e){const n=this.Signal.value,r=this.Debounce.valueAsNumber*1e3;function i(d,m){return qe(d,m)}const s=i(document,"pointerdown");s.pipe(nt(e)).subscribe(d=>d.target instanceof Element&&d.target.hasPointerCapture(d.pointerId)&&d.target.releasePointerCapture(d.pointerId));const a=i(document,"pointerup"),o=i(document,"pointerover"),l=i(document,"pointerout");function c(d,m,y){return d.pipe(On(m),ye(x=>x.target instanceof HTMLButtonElement&&x.target.closest("div#UI")!==null),us(x=>x.target),ze(x=>x.pipe(os(y),cs("type"))))}const u=c(o,l,r),f=c(s,a,r);qe(document,"contextmenu").pipe(ye(d=>d.target instanceof HTMLButtonElement&&d.target.closest("div#UI")!==null),nt(e)).subscribe(d=>d.preventDefault());let h=null;h=u.pipe(On(f),ye(d=>d.target instanceof HTMLButtonElement&&!d.target.disabled),Ke(d=>{const m=Et(d);return m.access={...Ie(d.target).access},m.access.eventType=d.type,m}));const p=Ie(new PointerEvent("first"));n=="pointerover"&&this.SkipOnRedraw.value&&(h=h.pipe(wc(p),yc(),ye(([d,m])=>!(d.type=="pointerover"&&m.type=="pointerover"&&d.target!==m.target)),Ke(([d,m])=>m))),h=h.pipe(ye(d=>d.type==n));for(const d of this.conditions)h=h.pipe(ye(m=>d.Condition.eval(m.access)));h.pipe(nt(e)).subscribe(d=>this.respond(d))}}b.register(Dc,"PointerHandler");const jc=new Map([["transitionend","Transition end"],["animationend","Animation end"],["timer","Timer complete"]]);class Uc extends Wt{Signal=new U(jc);TimerName=new U([],{hiddenLabel:!0});settings(){const{conditions:e,responses:n,Signal:r}=this,i=this.nearestParent(Le).timerNames;return g`
      <fieldset class="Handler">
        <legend>Timer Handler</legend>
        ${r.input()} ${this.TimerName.input(i)}
        <fieldset class="Conditions">
          <legend>Conditions</legend>
          ${this.unorderedChildren(e)}
        </fieldset>
        <fieldset class="Responses">
          <legend>Responses</legend>
          ${this.unorderedChildren(n)}
        </fieldset>
      </fieldset>
    `}configure(e){st("configure timer");const n=this.nearestParent(Le).timer(this.TimerName.value);if(!n)return;const r=1e3*n.Interval.valueAsNumber;n.subject$.pipe(xc(i=>i.type=="cancel"?zi:Zl(i).pipe(pc(r))),nt(e)).subscribe(i=>this.respond(i))}}b.register(Uc,"TimerHandler");const Bc={className:"CueList",props:{},children:[{className:"CueCss",props:{Name:"yellow overlay",Key:"idl7qm4cs28fh2ogf4ni",CueType:"CueCss",Code:`
button[cue="{{Key}}"] {
  position: relative;
  border-color: yellow;
}
button[cue="{{Key}}"]:after {
  content: "";
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: yellow;
  opacity: 0.3;
  z-index: 10;
}`},children:[]},{className:"CueOverlay",props:{Name:"red overlay",Key:"idl7w16hghqop9hcgn95",CueType:"CueOverlay",Color:"red",Opacity:"0.2"},children:[]},{className:"CueFill",props:{Name:"fill",Key:"idl7ysqw4agxg63qvx4j5",CueType:"CueFill",Color:"#7BAFD4",Opacity:"0.3",Direction:"top"},children:[]},{className:"CueCircle",props:{Name:"circle",Key:"idl7ythslqew02w4pom29",CueType:"CueCircle",Color:"#7BAFD4",Opacity:"0.8"},children:[]}]};class ps extends we{name=new k("Cues");allowedChildren=["CueCSS","CueOverlay"];children=[];template(){return g`<div class="CueList" id=${this.id}>
      ${this.unorderedChildren()}
    </div>`}renderCss(){return this.children.map(e=>e.renderCss())}get cueMap(){return new Map(this.children.map(e=>[e.Key.value,e.Name.value]))}static async load(){const e=await C.read("cues",Bc);return this.fromObject(e)}onUpdate(){C.write("cues",this.toObject()),w.state.update()}}b.register(ps,"CueList");const _c=new Map([["Cue","none"],["CueCss","css"],["CueOverlay","overlay"],["CueFill","fill"],["CueCircle","circle"]]);class ut extends di{Name=new k("a cue");Key=new Dt;CueType=new li(_c);settings(){return g`
      <fieldset class="Cue">
        ${this.Name.input()} ${this.CueType.input()} ${this.subTemplate()}
      </fieldset>
    `}subTemplate(){return g`<!--empty-->`}get css(){return""}renderCss(){return g`<style>
      ${ci(this.css,this.props)}
    </style>`}}b.register(ut,"Cue");class Fc extends ut{Code=new ka("",{placeholder:"Enter CSS for this cue",hiddenLabel:!0});subTemplate(){return g`<details>
      <summary>CSS</summary>
      ${this.Code.input()}
    </details>`}get css(){return this.Code.value}}b.register(Fc,"CueCss");class Kc extends ut{Color=new he("yellow");Opacity=new R(.3);subTemplate(){return g` ${this.Color.input()} ${this.Opacity.input()}
      <details>
        <summary>generated CSS</summary>
        <pre><code>${this.css}</code></pre>
      </details>`}get css(){return`
      button[cue="{{Key}}"] {
        position: relative;
        border-color: {{Color}};
      }
      button[cue="{{Key}}"]:after {
        content: "";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: {{Color}};
        opacity: {{Opacity}};
        z-index: 10;
      }
    `}}b.register(Kc,"CueOverlay");const qc=new Map([["top","up"],["bottom","down"],["right","left to right"],["left","right to left"]]);class Hc extends ut{Color=new he("blue");Opacity=new R(.3);Direction=new U(qc);Repeat=new Rt(!1);subTemplate(){return g`${this.Color.input()} ${this.Opacity.input()}
      ${this.Direction.input()} ${this.Repeat.input()}
      <details>
        <summary>generated CSS</summary>
        <pre><code>${this.css}</code></pre>
      </details> `}get css(){return`
      button[cue="{{Key}}"] {
        position: relative;
        border-color: {{Color}};
      }
      button[cue="{{Key}}"]:after {
        content: "";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;

        background-color: {{Color}};
        opacity: {{Opacity}};
        z-index: 10;
        animation-name: {{Key}};
        animation-duration: var(--timerInterval);
        animation-timing-function: linear;
        animation-iteration-count: ${this.Repeat.value?"infinite":1};
      }
      @keyframes {{Key}} {
        0% { {{Direction}}: 100%; }
      100% { {{Direction}}: 0%; }
      }
    `}}b.register(Hc,"CueFill");class zc extends ut{Color=new he("lightblue");Opacity=new R(.3);subTemplate(){return g`${this.Color.input()} ${this.Opacity.input()}
      <details>
        <summary>generated CSS</summary>
        <pre><code>${this.css}</code></pre>
      </details> `}renderCss(){const e=this.props;return e.Color=At(e.Color),g`<style>
      ${ci(this.css,e)}
    </style>`}get css(){return`
@property --percent-{{Key}} {
  syntax: "<percentage>";
  initial-value: 100%;
  inherits: false;
}
button[cue="{{Key}}"] {
  position: relative;
  border-color: {{Color}};
}
button[cue="{{Key}}"]:after {
  content: "";
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  -webkit-mask-image: radial-gradient(
    transparent,
    transparent 50%,
    #000 51%,
    #000 0
  );
  mask: radial-gradient(transparent, transparent 50%, #000 51%, #000 0);

  background-image: conic-gradient(
    from 0,
      {{Color}},
      {{Color}} var(--percent-{{Key}}),
    transparent var(--percent-{{Key}})
  );
  opacity: {{Opacity}};

  animation-name: conic-gradient-{{Key}};
  animation-duration: var(--timerInterval);
  animation-timing-function: linear;

  z-index: 0;
}

@keyframes conic-gradient-{{Key}} {
  0% {
    --percent-{{Key}}: 0%;
  }

  100% {
    --percent-{{Key}}: 100%;
  }
}
    `}}b.register(zc,"CueCircle");const Wc={className:"PatternList",props:{},children:[{className:"PatternManager",props:{Cycles:"2",Cue:"idl7qm4cs28fh2ogf4ni",Name:"None",Key:"idl83jg7qtj9wmyggtxf"},children:[]},{className:"PatternManager",props:{Cycles:"2",Cue:"idl7qm4cs28fh2ogf4ni",Name:"Controls and Rows",Key:"idl83jjo4z0ibii6748fx"},children:[{className:"PatternGroup",props:{Name:"Controls",Cycles:"2",Cue:"idl7w16hghqop9hcgn95"},children:[{className:"PatternSelector",props:{},children:[{className:"Filter",props:{Filter:"#controls"},children:[]},{className:"OrderBy",props:{OrderBy:"#controls"},children:[]}]}]},{className:"PatternSelector",props:{},children:[{className:"Filter",props:{Filter:"! #controls"},children:[]},{className:"GroupBy",props:{GroupBy:"#ComponentName",Name:" Component",Cue:"idl7qm4cs28fh2ogf4ni",Cycles:"2"},children:[]},{className:"GroupBy",props:{GroupBy:"#row",Name:"Row #row",Cue:"idl7qm4cs28fh2ogf4ni",Cycles:"2"},children:[]}]}]},{className:"PatternManager",props:{Cycles:"5",Cue:"idl7ysqw4agxg63qvx4j5",Name:"Fill page order",Key:"idl84lw7z6km7dgni3tn"},children:[]}]};class z{constructor(e,n){this.members=e,this.groupProps=n}get length(){return this.members.length*+this.groupProps.Cycles}member(e){if(!(e<0||e>=this.length))return this.members[e%this.members.length]}cue(){for(const e of this.members)e.cue(this.groupProps.Cue)}}class ie extends b{children=[];apply(e){return e}}class Gt extends we{name=new k("Patterns");children=[];template(){return g`<div class="PatternList" id=${this.id}>
      ${this.unorderedChildren()}
    </div>`}byKey(e){return this.children.find(n=>n.Key.value==e)||this.children[0]}get patternMap(){return new Map(this.children.map(e=>[e.Key.value,e.Name.value]))}static async load(){const e=await C.read("pattern",Wc);return Gt.fromObject(e)}onUpdate(){C.write("pattern",this.toObject()),w.state.update()}}b.register(Gt,"PatternList");class Gc extends ie{targets;stack=[];cued=!1;Cycles=new _e(2,{min:1});Cue=new U;Name=new k("a pattern");Key=new Dt;settings(){const{Cycles:e,Cue:n,Name:r}=this;return g`
      <fieldset class=${this.className}>
        <legend>${r.value}</legend>
        ${r.input()} ${e.input()} ${n.input(w.cues.cueMap)}
        <details>
          <summary>Details</summary>
          ${this.orderedChildren()}
        </details>
      </fieldset>
    `}apply(e){let n=[];for(const r of this.children){const i=r.apply(e);i.length>0&&(i instanceof z?n.push(i):n=n.concat(i))}return n.length>0?[new z(n,this.props)]:[]}refresh(){const e=[];for(const r of document.querySelectorAll("#UI button:not(:disabled)"))e.push(Ie(r));let n=[];if(this.children.length)for(const r of this.children){const i=r.apply(e);i.length>0&&(i instanceof z?n.push(i):n=n.concat(i))}else n=e;this.targets=new z(n,this.props),this.start()}start(){this.Name.value!="None"&&(this.stack=[{group:this.targets,index:-1}],this.cue())}get current(){const{group:e,index:n}=this.stack[0];return e.member(n)}next(){const e=this.stack[0];console.log("next",{top:e}),e.index<e.group.length-1?e.index++:this.stack.length>1?(this.stack.shift(),console.log("stack pop")):this.stack.length==1?e.index=0:console.log("empty stack?"),this.cue()}activate(){console.log("activate");let e=this.current;if(!!e){if(e instanceof z){for(console.log("activate group",e,this.stack);e.length==1&&e.members[0]instanceof z;)e=e.members[0];this.stack.unshift({group:e,index:0}),console.log("push stack",this.current,this.stack)}else{const n=e.access.ComponentName;console.log("activate button",e),"onClick"in e.access?(console.log("calling onClick"),e.access.onClick()):(console.log("applyRules",n,e.access),w.actions.applyRules(n,"press",e.access))}this.cue()}}clearCue(){this.cued=!1;for(const e of document.querySelectorAll("[cue]"))e.removeAttribute("cue")}cue(){this.clearCue();const e=this.current;console.log("cue current",e),e&&(this.cued=!0,e.cue(this.Cue.value))}}ie.register(Gc,"PatternManager");class Vc extends ie{Name=new k("");Cycles=new _e(2,{min:1});Cue=new U;settings(){const{Name:e,Cycles:n,Cue:r}=this;return g`<fieldset class=${this.className}>
      <legend>Group: ${e.value}</legend>
      ${e.input()} ${n.input()} ${r.input(w.cues.cueMap)}
      ${this.orderedChildren()}
    </fieldset>`}apply(e){let n=[];for(const r of this.children){const i=r.apply(e);i.length>0&&(i instanceof z?n.push(i):n=n.concat(i))}return n.length>0?[new z(n,this.props)]:[]}}ie.register(Vc,"PatternGroup");class Jc extends ie{settings(){return g`<fieldset class=${this.className}>
      <legend>Selector</legend>
      ${this.unorderedChildren()}
    </fieldset>`}apply(e){return this.children.reduce((n,r)=>r.apply(n),e)}}ie.register(Jc,"PatternSelector");class Zc extends ie{Filter=new jt;settings(){const{Filter:e}=this;return g`<div class=${this.className}>${e.input()}</div>`}apply(e){return e[0]instanceof z?e.map(n=>new z(this.apply(n.members),n.groupProps)).filter(n=>n.length>0):e.filter(n=>this.Filter.eval(n.access))}}ie.register(Zc,"Filter");const Yc=new Intl.Collator(void 0,{numeric:!0});class Xc extends ie{OrderBy=new _n;settings(){const{OrderBy:e}=this;return g`<div class=${this.className}>${e.input()}</div>`}apply(e){if(e[0]instanceof z)return e.map(n=>new z(this.apply(n.members),n.groupProps)).filter(n=>n.length>0);{const n=this.OrderBy.value.slice(1);return[...e].sort((r,i)=>Yc.compare(r.access[n],i.access[n]))}}}ie.register(Xc,"OrderBy");class Qc extends ie{GroupBy=new _n;Name=new k("");Cue=new U;Cycles=new _e(2);settings(){const{GroupBy:e,Name:n,Cue:r,Cycles:i}=this;return g`<div class=${this.className}>
      ${e.input()} ${n.input()} ${r.input(w.cues.cueMap)}
      ${i.input()}
    </div>`}apply(e){if(e[0]instanceof z)return e.map(n=>new z(this.apply(n.members),n.groupProps)).filter(n=>n.length>0);{const{GroupBy:n,...r}=this.props,i=n.slice(1),s=[],a=new Map;for(const o of e){let l=o.access[i];if(!l)continue;l=l.toString();let c=a.get(l);c?c.members.push(o):(c=new z([o],r),a.set(l,c),s.push(c))}return s.length===1?s[0].members:s}}}ie.register(Qc,"GroupBy");class Lt{static _menuCount=0;id=`menu_${Lt._menuCount++}`;contentId=this.id+"_content";buttonId=this.id+"_button";expanded=!1;items=[];current=null;constructor(e,n){this.label=e,this.contentCallback=n}render(){return this.expanded?this.items=this.contentCallback():this.items=[],g`<div
      class="Menu"
      id=${this.id}
      onfocusout=${this.focusHandler}
      ref=${this}
    >
      <button
        id=${this.buttonId}
        aria-expanded=${this.expanded}
        aria-controls=${this.contentId}
        aria-haspopup="true"
        onclick=${this.toggleExpanded}
        onkeyup=${this.buttonKeyHandler}
      >
        ${this.label}
      </button>
      <ul
        ?hidden=${!this.expanded}
        role="menu"
        id=${this.contentId}
        aria-labelledby=${this.buttonId}
        onkeyup=${this.menuKeyHandler}
      >
        ${this.items.map((e,n)=>g`<li role="menuitem">
              <button
                index=${n}
                onclick=${()=>{this.toggleExpanded(),e.callback()}}
              >
                ${e.label}
              </button>
            </li>`)}
      </ul>
    </div>`}get focusedItem(){return this.current.querySelector("li > button:focus")}setFocus(e){e=(e+this.items.length)%this.items.length,this.current.querySelector(`button[index="${e}"]`).focus()}focusHandler=({relatedTarget:e})=>{if(!e){Pt(()=>{const r=document.getElementById(this.buttonId);r&&r.focus()}),this.expanded&&this.toggleExpanded();return}const n=document.getElementById(this.id);n&&!n.contains(e)&&this.expanded&&this.toggleExpanded()};toggleExpanded=(e=null,n=!1)=>{{this.expanded=!this.expanded;const r=e&&e.detail!==0;this.expanded&&(!e||!r)&&Pt(()=>{n?this.setFocus(-1):this.setFocus(0)}),w.state.update()}};menuKeyHandler=({key:e})=>{if(e=="Escape"&&this.expanded)this.toggleExpanded();else if(e=="ArrowUp"||e=="ArrowDown"){const r=+this.focusedItem.getAttribute("index"),i=e=="ArrowUp"?-1:1;this.setFocus(r+i)}else if(e=="Home")this.setFocus(0);else if(e=="End")this.setFocus(-1);else if(e.length==1&&(e>="a"&&e<="z"||e>="A"&&e<="Z")){const r=+this.focusedItem.getAttribute("index");for(let i=1;i<this.items.length;i++)if(this.items[(r+i)%this.items.length].label.startsWith(e)){this.setFocus(i+r);break}}};buttonKeyHandler=e=>{e.key=="ArrowDown"||e.key==" "?(e.preventDefault(),this.toggleExpanded()):e.key=="ArrowUp"&&(e.preventDefault(),this.toggleExpanded(null,!0))}}class gs extends b{init(){console.log("toolbar init"),this.menu=new Lt("Add",()=>["foo","add this to that"].map(e=>({label:e,callback:()=>console.log("menu",e)}))),this.menu2=new Lt("Delete",()=>["delete this","delete that"].map(e=>({label:e,callback:()=>console.log("menu",e)})))}template(){const{state:e}=w;return g`
      <div class="bar">
        <label for="designName">Name: </label>
        <input
          id="designName"
          type="text"
          .value=${C.designName}
          .size=${Math.max(C.designName.length,12)}
          onchange=${n=>C.renameDesign(n.target.value).then(()=>window.location.hash=C.designName)}
        />
        <button onclick=${()=>C.saveDesign()}>Export</button>
        <button onclick=${()=>window.open("#","_blank")}>Home</button>
        <button
          onclick=${async()=>{const n=e.get("designerTab").toLowerCase();["layout","actions"].indexOf(n)>=0&&(await C.undo(n),w.restart())}}
        >
          Undo
        </button>
        ${this.menu.render()} ${this.menu2.render()}
      </div>
    `}}b.register(gs,"ToolBar");class ms extends we{name=new k("Actions");scale=new _e(1);allowedChildren=["Action"];children=[];last={rule:null,data:{},event:"",origin:""};init(){this.applyRules("init","init",{})}eventQueue=[];queueEvent(e,n){this.eventQueue.push({origin:e,event:n})}applyRules(e,n,r){for(this.last={origin:e,event:n,data:r,rule:null},console.log("applyRules",e,n,r);;){const i={...Un,state:w.state,...r};for(const a of this.children){if(e!=a.props.origin&&a.props.origin!="*")continue;const o=a.conditions.every(l=>l.Condition.eval(i));if(console.log({result:o}),o){this.last.rule=a;const l=Object.fromEntries(a.updates.map(c=>[c.props.stateName,c.newValue.eval(i)]));console.log({patch:l}),w.state.update(l);break}}if(this.eventQueue.length==0)break;const s=this.eventQueue.pop();s&&(e=s.origin,n=s.event),r={}}}handler(e,n,r){return i=>{let s=r;i instanceof PointerEvent&&i.altKey&&(s="alt-"+r),this.applyRules(e,s||i.type,n)}}allStates(){const e=new Set;for(const n of this.children){for(const r of n.conditions)for(const[i]of r.props.Condition.matchAll(/\$\w+/g))e.add(i);for(const r of n.updates){e.add(r.props.stateName);for(const[i]of r.newValue.value.matchAll(/\$\w+/g))e.add(i)}}return e}template(){const{state:e,actions:n}=w,r=e.get("ruleIndex");return g`<div class="actions" help="Actions" id=${this.id}>
      <table>
        <thead>
          <tr>
            <th rowspan="2" style="width:13%">Origin</th>
            <th rowspan="2" style="width:25%">Conditions</th>
            <th colspan="2" style="width:50%">Updates</th>
          </tr>
          <tr>
            <th style="width:15%">State</th>
            <th style="width:35%">New value</th>
          </tr>
        </thead>
        ${n.children.map((i,s)=>{const a=i.updates,o=a.length,l=i===n.last.rule;function c(u){return g`
              <td>${u.stateName.input()}</td>
              <td class="update">${u.newValue.input()}</td>
            `}return g`<tbody ?highlight=${r==s}>
            <tr ?used=${l}>
              <td rowspan=${o}>${i.origin.input()}</td>
              <td class="conditions" rowspan=${o}>
                <div class="conditions">
                  ${i.conditions.map(u=>g`<div class="condition">
                        ${u.Condition.input()}
                      </div>`)}
                </div>
              </td>
              ${o?c(a[0]):g`<td></td>
                    <td></td>`}
            </tr>
            ${a.slice(1).map(u=>g`<tr ?used=${l}>
                  ${c(u)}
                </tr>`)}
          </tbody>`})}
      </table>
    </div>`}static async load(){let e=await C.read("actions",{className:"Actions",props:{},children:[]});return Array.isArray(e)&&(console.log("converting",e),e={className:"Actions",props:{},children:e.map(r=>{let{event:i,origin:s,conditions:a,updates:o}=r;const l=[];for(const c of a)l.push({className:"ActionCondition",props:{Condition:c},children:[]});for(const[c,u]of Object.entries(o))l.push({className:"ActionUpdate",props:{stateName:c,newValue:u},children:[]});return{className:"Action",props:{event:i,origin:s},children:l}})},console.log("converted",e)),this.fromObject(e)}onUpdate(){console.log("update actions",this),C.write("actions",this.toObject()),w.state.update()}}b.register(ms,"Actions");class eu extends b{allowedChildren=["ActionCondition","ActionUpdate"];children=[];origin=new k("",{hiddenLabel:!0});event=new k("press",{hiddenLabel:!0});get conditions(){return this.filterChildren(vs)}get updates(){return this.filterChildren(ys)}}b.register(eu,"Action");class vs extends b{Condition=new jt("",{hiddenLabel:!0})}b.register(vs,"ActionCondition");class ys extends b{stateName=new k("",{hiddenLabel:!0});newValue=new jt("",{hiddenLabel:!0})}b.register(ys,"ActionUpdate");async function bs(){sessionStorage.clear();const t=await C.names(),e=await C.saved();t.sort(),Ee(document.body,g`
      <div id="welcome">
        <div id="head)">
          <img class="icon" src="./icon.png" />
          <div>
            <h1>Welcome to the Project Open AAC OS-DPI</h1>
            <p>
              With this tool you can create experimental AAC interfaces. Start
              by loading a design from an ".osdpi" file or by creating a new
              one. Switch between the IDE and the User Interface with the "d"
              key.
            </p>
          </div>
        </div>
        <button
          onclick=${()=>ki({mimeTypes:["application/octet-stream"],extensions:[".osdpi",".zip"],description:"OS-DPI designs",id:"os-dpi"}).then(n=>tt(C.readDesignFromFile(n))).then(()=>window.location.hash=C.designName)}
        >
          Import
        </button>
        <button
          onclick=${async()=>window.location.hash=await C.uniqueName("new")}
        >
          New
        </button>
        <h2>Loaded designs:</h2>
        ${t.map(n=>{const r=e.indexOf(n)>=0,i={};return g`<ul>
            <li>
              <a href=${"#"+n}>${n}</a>
              ${r?"Saved":"Not saved"}

              <button
                ?disabled=${!r}
                onclick=${async()=>{await C.unload(n),bs()}}
                ref=${i}
              >
                Unload
              </button>
              ${r?g`<!--empty-->`:g`<label for=${n}>Enable unload without saving: </label>
                    <input
                      id=${n}
                      type="checkbox"
                      onchange=${({currentTarget:s})=>{i.current&&(i.current.disabled=!s.checked&&!r)}}
                    />`}
            </li>
          </ul> `})}
      </div>
    `)}const tu=new Promise(t=>{window.addEventListener("load",()=>{document.body.classList.add("loaded"),t(!0)})});async function Vt(){if(window.location.search&&!window.location.hash.slice(1)){const o=new URLSearchParams(window.location.search);o.get("fetch")&&(await tt(C.readDesignFromURL(o.get("fetch"))),window.history.replaceState({},document.title,window.location.origin+window.location.pathname+"#"+C.designName))}const t=window.location.hash.slice(1);if(!t)return bs();C.setDesignName(t);const e=await C.read("content",[]);await tu,w.tree=await Ai.load(),w.state=new Bn("UIState"),w.actions=await ms.load(),w.data=new bt(e),w.cues=await ps.load(),w.patterns=await Gt.load(),w.method=await fs.load(),w.restart=Vt;function n(o){let l=null;return()=>{l&&window.cancelAnimationFrame(l),l=window.requestAnimationFrame(o)}}w.state.define("editing",!0);const r=b.fromObject({className:"DesignerTabControl",props:{tabEdge:"top",stateName:"designerTab"},children:[{className:"Layout",props:{name:"Layout"},children:[w.tree]},w.actions,w.cues,w.patterns,w.method,{className:"Content",props:{},children:[]},{className:"Logging",props:{},children:[]}]}),i=gs.create("ToolBar",null),s=new ul;function a(){const o=performance.now();let l=g`<!--empty-->`;w.state.get("editing")&&(l=g`
        <div
          id="designer"
          onclick=${c=>{const u=Ie(c.target);u.access&&"onClick"in u.access&&u.access.onClick(c)}}
        >
          <div id="HotKeyHints"><!--empty--></div>
          ${r.template()}
        </div>
        <div id="monitor">${s.template()}</div>
        <div id="toolbar">${i.template()}</div>
      `),document.body.classList.toggle("designing",w.state.get("editing")),Qo(document.body,g`<div id="UI">
          <div id="timer"></div>
          ${w.cues.renderCss()}${w.tree.template()}
        </div>
        ${l}`),w.method.refresh(),location.host.startsWith("localhost")&&(document.getElementById("timer").innerText=(performance.now()-o).toFixed(0))}w.state.observe(n(a)),a()}const ws=new BroadcastChannel("os-dpi");ws.onmessage=t=>{const e=t.data;C.designName==e.name&&(e.action=="update"?Vt():e.action=="rename"&&(window.location.hash=e.newName))};C.addUpdateListener(t=>{ws.postMessage(t)});window.addEventListener("hashchange",()=>{sessionStorage.clear(),Vt()});Vt();
//# sourceMappingURL=index.0.5.0.js.map
